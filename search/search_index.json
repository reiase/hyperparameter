{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"home","text":"<ul> <li>\u4e2d\u6587</li> </ul> Hyperparameter <p> ENGLISH | \u4e2d\u6587\u6587\u6863 </p> <p> Make configurable AI applications. Build for Python/Rust hackers. </p> <p>Hyperparameter is a versatile library designed to streamline the management and control of hyperparameters in machine learning algorithms and system development. Tailored for AI researchers and Machine Learning Systems (MLSYS) developers, Hyperparameter offers a unified solution with a focus on ease of use in Python, high-performance access in Rust and C++, and a set of macros for seamless hyperparameter management.</p>"},{"location":"#5-minute-try","title":"5-Minute Try","text":"<pre><code>pip install hyperparameter\n\n# Run a ready-to-use demo\npython -m hyperparameter.examples.quickstart\n\n# Try the @hp.param CLI: override defaults from the command line\npython -m hyperparameter.examples.quickstart --define greet.name=Alice --enthusiasm=3\n\n# Inspect params and defaults\npython -m hyperparameter.examples.quickstart -lps\npython -m hyperparameter.examples.quickstart -ep greet.name\n\n# Running from source? Use module mode or install editable\n# python -m hyperparameter.examples.quickstart\n# or: pip install -e .\n</code></pre>"},{"location":"#why-hyperparameter","title":"Why Hyperparameter?","text":""},{"location":"#unmatched-performance-vs-hydra","title":"\ud83d\ude80 Unmatched Performance (vs Hydra)","text":"<p>Hyperparameter is built on a high-performance Rust backend, making it significantly faster than pure Python alternatives like Hydra, especially in inner-loop parameter access.</p> Method Time (1M iters) Speedup (vs Hydra) HP: Injected (Native Speed) 0.0184s 856.73x \ud83d\ude80 HP: Dynamic (Optimized) 2.4255s 6.50x \u26a1\ufe0f Hydra (Baseline) 15.7638s 1.00x <p>Benchmark scenario: Accessing a nested parameter <code>model.layers.0.size</code> 1,000,000 times in a loop. See <code>benchmark/</code> folder for reproduction scripts.</p>"},{"location":"#zero-dependency-schema-validation","title":"\u2728 Zero-Dependency Schema Validation","text":"<p>Hyperparameter supports structural validation using standard Python type hints without introducing heavy dependencies (like Pydantic or OmegaConf).</p> <pre><code>from dataclasses import dataclass\nimport hyperparameter as hp\n\n@dataclass\nclass AppConfig:\n    host: str\n    port: int\n    debug: bool = False\n\n# Validates types and converts automatically: \"8080\" -&gt; 8080 (int)\ncfg = hp.config(\"config.toml\", schema=AppConfig)\n</code></pre>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#for-python-users","title":"For Python Users","text":"<ul> <li>Pythonic Syntax: Define hyperparameters using keyword argument syntax;</li> <li>Intuitive Scoping: Control parameter scope through <code>with</code> statement;</li> <li>Configuration File: Easy to load parameters from config files (JSON/TOML/YAML) with composition and interpolation support;</li> <li>Zero-Overhead Validation: Optional schema validation using standard Python type hints;</li> </ul>"},{"location":"#for-rust-and-c-users","title":"For Rust and C++ Users","text":"<ul> <li> <p>High-Performance Backend: Hyperparameter is implemented in Rust, providing a robust and high-performance backend for hyperparameter management. Access hyperparameters in Rust and C++ with minimal overhead, making it ideal for ML and system developers who prioritize performance.</p> </li> <li> <p>Macro-Based Parameter Management: Hyperparameter provides a set of macros for both Rust and C++ users. These macros mimic Python's <code>with</code> statements and adhere to language-specific scoping rules.</p> </li> <li> <p>Compile-Time Hashing: Both Rust and C++ interfaces utilize compile-time hashing of hyperparameter names, reducing runtime hash computation overhead.</p> </li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#installation","title":"Installation","text":"<pre><code>pip install hyperparameter\n</code></pre>"},{"location":"#python","title":"Python","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"foo\")\ndef foo(x=1, y=\"a\"):\n    return f\"x={x}, y={y}\"\n\nfoo()  # x=1, y='a'\n\nwith hp.scope(**{\"foo.x\": 2}):\n    foo()  # x=2, y='a'\n</code></pre>"},{"location":"#rust","title":"Rust","text":"<pre><code>fn foo() -&gt; i32 {\n    with_params! {\n        @get x = foo.x or 1i32; // Read hyperparameter with default value\n\n        println!(\"x={}\", x);\n    }\n}\n\nfn main() {\n    foo(); // x=1\n\n    with_params! {\n        @set foo.x = 2i32; // Set hyperparameter\n\n        foo(); // x=2\n    }\n\n    foo(); // x=1\n}\n</code></pre>"},{"location":"#c","title":"C++","text":"<pre><code>ASSERT(1 == GET_PARAM(a.b, 1), \"get undefined param\");\n{\n  auto guard = WITH_PARAMS(a, 1,        //\n                            a.b, 2.0,    //\n                            a.b.c, true, //\n                            a.b.c.d, \"str\");\n  ASSERT(1 == GET_PARAM(a, 0), \"get int value\");\n  ASSERT(1 == GET_PARAM(a, 0), \"get int value\");\n}\n</code></pre>"},{"location":"#detailed-usage-examples","title":"Detailed Usage Examples","text":""},{"location":"#support-for-default-values","title":"Support for Default Values","text":""},{"location":"#python_1","title":"Python","text":"<pre><code>x = hp.scope.foo.x | \"default value\"\n</code></pre>"},{"location":"#rust_1","title":"Rust","text":"<pre><code>@get x = foo.x or \"default value\";\n</code></pre>"},{"location":"#scope-control-of-parameter-values","title":"Scope Control of Parameter Values","text":""},{"location":"#python_2","title":"Python","text":"<pre><code>with hp.scope() as ps: # 1st scope start\n    ps.foo.x=1\n    with hp.scope() as ps2: # 2nd scope start\n        ps.foo.y=2\n    # 2nd scope end\n# 1st scope end\n</code></pre>"},{"location":"#rust_2","title":"Rust","text":"<pre><code>with_params!{ // 1st scope start\n    @set foo.x=1;\n\n    with_params!{ //2nd scope start\n        @set foo.y=2\n\n        ...\n    } // 2nd scope end\n} // 1st scope end\n</code></pre>"},{"location":"#thread-isolationthread-safety","title":"Thread Isolation/Thread Safety","text":""},{"location":"#python_3","title":"Python","text":"<pre><code>@hp.param(\"foo\")\ndef foo(x=1): # Print hyperparameter foo.x\n    print(f\"foo.x={x}\")\n\nwith hp.scope() as ps:\n    ps.foo.x=2 # Modify foo.x in the current thread\n\n    foo() # foo.x=2\n    threading.Thread(target=foo).start() # foo.x=1, new thread's hyperparameter value is not affected by the main thread\n</code></pre>"},{"location":"#rust_3","title":"Rust","text":"<pre><code>fn foo() { // Print hyperparameter foo.x\n    with_params!{\n        @get x = foo.x or 1;\n\n        println!(\"foo.x={}\", x);\n    }\n}\n\nfn main() {\n    with_params!{\n        @set foo.x = 2; // Modify foo.x in the current thread\n\n        foo(); // foo.x=2\n        thread::spawn(foo); // foo.x=1, new thread's hyperparameter value is not affected by the main thread\n    }\n}\n</code></pre>"},{"location":"#command-line-application","title":"Command Line Application","text":"<p>In command line applications, it's common to define hyperparameters using command line arguments (e.g., <code>-D, --define</code>) and control hyperparameters on the command line. Here's an example in Python and Rust:</p>"},{"location":"#python_4","title":"Python","text":"<pre><code># example.py\nimport hyperparameter as hp\n\n@hp.param(\"example\")\ndef main(a=0, b=1):\n    print(f\"example.a={a}, example.b={b}\")\n\nif __name__ == \"__main__\":\n    import argparse\n    parser = argparse.ArgumentParser()\n\n    parser.add_argument(\"-D\", \"--define\", nargs=\"*\", default=[], action=\"extend\")\n    args = parser.parse_args()\n\n    with hp.scope(*args.define):\n        main()\n</code></pre>"},{"location":"#rust_4","title":"Rust","text":"<pre><code>// example.rs\nuse hyperparameter::*;\nuse hyperparameter_derive::Parser;\n\nfn main() {\n    #[derive(Parser, Debug)]\n    struct DeriveArgs {\n        #[arg(short = 'D', long)]\n        define: Vec&lt;String&gt;,\n    }\n\n    let args = DeriveArgs::parse();\n\n    with_params! {\n        params ParamScope::from(&amp;args.define);\n\n        foo()\n    }\n}\n\nfn foo() {\n    with_params! {\n        @get a = example.a or 0;\n        @get b = example.b or 1;\n\n        println!(\"example.a={}, example.b={}\",a ,b);\n    }\n}\n</code></pre>"},{"location":"#more-examples","title":"More Examples","text":""},{"location":"#parameter-tuning-for-researchers","title":"parameter tuning for researchers","text":"<p>This example demonstrates how to use hyperparameter in research projects, and make experiments reproducible.</p>"},{"location":"#experiment-tracing-for-data-scientists","title":"experiment tracing for data scientists","text":"<p>This example showcases experiment management with hyperparameter and result tracing with mlflow.tracing.</p>"},{"location":"#behavior-guarantees-semantic-contract","title":"Behavior Guarantees (Semantic Contract)","text":"<ul> <li>Keys &amp; hashing: keys use <code>.</code> for nesting, case is preserved, and hashing uses the same UTF-8 input and seed across Python/Rust/C++; invalid characters are an error.</li> <li>Read precedence: current thread\u2019s innermost scope &gt; parent scopes outward &gt; frozen global snapshot &gt; user default. Writes only affect the current scope and rollback on exit.</li> <li>Defaults vs. missing: only missing keys fall back to defaults; explicit <code>None</code>/<code>False</code>/<code>0</code> are treated as existing values. Type conversion rules (bool/int/float/str) are consistent across languages; invalid values use a best-effort conversion and otherwise fall back to the provided default (no silent random values).</li> <li>Threads &amp; <code>frozen()</code>: each thread starts from the frozen global snapshot; mutations stay in-thread unless <code>frozen()</code> is called, which atomically updates the global snapshot. Global mutations are lock-protected in the Python backend, matching Rust semantics.</li> <li>Error model: reading an undefined key without a default raises a key error; backend load failure falls back to the Python backend without noisy tracebacks; no silent failure on type errors.</li> <li>Multiprocess notice: cross-process consistency requires a shared backend (e.g., Rust backend or user-provided storage adapter); the built-in Python backend only guards threads, not processes.</li> </ul>"},{"location":"api_reference/","title":"API Reference","text":"<ul> <li>\u4e2d\u6587</li> </ul>"},{"location":"api_reference/#api-reference","title":"API Reference","text":"<p>This document provides a complete reference for the Hyperparameter Python API.</p>"},{"location":"api_reference/#scope","title":"scope","text":"<p><code>scope</code> is the core class for managing hyperparameters with thread-safe scoping.</p>"},{"location":"api_reference/#import","title":"Import","text":"<pre><code>import hyperparameter as hp\n</code></pre>"},{"location":"api_reference/#creating-scope","title":"Creating scope","text":"<pre><code># Empty scope\nps = hp.scope()\n\n# From keyword arguments\nps = hp.scope(lr=0.001, batch_size=32)\n\n# From string arguments (key=value format)\nps = hp.scope(\"lr=0.001\", \"batch_size=32\")\n\n# From dictionary\nps = hp.scope(**{\"train.lr\": 0.001, \"train.batch_size\": 32})\n\n# Empty scope (clears inherited values)\nps = hp.scope.empty()\nps = hp.scope.empty(lr=0.001)\n</code></pre>"},{"location":"api_reference/#reading-parameters","title":"Reading Parameters","text":"<pre><code># Using | operator (returns default if missing)\nlr = hp.scope.train.lr | 0.001\n\n# Using function call (returns default if missing)\nlr = hp.scope.train.lr(0.001)\n\n# Without default (raises KeyError if missing)\nlr = hp.scope.train.lr()\n\n# Dynamic key access\nkey = \"train.lr\"\nlr = scope[key] | 0.001\n</code></pre>"},{"location":"api_reference/#writing-parameters","title":"Writing Parameters","text":"<pre><code>with hp.scope() as ps:\n    # Attribute assignment\n    hp.scope.train.lr = 0.001\n\n    # Via instance\n    ps.train.batch_size = 32\n</code></pre>"},{"location":"api_reference/#context-manager-with-statement","title":"Context Manager (with statement)","text":"<pre><code># Basic usage\nwith hp.scope(**{\"lr\": 0.001}):\n    print(hp.scope.lr())  # 0.001\n\n# Nested scopes\nwith hp.scope(**{\"a\": 1}):\n    print(hp.scope.a())  # 1\n    with hp.scope(**{\"a\": 2}):\n        print(hp.scope.a())  # 2\n    print(hp.scope.a())  # 1 (auto-rollback)\n</code></pre>"},{"location":"api_reference/#static-methods","title":"Static Methods","text":""},{"location":"api_reference/#hpscopeemptyargs-kwargs","title":"<code>hp.scope.empty(*args, **kwargs)</code>","text":"<p>Creates a new empty scope, clearing any inherited values.</p> <pre><code>with hp.scope(**{\"inherited\": 1}):\n    with hp.scope.empty(**{\"fresh\": 2}) as ps:\n        print(ps.inherited(\"missing\"))  # \"missing\"\n        print(ps.fresh())  # 2\n</code></pre>"},{"location":"api_reference/#hpscopecurrent","title":"<code>hp.scope.current()</code>","text":"<p>Returns the current active hp.scope.</p> <pre><code>with hp.scope(**{\"key\": \"value\"}):\n    ps = hp.scope.current()\n    print(ps.key())  # \"value\"\n</code></pre>"},{"location":"api_reference/#hpscopefrozen","title":"<code>hp.scope.frozen()</code>","text":"<p>Snapshots the current scope as the global baseline for new threads.</p> <pre><code>with hp.scope(**{\"global_config\": 42}):\n    hp.scope.frozen()\n    # New threads will inherit global_config=42\n</code></pre>"},{"location":"api_reference/#hpscopeinitparamsnone","title":"<code>hp.scope.init(params=None)</code>","text":"<p>Initializes scope for a new thread.</p> <pre><code>def thread_target():\n    hp.scope.init({\"thread_param\": 1})\n    # ...\n</code></pre>"},{"location":"api_reference/#instance-methods","title":"Instance Methods","text":""},{"location":"api_reference/#pskeys","title":"<code>ps.keys()</code>","text":"<p>Returns an iterable of all parameter keys.</p> <pre><code>with hp.scope(**{\"a\": 1, \"b.c\": 2}) as ps:\n    print(list(ps.keys()))  # ['a', 'b.c']\n</code></pre>"},{"location":"api_reference/#psstorage","title":"<code>ps.storage()</code>","text":"<p>Returns the underlying storage object.</p>"},{"location":"api_reference/#psupdatedict","title":"<code>ps.update(dict)</code>","text":"<p>Updates the scope with values from a dictionary.</p>"},{"location":"api_reference/#psclear","title":"<code>ps.clear()</code>","text":"<p>Clears all parameters in the current hp.scope.</p>"},{"location":"api_reference/#hpparam","title":"@hp.param","text":"<p>Decorator that automatically binds function parameters to hyperparameters.</p>"},{"location":"api_reference/#import_1","title":"Import","text":"<pre><code>import hyperparameter as hp\n</code></pre>"},{"location":"api_reference/#basic-usage","title":"Basic Usage","text":"<pre><code>@hp.param(\"train\")\ndef train(lr=0.001, batch_size=32, epochs=10):\n    print(f\"lr={lr}, batch_size={batch_size}\")\n\n# Uses function defaults\ntrain()  # lr=0.001, batch_size=32\n\n# Override via scope\nwith hp.scope(**{\"train.lr\": 0.01}):\n    train()  # lr=0.01, batch_size=32\n\n# Direct arguments have highest priority\ntrain(lr=0.1)  # lr=0.1, batch_size=32\n</code></pre>"},{"location":"api_reference/#with-custom-namespace","title":"With Custom Namespace","text":"<pre><code>@hp.param(\"myapp.config.train\")\ndef train(lr=0.001):\n    print(f\"lr={lr}\")\n\nwith hp.scope(**{\"myapp.config.train.lr\": 0.01}):\n    train()  # lr=0.01\n</code></pre>"},{"location":"api_reference/#without-namespace-uses-function-name","title":"Without Namespace (uses function name)","text":"<pre><code>@hp.param\ndef my_function(x=1):\n    return x\n\nwith hp.scope(**{\"my_function.x\": 2}):\n    my_function()  # returns 2\n</code></pre>"},{"location":"api_reference/#class-decorator","title":"Class Decorator","text":"<pre><code>@hp.param(\"Model\")\nclass Model:\n    def __init__(self, hidden_size=256, dropout=0.1):\n        self.hidden_size = hidden_size\n        self.dropout = dropout\n\nwith hp.scope(**{\"Model.hidden_size\": 512}):\n    model = Model()  # hidden_size=512, dropout=0.1\n</code></pre>"},{"location":"api_reference/#parameter-resolution-priority","title":"Parameter Resolution Priority","text":"<ol> <li>Direct arguments (highest priority)</li> <li>scope overrides</li> <li>Function signature defaults (lowest priority)</li> </ol>"},{"location":"api_reference/#launch","title":"launch","text":"<p>Entry point for CLI applications with automatic argument parsing.</p>"},{"location":"api_reference/#import_2","title":"Import","text":"<pre><code>import hyperparameter as hp\n</code></pre>"},{"location":"api_reference/#single-function","title":"Single Function","text":"<pre><code>@hp.param(\"app\")\ndef main(input_file, output_file=\"out.txt\", verbose=False):\n    \"\"\"Process input file.\n\n    Args:\n        input_file: Path to input file\n        output_file: Path to output file\n        verbose: Enable verbose output\n    \"\"\"\n    pass\n\nif __name__ == \"__main__\":\n    hp.launch(main)\n</code></pre> <p>Run: <pre><code>python app.py input.txt --output_file result.txt --verbose\npython app.py input.txt -D app.verbose=true\n</code></pre></p>"},{"location":"api_reference/#multiple-functions-subcommands","title":"Multiple Functions (Subcommands)","text":"<pre><code>@hp.param(\"train\")\ndef train(epochs=10, lr=0.001):\n    \"\"\"Train the model.\"\"\"\n    pass\n\n@hp.param(\"eval\")\ndef evaluate(checkpoint=\"model.pt\"):\n    \"\"\"Evaluate the model.\"\"\"\n    pass\n\nif __name__ == \"__main__\":\n    hp.launch()  # Discovers all @hp.param functions\n</code></pre> <p>Run: <pre><code>python app.py train --epochs 20\npython app.py eval --checkpoint best.pt\n</code></pre></p>"},{"location":"api_reference/#cli-options","title":"CLI Options","text":"Option Description <code>-D, --define KEY=VALUE</code> Override hyperparameters <code>-lps, --list-param-scope</code> List all registered parameters <code>-ep, --explain-param KEY</code> Show details for a parameter <code>-h, --help</code> Show help message"},{"location":"api_reference/#launch_1","title":"launch","text":"<p>Alternative to <code>launch</code> with slightly different behavior.</p> <pre><code>import hyperparameter as hp\n\nif __name__ == \"__main__\":\n    hp.launch()\n</code></pre>"},{"location":"api_reference/#type-conversion","title":"Type Conversion","text":"<p>When reading parameters with a default value, automatic type conversion is applied based on the default's type.</p>"},{"location":"api_reference/#boolean-conversion","title":"Boolean Conversion","text":"<pre><code>with hp.scope(**{\"flag\": \"true\"}):\n    hp.scope.flag(False)  # True\n\n# Recognized true values: \"true\", \"True\", \"TRUE\", \"t\", \"T\", \"yes\", \"YES\", \"y\", \"Y\", \"1\", \"on\", \"ON\"\n# Recognized false values: \"false\", \"False\", \"FALSE\", \"f\", \"F\", \"no\", \"NO\", \"n\", \"N\", \"0\", \"off\", \"OFF\"\n</code></pre>"},{"location":"api_reference/#integer-conversion","title":"Integer Conversion","text":"<pre><code>with hp.scope(**{\"count\": \"42\"}):\n    hp.scope.count(0)  # 42 (int)\n\nwith hp.scope(**{\"value\": \"3.14\"}):\n    hp.scope.value(0)  # 3.14 (float, precision preserved)\n</code></pre>"},{"location":"api_reference/#float-conversion","title":"Float Conversion","text":"<pre><code>with hp.scope(**{\"rate\": \"0.001\"}):\n    hp.scope.rate(0.0)  # 0.001\n</code></pre>"},{"location":"api_reference/#string-conversion","title":"String Conversion","text":"<pre><code>with hp.scope(**{\"count\": 42}):\n    hp.scope.count(\"0\")  # \"42\" (string)\n</code></pre>"},{"location":"api_reference/#thread-safety","title":"Thread Safety","text":""},{"location":"api_reference/#thread-isolation","title":"Thread Isolation","text":"<p>Each thread has its own parameter hp.scope. Changes in one thread do not affect others.</p> <pre><code>import threading\n\ndef worker():\n    with hp.scope(**{\"worker_id\": threading.current_thread().name}):\n        print(hp.scope.worker_id())\n\nthreads = [threading.Thread(target=worker) for _ in range(3)]\nfor t in threads:\n    t.start()\nfor t in threads:\n    t.join()\n</code></pre>"},{"location":"api_reference/#propagating-to-new-threads","title":"Propagating to New Threads","text":"<p>Use <code>frozen()</code> to propagate values to new threads:</p> <pre><code>with hp.scope(**{\"global_config\": 42}):\n    hp.scope.frozen()\n\ndef worker():\n    print(hp.scope.global_config())  # 42\n\nt = threading.Thread(target=worker)\nt.start()\nt.join()\n</code></pre>"},{"location":"api_reference/#error-handling","title":"Error Handling","text":""},{"location":"api_reference/#keyerror","title":"KeyError","text":"<p>Raised when accessing a required parameter that is missing:</p> <pre><code>with hp.scope():\n    hp.scope.missing()  # Raises KeyError\n</code></pre>"},{"location":"api_reference/#safe-access","title":"Safe Access","text":"<p>Always provide a default to avoid KeyError:</p> <pre><code>with hp.scope():\n    hp.scope.missing | \"default\"  # Returns \"default\"\n    hp.scope.missing(\"default\")   # Returns \"default\"\n</code></pre>"},{"location":"api_reference/#advanced-features","title":"Advanced Features","text":""},{"location":"api_reference/#nested-dictionary-flattening","title":"Nested Dictionary Flattening","text":"<p>Nested dictionaries are automatically flattened:</p> <pre><code>with hp.scope(**{\"model\": {\"hidden\": 256, \"layers\": 4}}):\n    print(scope[\"model.hidden\"]())  # 256\n    print(hp.scope.model.layers())     # 4\n</code></pre>"},{"location":"api_reference/#dynamic-key-construction","title":"Dynamic Key Construction","text":"<pre><code>for task in [\"train\", \"eval\"]:\n    key = f\"config.{task}.batch_size\"\n    value = getattr(hp.scope.config, task).batch_size | 32\n</code></pre>"},{"location":"api_reference/#accessing-underlying-storage","title":"Accessing Underlying Storage","text":"<pre><code>with hp.scope(**{\"a\": 1, \"b\": 2}) as ps:\n    storage = ps.storage()\n    print(storage.storage())  # {'a': 1, 'b': 2}\n</code></pre>"},{"location":"api_reference/#command-line-tool-hp","title":"Command Line Tool: hp","text":"<p>Hyperparameter provides a CLI tool <code>hp</code> for analyzing hyperparameters in Python packages.</p>"},{"location":"api_reference/#installation","title":"Installation","text":"<p>After installing hyperparameter, the <code>hp</code> command is available:</p> <pre><code>pip install hyperparameter\nhp --help\n</code></pre>"},{"location":"api_reference/#commands","title":"Commands","text":""},{"location":"api_reference/#hp-list-hp-ls","title":"hp list / hp ls","text":"<p>List hyperparameters:</p> <pre><code># List all packages using hyperparameter\nhp ls\nhp list\n\n# List hyperparameters in a package\nhp ls mypackage\n\n# Tree view\nhp ls mypackage --tree\nhp ls mypackage -t\n\n# Scope options\nhp ls mypackage --self       # Only self (default)\nhp ls mypackage --all        # Include dependencies\nhp ls mypackage --deps       # Only dependencies\n\n# Output formats\nhp ls mypackage -f text      # Default text format\nhp ls mypackage -f markdown  # Markdown format\nhp ls mypackage -f json      # JSON format\n\n# Save to file\nhp ls mypackage -o report.md -f markdown\n</code></pre>"},{"location":"api_reference/#package-discovery","title":"Package Discovery","text":"<p>When running <code>hp ls</code> without arguments, it scans all installed packages:</p> <pre><code>Packages using hyperparameter (3):\n============================================================\nPackage                        Version      Params   Funcs\n------------------------------------------------------------\nmyapp                          1.0.0        15       5\nml-toolkit                     0.2.1        8        3\nconfig-manager                 2.1.0        4        2\n------------------------------------------------------------\n\nUse 'hp ls &lt;package&gt;' to see hyperparameters in a package.\n</code></pre>"},{"location":"api_reference/#hp-describe-hp-desc","title":"hp describe / hp desc","text":"<p>View hyperparameter details:</p> <pre><code># Exact match\nhp desc train.lr mypackage\n\n# Fuzzy search\nhp desc lr mypackage\n\n# Default to current directory\nhp desc train.lr\n</code></pre>"},{"location":"api_reference/#example-output","title":"Example Output","text":""},{"location":"api_reference/#list-tree-view","title":"List (Tree View)","text":"<pre><code>Hyperparameters in myapp:\n----------------------------------------\n\ud83d\udcc1 train\n  \ud83d\udcc4 lr = 0.001\n  \ud83d\udcc4 batch_size = 32\n  \ud83d\udcc4 epochs = 10\n\ud83d\udcc1 model\n  \ud83d\udcc4 hidden_size = 256\n  \ud83d\udcc4 dropout = 0.1\n\nTotal: 5 hyperparameters\n</code></pre>"},{"location":"api_reference/#describe","title":"Describe","text":"<pre><code>============================================================\nHyperparameter: train.lr\n============================================================\n\n  Default: 0.001\n  Type: float\n  Namespace: train\n  Function: train\n\n  Source: myapp\n  Location: train.py:15\n\n  Description: Training function with configurable learning rate.\n\n  Usage:\n    # Access via scope\n    value = hp.scope.train.lr | &lt;default&gt;\n\n    # Set via command line\n    --train.lr=&lt;value&gt;\n</code></pre>"},{"location":"api_reference.zh/","title":"API \u53c2\u8003","text":"<ul> <li>English</li> </ul>"},{"location":"api_reference.zh/#api","title":"API \u53c2\u8003\u6587\u6863","text":"<p>\u672c\u6587\u6863\u63d0\u4f9b Hyperparameter Python API \u7684\u5b8c\u6574\u53c2\u8003\u3002</p>"},{"location":"api_reference.zh/#scope","title":"scope","text":"<p><code>scope</code> \u662f\u7ba1\u7406\u8d85\u53c2\u6570\u7684\u6838\u5fc3\u7c7b\uff0c\u63d0\u4f9b\u7ebf\u7a0b\u5b89\u5168\u7684\u4f5c\u7528\u57df\u63a7\u5236\u3002</p>"},{"location":"api_reference.zh/#_1","title":"\u5bfc\u5165","text":"<pre><code>import hyperparameter as hp\n</code></pre>"},{"location":"api_reference.zh/#scope_1","title":"\u521b\u5efa scope","text":"<pre><code># \u7a7a\u4f5c\u7528\u57df\nps = hp.scope()\n\n# \u4ece\u5173\u952e\u5b57\u53c2\u6570\u521b\u5efa\nps = hp.scope(lr=0.001, batch_size=32)\n\n# \u4ece\u5b57\u7b26\u4e32\u53c2\u6570\u521b\u5efa\uff08key=value \u683c\u5f0f\uff09\nps = hp.scope(\"lr=0.001\", \"batch_size=32\")\n\n# \u4ece\u5b57\u5178\u521b\u5efa\nps = hp.scope(**{\"train.lr\": 0.001, \"train.batch_size\": 32})\n\n# \u7a7a\u4f5c\u7528\u57df\uff08\u6e05\u9664\u7ee7\u627f\u7684\u503c\uff09\nps = hp.scope.empty()\nps = hp.scope.empty(lr=0.001)\n</code></pre>"},{"location":"api_reference.zh/#_2","title":"\u8bfb\u53d6\u53c2\u6570","text":"<pre><code># \u4f7f\u7528 | \u8fd0\u7b97\u7b26\uff08\u7f3a\u5931\u65f6\u8fd4\u56de\u9ed8\u8ba4\u503c\uff09\nlr = hp.scope.train.lr | 0.001\n\n# \u4f7f\u7528\u51fd\u6570\u8c03\u7528\uff08\u7f3a\u5931\u65f6\u8fd4\u56de\u9ed8\u8ba4\u503c\uff09\nlr = hp.scope.train.lr(0.001)\n\n# \u65e0\u9ed8\u8ba4\u503c\uff08\u7f3a\u5931\u65f6\u629b\u51fa KeyError\uff09\nlr = hp.scope.train.lr()\n\n# \u52a8\u6001 key \u8bbf\u95ee\nkey = \"train.lr\"\nlr = scope[key] | 0.001\n</code></pre>"},{"location":"api_reference.zh/#_3","title":"\u5199\u5165\u53c2\u6570","text":"<pre><code>with hp.scope() as ps:\n    # \u5c5e\u6027\u8d4b\u503c\n    hp.scope.train.lr = 0.001\n\n    # \u901a\u8fc7\u5b9e\u4f8b\n    ps.train.batch_size = 32\n</code></pre>"},{"location":"api_reference.zh/#with","title":"\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\uff08with \u8bed\u53e5\uff09","text":"<pre><code># \u57fa\u672c\u7528\u6cd5\nwith hp.scope(**{\"lr\": 0.001}):\n    print(hp.scope.lr())  # 0.001\n\n# \u5d4c\u5957\u4f5c\u7528\u57df\nwith hp.scope(**{\"a\": 1}):\n    print(hp.scope.a())  # 1\n    with hp.scope(**{\"a\": 2}):\n        print(hp.scope.a())  # 2\n    print(hp.scope.a())  # 1\uff08\u81ea\u52a8\u56de\u6eda\uff09\n</code></pre>"},{"location":"api_reference.zh/#_4","title":"\u9759\u6001\u65b9\u6cd5","text":""},{"location":"api_reference.zh/#hpscopeemptyargs-kwargs","title":"<code>hp.scope.empty(*args, **kwargs)</code>","text":"<p>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7a7a\u4f5c\u7528\u57df\uff0c\u6e05\u9664\u6240\u6709\u7ee7\u627f\u7684\u503c\u3002</p> <pre><code>with hp.scope(**{\"inherited\": 1}):\n    with hp.scope.empty(**{\"fresh\": 2}) as ps:\n        print(ps.inherited(\"missing\"))  # \"missing\"\n        print(ps.fresh())  # 2\n</code></pre>"},{"location":"api_reference.zh/#hpscopecurrent","title":"<code>hp.scope.current()</code>","text":"<p>\u8fd4\u56de\u5f53\u524d\u6d3b\u52a8\u7684\u4f5c\u7528\u57df\u3002</p> <pre><code>with hp.scope(**{\"key\": \"value\"}):\n    ps = hp.scope.current()\n    print(ps.key())  # \"value\"\n</code></pre>"},{"location":"api_reference.zh/#hpscopefrozen","title":"<code>hp.scope.frozen()</code>","text":"<p>\u5c06\u5f53\u524d\u4f5c\u7528\u57df\u5feb\u7167\u4e3a\u65b0\u7ebf\u7a0b\u7684\u5168\u5c40\u57fa\u7ebf\u3002</p> <pre><code>with hp.scope(**{\"global_config\": 42}):\n    hp.scope.frozen()\n    # \u65b0\u7ebf\u7a0b\u5c06\u7ee7\u627f global_config=42\n</code></pre>"},{"location":"api_reference.zh/#hpscopeinitparamsnone","title":"<code>hp.scope.init(params=None)</code>","text":"<p>\u4e3a\u65b0\u7ebf\u7a0b\u521d\u59cb\u5316 scope\u3002</p> <pre><code>def thread_target():\n    hp.scope.init({\"thread_param\": 1})\n    # ...\n</code></pre>"},{"location":"api_reference.zh/#_5","title":"\u5b9e\u4f8b\u65b9\u6cd5","text":""},{"location":"api_reference.zh/#pskeys","title":"<code>ps.keys()</code>","text":"<p>\u8fd4\u56de\u6240\u6709\u53c2\u6570 key \u7684\u53ef\u8fed\u4ee3\u5bf9\u8c61\u3002</p> <pre><code>with hp.scope(**{\"a\": 1, \"b.c\": 2}) as ps:\n    print(list(ps.keys()))  # ['a', 'b.c']\n</code></pre>"},{"location":"api_reference.zh/#psstorage","title":"<code>ps.storage()</code>","text":"<p>\u8fd4\u56de\u5e95\u5c42\u5b58\u50a8\u5bf9\u8c61\u3002</p>"},{"location":"api_reference.zh/#psupdatedict","title":"<code>ps.update(dict)</code>","text":"<p>\u4f7f\u7528\u5b57\u5178\u66f4\u65b0\u4f5c\u7528\u57df\u3002</p>"},{"location":"api_reference.zh/#psclear","title":"<code>ps.clear()</code>","text":"<p>\u6e05\u9664\u5f53\u524d\u4f5c\u7528\u57df\u4e2d\u7684\u6240\u6709\u53c2\u6570\u3002</p>"},{"location":"api_reference.zh/#hpparam","title":"@hp.param","text":"<p>\u88c5\u9970\u5668\uff0c\u81ea\u52a8\u5c06\u51fd\u6570\u53c2\u6570\u7ed1\u5b9a\u5230\u8d85\u53c2\u6570\u3002</p>"},{"location":"api_reference.zh/#_6","title":"\u5bfc\u5165","text":"<pre><code>import hyperparameter as hp\n</code></pre>"},{"location":"api_reference.zh/#_7","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>@hp.param(\"train\")\ndef train(lr=0.001, batch_size=32, epochs=10):\n    print(f\"lr={lr}, batch_size={batch_size}\")\n\n# \u4f7f\u7528\u51fd\u6570\u9ed8\u8ba4\u503c\ntrain()  # lr=0.001, batch_size=32\n\n# \u901a\u8fc7 scope \u8986\u76d6\nwith hp.scope(**{\"train.lr\": 0.01}):\n    train()  # lr=0.01, batch_size=32\n\n# \u76f4\u63a5\u4f20\u53c2\u4f18\u5148\u7ea7\u6700\u9ad8\ntrain(lr=0.1)  # lr=0.1, batch_size=32\n</code></pre>"},{"location":"api_reference.zh/#_8","title":"\u81ea\u5b9a\u4e49\u547d\u540d\u7a7a\u95f4","text":"<pre><code>@hp.param(\"myapp.config.train\")\ndef train(lr=0.001):\n    print(f\"lr={lr}\")\n\nwith hp.scope(**{\"myapp.config.train.lr\": 0.01}):\n    train()  # lr=0.01\n</code></pre>"},{"location":"api_reference.zh/#_9","title":"\u65e0\u547d\u540d\u7a7a\u95f4\uff08\u4f7f\u7528\u51fd\u6570\u540d\uff09","text":"<pre><code>@hp.param\ndef my_function(x=1):\n    return x\n\nwith hp.scope(**{\"my_function.x\": 2}):\n    my_function()  # \u8fd4\u56de 2\n</code></pre>"},{"location":"api_reference.zh/#_10","title":"\u7c7b\u88c5\u9970\u5668","text":"<pre><code>@hp.param(\"Model\")\nclass Model:\n    def __init__(self, hidden_size=256, dropout=0.1):\n        self.hidden_size = hidden_size\n        self.dropout = dropout\n\nwith hp.scope(**{\"Model.hidden_size\": 512}):\n    model = Model()  # hidden_size=512, dropout=0.1\n</code></pre>"},{"location":"api_reference.zh/#_11","title":"\u53c2\u6570\u89e3\u6790\u4f18\u5148\u7ea7","text":"<ol> <li>\u76f4\u63a5\u4f20\u53c2\uff08\u6700\u9ad8\u4f18\u5148\u7ea7\uff09</li> <li>scope \u8986\u76d6</li> <li>\u51fd\u6570\u7b7e\u540d\u9ed8\u8ba4\u503c\uff08\u6700\u4f4e\u4f18\u5148\u7ea7\uff09</li> </ol>"},{"location":"api_reference.zh/#launch","title":"launch","text":"<p>CLI \u5e94\u7528\u7a0b\u5e8f\u5165\u53e3\uff0c\u652f\u6301\u81ea\u52a8\u53c2\u6570\u89e3\u6790\u3002</p>"},{"location":"api_reference.zh/#_12","title":"\u5bfc\u5165","text":"<pre><code>import hyperparameter as hp\n</code></pre>"},{"location":"api_reference.zh/#_13","title":"\u5355\u51fd\u6570\u6a21\u5f0f","text":"<pre><code>@hp.param(\"app\")\ndef main(input_file, output_file=\"out.txt\", verbose=False):\n    \"\"\"\u5904\u7406\u8f93\u5165\u6587\u4ef6\u3002\n\n    Args:\n        input_file: \u8f93\u5165\u6587\u4ef6\u8def\u5f84\n        output_file: \u8f93\u51fa\u6587\u4ef6\u8def\u5f84\n        verbose: \u542f\u7528\u8be6\u7ec6\u8f93\u51fa\n    \"\"\"\n    pass\n\nif __name__ == \"__main__\":\n    hp.launch(main)\n</code></pre> <p>\u8fd0\u884c\uff1a <pre><code>python app.py input.txt --output_file result.txt --verbose\npython app.py input.txt -D app.verbose=true\n</code></pre></p>"},{"location":"api_reference.zh/#_14","title":"\u591a\u51fd\u6570\u6a21\u5f0f\uff08\u5b50\u547d\u4ee4\uff09","text":"<pre><code>@hp.param(\"train\")\ndef train(epochs=10, lr=0.001):\n    \"\"\"\u8bad\u7ec3\u6a21\u578b\u3002\"\"\"\n    pass\n\n@hp.param(\"eval\")\ndef evaluate(checkpoint=\"model.pt\"):\n    \"\"\"\u8bc4\u4f30\u6a21\u578b\u3002\"\"\"\n    pass\n\nif __name__ == \"__main__\":\n    hp.launch()  # \u81ea\u52a8\u53d1\u73b0\u6240\u6709 @hp.param \u51fd\u6570\n</code></pre> <p>\u8fd0\u884c\uff1a <pre><code>python app.py train --epochs 20\npython app.py eval --checkpoint best.pt\n</code></pre></p>"},{"location":"api_reference.zh/#cli","title":"CLI \u9009\u9879","text":"\u9009\u9879 \u8bf4\u660e <code>-D, --define KEY=VALUE</code> \u8986\u76d6\u8d85\u53c2\u6570 <code>-lps, --list-param-scope</code> \u5217\u51fa\u6240\u6709\u6ce8\u518c\u7684\u53c2\u6570 <code>-ep, --explain-param KEY</code> \u663e\u793a\u53c2\u6570\u8be6\u60c5 <code>-h, --help</code> \u663e\u793a\u5e2e\u52a9\u4fe1\u606f"},{"location":"api_reference.zh/#launch_1","title":"launch","text":"<p><code>launch</code> \u7684\u66ff\u4ee3\u65b9\u6848\uff0c\u884c\u4e3a\u7565\u6709\u4e0d\u540c\u3002</p> <pre><code>import hyperparameter as hp\n\nif __name__ == \"__main__\":\n    hp.launch()\n</code></pre>"},{"location":"api_reference.zh/#_15","title":"\u7c7b\u578b\u8f6c\u6362","text":"<p>\u8bfb\u53d6\u53c2\u6570\u65f6\uff0c\u4f1a\u6839\u636e\u9ed8\u8ba4\u503c\u7684\u7c7b\u578b\u81ea\u52a8\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\u3002</p>"},{"location":"api_reference.zh/#_16","title":"\u5e03\u5c14\u503c\u8f6c\u6362","text":"<pre><code>with hp.scope(**{\"flag\": \"true\"}):\n    hp.scope.flag(False)  # True\n\n# \u8bc6\u522b\u7684\u771f\u503c: \"true\", \"True\", \"TRUE\", \"t\", \"T\", \"yes\", \"YES\", \"y\", \"Y\", \"1\", \"on\", \"ON\"\n# \u8bc6\u522b\u7684\u5047\u503c: \"false\", \"False\", \"FALSE\", \"f\", \"F\", \"no\", \"NO\", \"n\", \"N\", \"0\", \"off\", \"OFF\"\n</code></pre>"},{"location":"api_reference.zh/#_17","title":"\u6574\u6570\u8f6c\u6362","text":"<pre><code>with hp.scope(**{\"count\": \"42\"}):\n    hp.scope.count(0)  # 42 (int)\n\nwith hp.scope(**{\"value\": \"3.14\"}):\n    hp.scope.value(0)  # 3.14 (float\uff0c\u4fdd\u7559\u7cbe\u5ea6)\n</code></pre>"},{"location":"api_reference.zh/#_18","title":"\u6d6e\u70b9\u6570\u8f6c\u6362","text":"<pre><code>with hp.scope(**{\"rate\": \"0.001\"}):\n    hp.scope.rate(0.0)  # 0.001\n</code></pre>"},{"location":"api_reference.zh/#_19","title":"\u5b57\u7b26\u4e32\u8f6c\u6362","text":"<pre><code>with hp.scope(**{\"count\": 42}):\n    hp.scope.count(\"0\")  # \"42\" (string)\n</code></pre>"},{"location":"api_reference.zh/#_20","title":"\u7ebf\u7a0b\u5b89\u5168","text":""},{"location":"api_reference.zh/#_21","title":"\u7ebf\u7a0b\u9694\u79bb","text":"<p>\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1\u7684\u53c2\u6570\u4f5c\u7528\u57df\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u7684\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u7ebf\u7a0b\u3002</p> <pre><code>import threading\n\ndef worker():\n    with hp.scope(**{\"worker_id\": threading.current_thread().name}):\n        print(hp.scope.worker_id())\n\nthreads = [threading.Thread(target=worker) for _ in range(3)]\nfor t in threads:\n    t.start()\nfor t in threads:\n    t.join()\n</code></pre>"},{"location":"api_reference.zh/#_22","title":"\u4f20\u64ad\u5230\u65b0\u7ebf\u7a0b","text":"<p>\u4f7f\u7528 <code>frozen()</code> \u5c06\u503c\u4f20\u64ad\u5230\u65b0\u7ebf\u7a0b\uff1a</p> <pre><code>with hp.scope(**{\"global_config\": 42}):\n    hp.scope.frozen()\n\ndef worker():\n    print(hp.scope.global_config())  # 42\n\nt = threading.Thread(target=worker)\nt.start()\nt.join()\n</code></pre>"},{"location":"api_reference.zh/#_23","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"api_reference.zh/#keyerror","title":"KeyError","text":"<p>\u8bbf\u95ee\u7f3a\u5931\u7684\u5fc5\u9700\u53c2\u6570\u65f6\u629b\u51fa\uff1a</p> <pre><code>with hp.scope():\n    hp.scope.missing()  # \u629b\u51fa KeyError\n</code></pre>"},{"location":"api_reference.zh/#_24","title":"\u5b89\u5168\u8bbf\u95ee","text":"<p>\u59cb\u7ec8\u63d0\u4f9b\u9ed8\u8ba4\u503c\u4ee5\u907f\u514d KeyError\uff1a</p> <pre><code>with hp.scope():\n    hp.scope.missing | \"default\"  # \u8fd4\u56de \"default\"\n    hp.scope.missing(\"default\")   # \u8fd4\u56de \"default\"\n</code></pre>"},{"location":"api_reference.zh/#_25","title":"\u9ad8\u7ea7\u7279\u6027","text":""},{"location":"api_reference.zh/#_26","title":"\u5d4c\u5957\u5b57\u5178\u5c55\u5e73","text":"<p>\u5d4c\u5957\u5b57\u5178\u4f1a\u81ea\u52a8\u5c55\u5e73\uff1a</p> <pre><code>with hp.scope(**{\"model\": {\"hidden\": 256, \"layers\": 4}}):\n    print(scope[\"model.hidden\"]())  # 256\n    print(hp.scope.model.layers())     # 4\n</code></pre>"},{"location":"api_reference.zh/#key","title":"\u52a8\u6001 key \u6784\u9020","text":"<pre><code>for task in [\"train\", \"eval\"]:\n    key = f\"config.{task}.batch_size\"\n    value = getattr(hp.scope.config, task).batch_size | 32\n</code></pre>"},{"location":"api_reference.zh/#_27","title":"\u8bbf\u95ee\u5e95\u5c42\u5b58\u50a8","text":"<pre><code>with hp.scope(**{\"a\": 1, \"b\": 2}) as ps:\n    storage = ps.storage()\n    print(storage.storage())  # {'a': 1, 'b': 2}\n</code></pre>"},{"location":"api_reference.zh/#rust","title":"Rust \u63a5\u53e3","text":""},{"location":"api_reference.zh/#with_params","title":"with_params! \u5b8f","text":"<pre><code>use hyperparameter::*;\n\nfn main() {\n    with_params! {\n        // \u8bbe\u7f6e\u53c2\u6570\n        set train.lr = 0.001f64;\n        set train.batch_size = 32i64;\n\n        // \u8bfb\u53d6\u53c2\u6570\n        get lr = train.lr or 0.001f64;\n        get batch_size = train.batch_size or 32i64;\n\n        println!(\"lr={}, batch_size={}\", lr, batch_size);\n    };\n}\n</code></pre>"},{"location":"api_reference.zh/#_28","title":"\u53c2\u6570\u8bbe\u7f6e","text":"<pre><code>with_params! {\n    set key = value;  // \u8bbe\u7f6e\u53c2\u6570\n}\n</code></pre>"},{"location":"api_reference.zh/#_29","title":"\u53c2\u6570\u8bfb\u53d6","text":"<pre><code>with_params! {\n    get var = key or default;  // \u8bfb\u53d6\u53c2\u6570\uff0c\u63d0\u4f9b\u9ed8\u8ba4\u503c\n}\n</code></pre>"},{"location":"api_reference.zh/#frozen","title":"frozen()","text":"<pre><code>with_params! {\n    set global.config = 42i64;\n    frozen();  // \u5feb\u7167\u4e3a\u5168\u5c40\u57fa\u7ebf\n};\n</code></pre>"},{"location":"api_reference.zh/#paramscope","title":"ParamScope","text":"<pre><code>use hyperparameter::ParamScope;\n\nlet ps = ParamScope::from(&amp;[\"key=value\".to_string()]);\nwith_params! {\n    params ps;\n    // ...\n};\n</code></pre>"},{"location":"api_reference.zh/#_30","title":"\u5b58\u50a8\u540e\u7aef","text":""},{"location":"api_reference.zh/#python","title":"Python \u540e\u7aef","text":"<p>\u7eaf Python \u5b9e\u73b0\uff0c\u4f7f\u7528 <code>ContextVar</code> \u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u3002</p>"},{"location":"api_reference.zh/#rust_1","title":"Rust \u540e\u7aef","text":"<p>\u9ad8\u6027\u80fd Rust \u5b9e\u73b0\uff0c\u63d0\u4f9b\uff1a - \u7f16\u8bd1\u65f6 key \u54c8\u5e0c - \u66f4\u5feb\u7684\u53c2\u6570\u8bbf\u95ee - \u8de8\u8bed\u8a00\u4e00\u81f4\u6027</p> <p>\u68c0\u67e5\u540e\u7aef\uff1a</p> <pre><code>from hyperparameter.storage import has_rust_backend\nprint(has_rust_backend)  # True/False\n</code></pre> <p>\u5f3a\u5236\u4f7f\u7528 Python \u540e\u7aef\uff1a</p> <pre><code>export HYPERPARAMETER_BACKEND=PYTHON\n</code></pre>"},{"location":"api_reference.zh/#hp","title":"\u547d\u4ee4\u884c\u5de5\u5177\uff1ahp","text":"<p>Hyperparameter \u63d0\u4f9b <code>hp</code> \u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u5206\u6790 Python \u5305\u4e2d\u7684\u8d85\u53c2\u6570\u4f7f\u7528\u60c5\u51b5\u3002</p>"},{"location":"api_reference.zh/#_31","title":"\u5b89\u88c5","text":"<p>\u5b89\u88c5 hyperparameter \u540e\uff0c<code>hp</code> \u547d\u4ee4\u5373\u53ef\u4f7f\u7528\uff1a</p> <pre><code>pip install hyperparameter\nhp --help\n</code></pre>"},{"location":"api_reference.zh/#_32","title":"\u547d\u4ee4","text":""},{"location":"api_reference.zh/#hp-list-hp-ls","title":"hp list / hp ls","text":"<p>\u5217\u51fa\u8d85\u53c2\u6570\uff1a</p> <pre><code># \u5217\u51fa\u6240\u6709\u4f7f\u7528 hyperparameter \u7684\u5305\nhp ls\nhp list\n\n# \u5217\u51fa\u5305\u4e2d\u7684\u8d85\u53c2\u6570\nhp ls mypackage\n\n# \u6811\u72b6\u663e\u793a\nhp ls mypackage --tree\nhp ls mypackage -t\n\n# \u8303\u56f4\u9009\u9879\nhp ls mypackage --self       # \u4ec5\u81ea\u8eab\uff08\u9ed8\u8ba4\uff09\nhp ls mypackage --all        # \u5305\u542b\u4f9d\u8d56\nhp ls mypackage --deps       # \u4ec5\u4f9d\u8d56\n\n# \u8f93\u51fa\u683c\u5f0f\nhp ls mypackage -f text      # \u9ed8\u8ba4\u6587\u672c\u683c\u5f0f\nhp ls mypackage -f markdown  # Markdown \u683c\u5f0f\nhp ls mypackage -f json      # JSON \u683c\u5f0f\n\n# \u4fdd\u5b58\u5230\u6587\u4ef6\nhp ls mypackage -o report.md -f markdown\n</code></pre>"},{"location":"api_reference.zh/#_33","title":"\u5305\u53d1\u73b0","text":"<p>\u4e0d\u5e26\u53c2\u6570\u8fd0\u884c <code>hp ls</code> \u65f6\uff0c\u4f1a\u626b\u63cf\u6240\u6709\u5df2\u5b89\u88c5\u7684\u5305\uff1a</p> <pre><code>Packages using hyperparameter (3):\n============================================================\nPackage                        Version      Params   Funcs\n------------------------------------------------------------\nmyapp                          1.0.0        15       5\nml-toolkit                     0.2.1        8        3\nconfig-manager                 2.1.0        4        2\n------------------------------------------------------------\n\nUse 'hp ls &lt;package&gt;' to see hyperparameters in a package.\n</code></pre>"},{"location":"api_reference.zh/#hp-describe-hp-desc","title":"hp describe / hp desc","text":"<p>\u67e5\u770b\u8d85\u53c2\u6570\u8be6\u60c5\uff1a</p> <pre><code># \u7cbe\u786e\u5339\u914d\nhp desc train.lr mypackage\n\n# \u6a21\u7cca\u641c\u7d22\nhp desc lr mypackage\n\n# \u9ed8\u8ba4\u5f53\u524d\u76ee\u5f55\nhp desc train.lr\n</code></pre>"},{"location":"api_reference.zh/#_34","title":"\u793a\u4f8b\u8f93\u51fa","text":""},{"location":"api_reference.zh/#_35","title":"\u5217\u8868\uff08\u6811\u72b6\u89c6\u56fe\uff09","text":"<pre><code>Hyperparameters in myapp:\n----------------------------------------\n\ud83d\udcc1 train\n  \ud83d\udcc4 lr = 0.001\n  \ud83d\udcc4 batch_size = 32\n  \ud83d\udcc4 epochs = 10\n\ud83d\udcc1 model\n  \ud83d\udcc4 hidden_size = 256\n  \ud83d\udcc4 dropout = 0.1\n\nTotal: 5 hyperparameters\n</code></pre>"},{"location":"api_reference.zh/#_36","title":"\u63cf\u8ff0","text":"<pre><code>============================================================\nHyperparameter: train.lr\n============================================================\n\n  Default: 0.001\n  Type: float\n  Namespace: train\n  Function: train\n\n  Source: myapp\n  Location: train.py:15\n\n  Description: Training function with configurable learning rate.\n\n  Usage:\n    # \u901a\u8fc7 scope \u8bbf\u95ee\n    value = hp.scope.train.lr | &lt;default&gt;\n\n    # \u901a\u8fc7\u547d\u4ee4\u884c\u8bbe\u7f6e\n    --train.lr=&lt;value&gt;\n</code></pre>"},{"location":"api_reference.zh/#_37","title":"\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u9879\u76ee\u5ba1\u8ba1\uff1a\u5feb\u901f\u4e86\u89e3\u9879\u76ee\u4e2d\u6240\u6709\u53ef\u914d\u7f6e\u7684\u8d85\u53c2\u6570</li> <li>\u6587\u6863\u751f\u6210\uff1a\u81ea\u52a8\u751f\u6210\u8d85\u53c2\u6570\u6587\u6863</li> <li>\u4f9d\u8d56\u5206\u6790\uff1a\u53d1\u73b0\u4f9d\u8d56\u5e93\u4e2d\u7684\u8d85\u53c2\u6570\uff0c\u7edf\u4e00\u7ba1\u7406</li> <li>\u4ee3\u7801\u5ba1\u67e5\uff1a\u68c0\u67e5\u8d85\u53c2\u6570\u4f7f\u7528\u662f\u5426\u89c4\u8303</li> </ol>"},{"location":"architecture/","title":"Architecture","text":"<ul> <li>\u4e2d\u6587</li> </ul>"},{"location":"architecture/#architecture-overview","title":"Architecture Overview","text":"<p>This document explains the internal architecture of Hyperparameter, including how the Rust backend and Python frontend work together.</p>"},{"location":"architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Python User Code                         \u2502\n\u2502  @hp.param, scope, hp.config(), etc.              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Python API Layer                           \u2502\n\u2502  hyperparameter/api.py, hyperparameter/cli.py               \u2502\n\u2502  - Decorators (@hp.param)                                 \u2502\n\u2502  - Context managers (scope)                           \u2502\n\u2502  - CLI argument parsing                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Storage Abstraction                        \u2502\n\u2502  hyperparameter/storage.py                                  \u2502\n\u2502  - TLSKVStorage (Thread-Local Storage)                      \u2502\n\u2502  - Automatic backend selection                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u25bc                               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Rust Backend          \u2502    \u2502   Python Fallback Backend    \u2502\n\u2502   (librbackend.so)      \u2502    \u2502   (Pure Python dict)         \u2502\n\u2502   - xxhash for keys     \u2502    \u2502   - Used when Rust unavailable\u2502\n\u2502   - Thread-local storage\u2502    \u2502   - Same API contract         \u2502\n\u2502   - Lock-free reads     \u2502    \u2502                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#component-details","title":"Component Details","text":""},{"location":"architecture/#1-python-api-layer-hyperparameterapipy","title":"1. Python API Layer (<code>hyperparameter/api.py</code>)","text":"<p>This is what users interact with directly.</p> <p>Key Classes:</p> <ul> <li> <p><code>scope</code>: A context manager that creates a new parameter hp.scope.   <pre><code>with hp.scope(foo=1, bar=2) as ps:\n    # ps.foo() returns 1\n    # Nested scopes inherit from parent\n</code></pre></p> </li> <li> <p><code>_ParamAccessor</code>: Handles the <code>hp.scope.x.y.z | default</code> syntax.   <pre><code># This chain: hp.scope.model.layers.size | 10\n# Creates: _ParamAccessor(root, \"model.layers.size\")\n# The `|` operator calls get_or_else(10)\n</code></pre></p> </li> <li> <p><code>param</code> decorator: Inspects function signature and injects values.   <pre><code>@hp.param(\"model\")\ndef foo(hidden_size=256):  # Looks up \"model.hidden_size\"\n    pass\n</code></pre></p> </li> </ul>"},{"location":"architecture/#2-storage-layer-hyperparameterstoragepy","title":"2. Storage Layer (<code>hyperparameter/storage.py</code>)","text":"<p>The storage layer abstracts the underlying key-value store.</p> <p>Key Features:</p> <ul> <li>Thread-Local Storage (TLS): Each thread has its own parameter stack.</li> <li>Scoped Updates: Changes are local to the current scope and roll back on exit.</li> <li>Backend Selection: Automatically uses Rust backend if available.</li> </ul> <pre><code>class TLSKVStorage:\n    \"\"\"Thread-local key-value storage with scope stack.\"\"\"\n\n    def enter(self):\n        \"\"\"Push a new scope onto the stack.\"\"\"\n\n    def exit(self):\n        \"\"\"Pop the current scope, rolling back changes.\"\"\"\n\n    def get(self, key: str) -&gt; Any:\n        \"\"\"Look up key in current scope, then parent scopes.\"\"\"\n\n    def put(self, key: str, value: Any):\n        \"\"\"Set key in current scope only.\"\"\"\n</code></pre>"},{"location":"architecture/#3-rust-backend-srccore-srcpy","title":"3. Rust Backend (<code>src/core/</code>, <code>src/py/</code>)","text":"<p>The Rust backend provides high-performance parameter access.</p> <p>Why Rust?</p> <ol> <li> <p>Compile-time key hashing: Keys like <code>\"model.layers.size\"</code> are hashed at compile time using <code>xxhash</code>, eliminating runtime string hashing overhead.</p> </li> <li> <p>Lock-free reads: Thread-local storage means no mutex contention on reads.</p> </li> <li> <p>Zero-copy string handling: Rust's string handling avoids Python's string interning overhead.</p> </li> </ol> <p>Key Rust Components:</p> <pre><code>// src/core/src/storage.rs\npub struct ThreadLocalStorage {\n    stack: Vec&lt;HashMap&lt;u64, Value&gt;&gt;,  // Scope stack\n}\n\n// src/core/src/xxh.rs\npub const fn xxhash(s: &amp;str) -&gt; u64 {\n    // Compile-time xxhash64\n}\n\n// src/core/src/api.rs\npub fn get_param&lt;T&gt;(key_hash: u64, default: T) -&gt; T {\n    // Fast lookup by pre-computed hash\n}\n</code></pre> <p>Python Binding (<code>src/py/</code>):</p> <p>Uses PyO3 to expose Rust functions to Python:</p> <pre><code>#[pyfunction]\nfn get_entry(key_hash: u64) -&gt; PyResult&lt;PyObject&gt; {\n    // Called from Python with pre-computed hash\n}\n</code></pre>"},{"location":"architecture/#4-config-loader-hyperparameterloaderpy","title":"4. Config Loader (<code>hyperparameter/loader.py</code>)","text":"<p>The loader handles configuration file parsing and processing.</p> <p>Pipeline:</p> <pre><code>File(s) \u2192 Parse \u2192 Merge \u2192 Interpolate \u2192 Validate \u2192 Dict/Object\n</code></pre> <ol> <li>Parse: Support for TOML, JSON, YAML</li> <li>Merge: Deep merge multiple configs (later overrides earlier)</li> <li>Interpolate: Resolve <code>${variable}</code> references</li> <li>Validate: Optional schema validation against class type hints</li> </ol> <pre><code>def load(path, schema=None):\n    config = _load_and_merge(path)\n    config = _resolve_interpolations(config)\n    if schema:\n        return validate(config, schema)\n    return config\n</code></pre>"},{"location":"architecture/#data-flow-example","title":"Data Flow Example","text":"<p>Let's trace what happens when you run:</p> <pre><code>import hyperparameter as hp\n\n@hp.param(\"model\")\ndef train(lr=0.001):\n    print(lr)\n\nwith hp.scope(**{\"model.lr\": 0.01}):\n    train()\n</code></pre> <p>Step-by-step:</p> <ol> <li><code>scope(**{\"model.lr\": 0.01})</code>:</li> <li>Creates new <code>TLSKVStorage</code> scope</li> <li>Computes hash: <code>xxhash(\"model.lr\")</code> \u2192 <code>0x1234...</code></li> <li> <p>Stores: <code>{0x1234...: 0.01}</code> in current thread's scope stack</p> </li> <li> <p><code>train()</code> called:</p> </li> <li><code>@hp.param</code> wrapper runs</li> <li>For each kwarg with default (<code>lr=0.001</code>):<ul> <li>Computes hash: <code>xxhash(\"model.lr\")</code></li> <li>Calls <code>storage.get_entry(0x1234...)</code></li> <li>Rust backend returns <code>0.01</code></li> </ul> </li> <li> <p>Calls <code>train(lr=0.01)</code></p> </li> <li> <p>Scope exit:</p> </li> <li><code>hp.scope.__exit__()</code> called</li> <li>Pops scope from stack</li> <li><code>model.lr</code> no longer accessible</li> </ol>"},{"location":"architecture/#performance-characteristics","title":"Performance Characteristics","text":""},{"location":"architecture/#why-hyperparameter-is-fast","title":"Why Hyperparameter is Fast","text":"Operation Hydra/OmegaConf Hyperparameter Key lookup String hash at runtime Pre-computed xxhash Type checking On every access Optional, at load time Thread safety Global lock Thread-local (no lock) Memory Python dicts + wrappers Rust HashMap"},{"location":"architecture/#when-to-use-which-access-pattern","title":"When to Use Which Access Pattern","text":"Pattern Speed Use Case <code>@hp.param</code> injection \ud83d\ude80\ud83d\ude80\ud83d\ude80 Fastest Hot loops, performance-critical <code>with hp.scope() as ps: ps.x</code> \ud83d\ude80\ud83d\ude80 Fast Most code <code>hp.scope.x</code> (global) \ud83d\ude80 Moderate Convenience, one-off access"},{"location":"architecture/#thread-safety-model","title":"Thread Safety Model","text":"<pre><code>Thread 1                    Thread 2\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nhp.scope(a=1)           \n\u2502                          scope(a=2)\n\u2502   a = 1                  \u2502   a = 2\n\u2502                          \u2502\n\u2514\u2500\u2500 exit                   \u2514\u2500\u2500 exit\n    a = undefined              a = undefined\n</code></pre> <p>Each thread has independent scope stacks. Changes in one thread never affect another.</p> <p><code>frozen()</code> for cross-thread defaults:</p> <pre><code>with hp.scope(a=1):\n    hp.scope.frozen()  # Snapshot current scope as global default\n\n# New threads will see a=1 as their initial state\n</code></pre>"},{"location":"architecture/#extending-hyperparameter","title":"Extending Hyperparameter","text":""},{"location":"architecture/#custom-storage-backend","title":"Custom Storage Backend","text":"<pre><code>from hyperparameter.storage import TLSKVStorage\n\nclass RedisBackedStorage(TLSKVStorage):\n    \"\"\"Example: Redis-backed storage for distributed systems.\"\"\"\n\n    def get(self, key):\n        # Try local first\n        value = super().get(key)\n        if value is None:\n            # Fall back to Redis\n            value = self.redis.get(key)\n        return value\n</code></pre>"},{"location":"architecture/#custom-type-coercion","title":"Custom Type Coercion","text":"<pre><code>from hyperparameter.loader import _coerce_type\n\ndef _coerce_type(value, target_type):\n    # Add custom type handling\n    if target_type is MyCustomType:\n        return MyCustomType.from_string(value)\n    # ... existing logic\n</code></pre>"},{"location":"architecture/#file-structure","title":"File Structure","text":"<pre><code>hyperparameter/\n\u251c\u2500\u2500 __init__.py          # Public API exports\n\u251c\u2500\u2500 api.py               # Core Python API (scope, param)\n\u251c\u2500\u2500 cli.py               # CLI support (launch, launch)\n\u251c\u2500\u2500 loader.py            # Config loading, interpolation, validation\n\u251c\u2500\u2500 storage.py           # Storage abstraction, TLS\n\u2514\u2500\u2500 tune.py              # Hyperparameter tuning utilities\n\nsrc/\n\u251c\u2500\u2500 core/                # Rust core library\n\u2502   \u2514\u2500\u2500 src/\n\u2502       \u251c\u2500\u2500 api.rs       # Public Rust API\n\u2502       \u251c\u2500\u2500 storage.rs   # Thread-local storage\n\u2502       \u251c\u2500\u2500 value.rs     # Value type handling\n\u2502       \u2514\u2500\u2500 xxh.rs       # Compile-time xxhash\n\u251c\u2500\u2500 macros/              # Rust procedural macros\n\u2514\u2500\u2500 py/                  # PyO3 Python bindings\n</code></pre>"},{"location":"architecture.zh/","title":"\u67b6\u6784\u6982\u8ff0","text":"<ul> <li>English</li> </ul>"},{"location":"architecture.zh/#_1","title":"\u67b6\u6784\u6982\u8ff0","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd Hyperparameter \u7684\u5185\u90e8\u67b6\u6784\uff0c\u5305\u62ec Rust \u540e\u7aef\u548c Python \u524d\u7aef\u5982\u4f55\u534f\u540c\u5de5\u4f5c\u3002</p>"},{"location":"architecture.zh/#_2","title":"\u6574\u4f53\u67b6\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Python \u7528\u6237\u4ee3\u7801                          \u2502\n\u2502  @hp.param, scope, hp.config() \u7b49                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Python API \u5c42                              \u2502\n\u2502  hyperparameter/api.py, hyperparameter/cli.py               \u2502\n\u2502  - \u88c5\u9970\u5668 (@hp.param)                                     \u2502\n\u2502  - \u4e0a\u4e0b\u6587\u7ba1\u7406\u5668 (scope)                                \u2502\n\u2502  - CLI \u53c2\u6570\u89e3\u6790                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   \u5b58\u50a8\u62bd\u8c61\u5c42                                  \u2502\n\u2502  hyperparameter/storage.py                                  \u2502\n\u2502  - TLSKVStorage (\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8)                               \u2502\n\u2502  - \u81ea\u52a8\u540e\u7aef\u9009\u62e9                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u25bc                               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Rust \u540e\u7aef             \u2502    \u2502   Python \u56de\u9000\u540e\u7aef            \u2502\n\u2502   (librbackend.so)      \u2502    \u2502   (\u7eaf Python \u5b57\u5178)          \u2502\n\u2502   - xxhash \u952e\u54c8\u5e0c       \u2502    \u2502   - Rust \u4e0d\u53ef\u7528\u65f6\u4f7f\u7528        \u2502\n\u2502   - \u7ebf\u7a0b\u672c\u5730\u5b58\u50a8        \u2502    \u2502   - \u76f8\u540c\u7684 API \u5951\u7ea6          \u2502\n\u2502   - \u65e0\u9501\u8bfb\u53d6            \u2502    \u2502                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture.zh/#_3","title":"\u7ec4\u4ef6\u8be6\u89e3","text":""},{"location":"architecture.zh/#1-python-api-hyperparameterapipy","title":"1. Python API \u5c42 (<code>hyperparameter/api.py</code>)","text":"<p>\u8fd9\u662f\u7528\u6237\u76f4\u63a5\u4ea4\u4e92\u7684\u90e8\u5206\u3002</p> <p>\u6838\u5fc3\u7c7b:</p> <ul> <li> <p><code>scope</code>: \u521b\u5efa\u65b0\u53c2\u6570\u4f5c\u7528\u57df\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u3002   <pre><code>with hp.scope(foo=1, bar=2) as ps:\n    # ps.foo() \u8fd4\u56de 1\n    # \u5d4c\u5957\u4f5c\u7528\u57df\u4ece\u7236\u4f5c\u7528\u57df\u7ee7\u627f\n</code></pre></p> </li> <li> <p><code>_ParamAccessor</code>: \u5904\u7406 <code>hp.scope.x.y.z | default</code> \u8bed\u6cd5\u3002   <pre><code># \u8fd9\u4e2a\u94fe\u5f0f\u8c03\u7528: hp.scope.model.layers.size | 10\n# \u521b\u5efa: _ParamAccessor(root, \"model.layers.size\")\n# `|` \u8fd0\u7b97\u7b26\u8c03\u7528 get_or_else(10)\n</code></pre></p> </li> <li> <p><code>param</code> \u88c5\u9970\u5668: \u68c0\u67e5\u51fd\u6570\u7b7e\u540d\u5e76\u6ce8\u5165\u503c\u3002   <pre><code>@hp.param(\"model\")\ndef foo(hidden_size=256):  # \u67e5\u627e \"model.hidden_size\"\n    pass\n</code></pre></p> </li> </ul>"},{"location":"architecture.zh/#2-hyperparameterstoragepy","title":"2. \u5b58\u50a8\u5c42 (<code>hyperparameter/storage.py</code>)","text":"<p>\u5b58\u50a8\u5c42\u62bd\u8c61\u4e86\u5e95\u5c42\u7684\u952e\u503c\u5b58\u50a8\u3002</p> <p>\u6838\u5fc3\u7279\u6027:</p> <ul> <li>\u7ebf\u7a0b\u672c\u5730\u5b58\u50a8 (TLS): \u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1\u7684\u53c2\u6570\u6808\u3002</li> <li>\u4f5c\u7528\u57df\u66f4\u65b0: \u66f4\u6539\u4ec5\u9650\u5f53\u524d\u4f5c\u7528\u57df\uff0c\u9000\u51fa\u65f6\u56de\u6eda\u3002</li> <li>\u540e\u7aef\u9009\u62e9: \u5982\u679c\u53ef\u7528\u5219\u81ea\u52a8\u4f7f\u7528 Rust \u540e\u7aef\u3002</li> </ul> <pre><code>class TLSKVStorage:\n    \"\"\"\u5e26\u4f5c\u7528\u57df\u6808\u7684\u7ebf\u7a0b\u672c\u5730\u952e\u503c\u5b58\u50a8\"\"\"\n\n    def enter(self):\n        \"\"\"\u5c06\u65b0\u4f5c\u7528\u57df\u538b\u5165\u6808\"\"\"\n\n    def exit(self):\n        \"\"\"\u5f39\u51fa\u5f53\u524d\u4f5c\u7528\u57df\uff0c\u56de\u6eda\u66f4\u6539\"\"\"\n\n    def get(self, key: str) -&gt; Any:\n        \"\"\"\u5728\u5f53\u524d\u4f5c\u7528\u57df\u67e5\u627e\u952e\uff0c\u7136\u540e\u67e5\u627e\u7236\u4f5c\u7528\u57df\"\"\"\n\n    def put(self, key: str, value: Any):\n        \"\"\"\u4ec5\u5728\u5f53\u524d\u4f5c\u7528\u57df\u8bbe\u7f6e\u952e\"\"\"\n</code></pre>"},{"location":"architecture.zh/#3-rust-srccore-srcpy","title":"3. Rust \u540e\u7aef (<code>src/core/</code>, <code>src/py/</code>)","text":"<p>Rust \u540e\u7aef\u63d0\u4f9b\u9ad8\u6027\u80fd\u7684\u53c2\u6570\u8bbf\u95ee\u3002</p> <p>\u4e3a\u4ec0\u4e48\u7528 Rust?</p> <ol> <li> <p>\u7f16\u8bd1\u65f6\u952e\u54c8\u5e0c: \u50cf <code>\"model.layers.size\"</code> \u8fd9\u6837\u7684\u952e\u5728\u7f16\u8bd1\u65f6\u4f7f\u7528 <code>xxhash</code> \u54c8\u5e0c\uff0c\u6d88\u9664\u4e86\u8fd0\u884c\u65f6\u5b57\u7b26\u4e32\u54c8\u5e0c\u5f00\u9500\u3002</p> </li> <li> <p>\u65e0\u9501\u8bfb\u53d6: \u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\u610f\u5473\u7740\u8bfb\u53d6\u65f6\u6ca1\u6709\u4e92\u65a5\u9501\u7ade\u4e89\u3002</p> </li> <li> <p>\u96f6\u62f7\u8d1d\u5b57\u7b26\u4e32\u5904\u7406: Rust \u7684\u5b57\u7b26\u4e32\u5904\u7406\u907f\u514d\u4e86 Python \u5b57\u7b26\u4e32\u9a7b\u7559\u7684\u5f00\u9500\u3002</p> </li> </ol> <p>\u6838\u5fc3 Rust \u7ec4\u4ef6:</p> <pre><code>// src/core/src/storage.rs\npub struct ThreadLocalStorage {\n    stack: Vec&lt;HashMap&lt;u64, Value&gt;&gt;,  // \u4f5c\u7528\u57df\u6808\n}\n\n// src/core/src/xxh.rs\npub const fn xxhash(s: &amp;str) -&gt; u64 {\n    // \u7f16\u8bd1\u65f6 xxhash64\n}\n\n// src/core/src/api.rs\npub fn get_param&lt;T&gt;(key_hash: u64, default: T) -&gt; T {\n    // \u901a\u8fc7\u9884\u8ba1\u7b97\u54c8\u5e0c\u5feb\u901f\u67e5\u627e\n}\n</code></pre> <p>Python \u7ed1\u5b9a (<code>src/py/</code>):</p> <p>\u4f7f\u7528 PyO3 \u5c06 Rust \u51fd\u6570\u66b4\u9732\u7ed9 Python:</p> <pre><code>#[pyfunction]\nfn get_entry(key_hash: u64) -&gt; PyResult&lt;PyObject&gt; {\n    // \u4ece Python \u8c03\u7528\uff0c\u4f7f\u7528\u9884\u8ba1\u7b97\u7684\u54c8\u5e0c\n}\n</code></pre>"},{"location":"architecture.zh/#4-hyperparameterloaderpy","title":"4. \u914d\u7f6e\u52a0\u8f7d\u5668 (<code>hyperparameter/loader.py</code>)","text":"<p>\u52a0\u8f7d\u5668\u5904\u7406\u914d\u7f6e\u6587\u4ef6\u89e3\u6790\u548c\u5904\u7406\u3002</p> <p>\u5904\u7406\u6d41\u6c34\u7ebf:</p> <pre><code>\u6587\u4ef6 \u2192 \u89e3\u6790 \u2192 \u5408\u5e76 \u2192 \u63d2\u503c \u2192 \u6821\u9a8c \u2192 \u5b57\u5178/\u5bf9\u8c61\n</code></pre> <ol> <li>\u89e3\u6790: \u652f\u6301 TOML\u3001JSON\u3001YAML</li> <li>\u5408\u5e76: \u6df1\u5ea6\u5408\u5e76\u591a\u4e2a\u914d\u7f6e\uff08\u540e\u8005\u8986\u76d6\u524d\u8005\uff09</li> <li>\u63d2\u503c: \u89e3\u6790 <code>${variable}</code> \u5f15\u7528</li> <li>\u6821\u9a8c: \u53ef\u9009\u7684\u57fa\u4e8e\u7c7b\u7c7b\u578b\u63d0\u793a\u7684 Schema \u6821\u9a8c</li> </ol> <pre><code>def load(path, schema=None):\n    config = _load_and_merge(path)\n    config = _resolve_interpolations(config)\n    if schema:\n        return validate(config, schema)\n    return config\n</code></pre>"},{"location":"architecture.zh/#_4","title":"\u6570\u636e\u6d41\u793a\u4f8b","text":"<p>\u8ba9\u6211\u4eec\u8ffd\u8e2a\u8fd0\u884c\u4ee5\u4e0b\u4ee3\u7801\u65f6\u53d1\u751f\u4e86\u4ec0\u4e48:</p> <pre><code>import hyperparameter as hp\n\n@hp.param(\"model\")\ndef train(lr=0.001):\n    print(lr)\n\nwith hp.scope(**{\"model.lr\": 0.01}):\n    train()\n</code></pre> <p>\u9010\u6b65\u5206\u6790:</p> <ol> <li><code>scope(**{\"model.lr\": 0.01})</code>:</li> <li>\u521b\u5efa\u65b0\u7684 <code>TLSKVStorage</code> \u4f5c\u7528\u57df</li> <li>\u8ba1\u7b97\u54c8\u5e0c: <code>xxhash(\"model.lr\")</code> \u2192 <code>0x1234...</code></li> <li> <p>\u5b58\u50a8: <code>{0x1234...: 0.01}</code> \u5230\u5f53\u524d\u7ebf\u7a0b\u7684\u4f5c\u7528\u57df\u6808</p> </li> <li> <p><code>train()</code> \u88ab\u8c03\u7528:</p> </li> <li><code>@hp.param</code> \u5305\u88c5\u5668\u8fd0\u884c</li> <li>\u5bf9\u6bcf\u4e2a\u6709\u9ed8\u8ba4\u503c\u7684\u53c2\u6570 (<code>lr=0.001</code>):<ul> <li>\u8ba1\u7b97\u54c8\u5e0c: <code>xxhash(\"model.lr\")</code></li> <li>\u8c03\u7528 <code>storage.get_entry(0x1234...)</code></li> <li>Rust \u540e\u7aef\u8fd4\u56de <code>0.01</code></li> </ul> </li> <li> <p>\u8c03\u7528 <code>train(lr=0.01)</code></p> </li> <li> <p>\u4f5c\u7528\u57df\u9000\u51fa:</p> </li> <li><code>hp.scope.__exit__()</code> \u88ab\u8c03\u7528</li> <li>\u4ece\u6808\u4e2d\u5f39\u51fa\u4f5c\u7528\u57df</li> <li><code>model.lr</code> \u4e0d\u518d\u53ef\u8bbf\u95ee</li> </ol>"},{"location":"architecture.zh/#_5","title":"\u6027\u80fd\u7279\u5f81","text":""},{"location":"architecture.zh/#hyperparameter","title":"\u4e3a\u4ec0\u4e48 Hyperparameter \u5feb","text":"\u64cd\u4f5c Hydra/OmegaConf Hyperparameter \u952e\u67e5\u627e \u8fd0\u884c\u65f6\u5b57\u7b26\u4e32\u54c8\u5e0c \u9884\u8ba1\u7b97 xxhash \u7c7b\u578b\u68c0\u67e5 \u6bcf\u6b21\u8bbf\u95ee\u90fd\u68c0\u67e5 \u53ef\u9009\uff0c\u52a0\u8f7d\u65f6\u68c0\u67e5 \u7ebf\u7a0b\u5b89\u5168 \u5168\u5c40\u9501 \u7ebf\u7a0b\u672c\u5730\uff08\u65e0\u9501\uff09 \u5185\u5b58 Python \u5b57\u5178 + \u5305\u88c5\u5668 Rust HashMap"},{"location":"architecture.zh/#_6","title":"\u4f55\u65f6\u4f7f\u7528\u54ea\u79cd\u8bbf\u95ee\u6a21\u5f0f","text":"\u6a21\u5f0f \u901f\u5ea6 \u4f7f\u7528\u573a\u666f <code>@hp.param</code> \u6ce8\u5165 \ud83d\ude80\ud83d\ude80\ud83d\ude80 \u6700\u5feb \u70ed\u5faa\u73af\uff0c\u6027\u80fd\u5173\u952e <code>with hp.scope() as ps: ps.x</code> \ud83d\ude80\ud83d\ude80 \u5feb \u5927\u591a\u6570\u4ee3\u7801 <code>hp.scope.x</code> (\u5168\u5c40) \ud83d\ude80 \u4e2d\u7b49 \u4fbf\u6377\u8bbf\u95ee\uff0c\u4e00\u6b21\u6027\u8bbf\u95ee"},{"location":"architecture.zh/#_7","title":"\u7ebf\u7a0b\u5b89\u5168\u6a21\u578b","text":"<pre><code>\u7ebf\u7a0b 1                      \u7ebf\u7a0b 2\n\u2500\u2500\u2500\u2500\u2500\u2500                      \u2500\u2500\u2500\u2500\u2500\u2500\nhp.scope(a=1)           \n\u2502                          scope(a=2)\n\u2502   a = 1                  \u2502   a = 2\n\u2502                          \u2502\n\u2514\u2500\u2500 \u9000\u51fa                   \u2514\u2500\u2500 \u9000\u51fa\n    a = \u672a\u5b9a\u4e49                 a = \u672a\u5b9a\u4e49\n</code></pre> <p>\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u72ec\u7acb\u7684\u4f5c\u7528\u57df\u6808\u3002\u4e00\u4e2a\u7ebf\u7a0b\u7684\u66f4\u6539\u6c38\u8fdc\u4e0d\u4f1a\u5f71\u54cd\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u3002</p> <p><code>frozen()</code> \u7528\u4e8e\u8de8\u7ebf\u7a0b\u9ed8\u8ba4\u503c:</p> <pre><code>with hp.scope(a=1):\n    hp.scope.frozen()  # \u5c06\u5f53\u524d\u4f5c\u7528\u57df\u5feb\u7167\u4e3a\u5168\u5c40\u9ed8\u8ba4\u503c\n\n# \u65b0\u7ebf\u7a0b\u5c06\u4ee5 a=1 \u4f5c\u4e3a\u521d\u59cb\u72b6\u6001\n</code></pre>"},{"location":"architecture.zh/#hyperparameter_1","title":"\u6269\u5c55 Hyperparameter","text":""},{"location":"architecture.zh/#_8","title":"\u81ea\u5b9a\u4e49\u5b58\u50a8\u540e\u7aef","text":"<pre><code>from hyperparameter.storage import TLSKVStorage\n\nclass RedisBackedStorage(TLSKVStorage):\n    \"\"\"\u793a\u4f8b: \u7528\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684 Redis \u540e\u7aef\u5b58\u50a8\"\"\"\n\n    def get(self, key):\n        # \u5148\u5c1d\u8bd5\u672c\u5730\n        value = super().get(key)\n        if value is None:\n            # \u56de\u9000\u5230 Redis\n            value = self.redis.get(key)\n        return value\n</code></pre>"},{"location":"architecture.zh/#_9","title":"\u81ea\u5b9a\u4e49\u7c7b\u578b\u8f6c\u6362","text":"<pre><code>from hyperparameter.loader import _coerce_type\n\ndef _coerce_type(value, target_type):\n    # \u6dfb\u52a0\u81ea\u5b9a\u4e49\u7c7b\u578b\u5904\u7406\n    if target_type is MyCustomType:\n        return MyCustomType.from_string(value)\n    # ... \u73b0\u6709\u903b\u8f91\n</code></pre>"},{"location":"architecture.zh/#_10","title":"\u6587\u4ef6\u7ed3\u6784","text":"<pre><code>hyperparameter/\n\u251c\u2500\u2500 __init__.py          # \u516c\u5171 API \u5bfc\u51fa\n\u251c\u2500\u2500 api.py               # \u6838\u5fc3 Python API (scope, param)\n\u251c\u2500\u2500 cli.py               # CLI \u652f\u6301 (launch, launch)\n\u251c\u2500\u2500 loader.py            # \u914d\u7f6e\u52a0\u8f7d\u3001\u63d2\u503c\u3001\u6821\u9a8c\n\u251c\u2500\u2500 storage.py           # \u5b58\u50a8\u62bd\u8c61\u3001TLS\n\u2514\u2500\u2500 tune.py              # \u8d85\u53c2\u8c03\u4f18\u5de5\u5177\n\nsrc/\n\u251c\u2500\u2500 core/                # Rust \u6838\u5fc3\u5e93\n\u2502   \u2514\u2500\u2500 src/\n\u2502       \u251c\u2500\u2500 api.rs       # \u516c\u5171 Rust API\n\u2502       \u251c\u2500\u2500 storage.rs   # \u7ebf\u7a0b\u672c\u5730\u5b58\u50a8\n\u2502       \u251c\u2500\u2500 value.rs     # \u503c\u7c7b\u578b\u5904\u7406\n\u2502       \u2514\u2500\u2500 xxh.rs       # \u7f16\u8bd1\u65f6 xxhash\n\u251c\u2500\u2500 macros/              # Rust \u8fc7\u7a0b\u5b8f\n\u2514\u2500\u2500 py/                  # PyO3 Python \u7ed1\u5b9a\n</code></pre>"},{"location":"cookbook/","title":"Cookbook","text":"<ul> <li>\u4e2d\u6587</li> </ul>"},{"location":"cookbook/#cookbook-common-recipes","title":"Cookbook: Common Recipes","text":"<p>This cookbook provides practical solutions for common configuration management scenarios.</p>"},{"location":"cookbook/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Multi-Environment Configuration (dev/staging/prod)</li> <li>Configuration Inheritance</li> <li>Secrets Management</li> <li>Feature Flags</li> <li>A/B Testing Configuration</li> <li>Multi-Stage Training (RL/ML)</li> </ul>"},{"location":"cookbook/#multi-environment-configuration","title":"Multi-Environment Configuration","text":""},{"location":"cookbook/#problem","title":"Problem","text":"<p>You need different configurations for development, staging, and production environments.</p>"},{"location":"cookbook/#solution","title":"Solution","text":"<p>Directory Structure: <pre><code>config/\n\u251c\u2500\u2500 base.toml          # Shared defaults\n\u251c\u2500\u2500 dev.toml           # Development overrides\n\u251c\u2500\u2500 staging.toml       # Staging overrides\n\u2514\u2500\u2500 prod.toml          # Production overrides\n</code></pre></p> <p>base.toml: <pre><code>[database]\nhost = \"localhost\"\nport = 5432\npool_size = 5\n\n[logging]\nlevel = \"INFO\"\nformat = \"%(asctime)s - %(message)s\"\n\n[model]\nbatch_size = 32\nlearning_rate = 0.001\n</code></pre></p> <p>dev.toml: <pre><code>[database]\nhost = \"localhost\"\n\n[logging]\nlevel = \"DEBUG\"\n\n[model]\nbatch_size = 8  # Smaller for faster iteration\n</code></pre></p> <p>prod.toml: <pre><code>[database]\nhost = \"prod-db.example.com\"\npool_size = 20\n\n[logging]\nlevel = \"WARNING\"\n\n[model]\nbatch_size = 256\n</code></pre></p> <p>main.py: <pre><code>import os\nimport hyperparameter as hp\n\ndef load_config():\n    env = os.environ.get(\"ENV\", \"dev\")\n    return hp.config([\n        \"config/base.toml\",\n        f\"config/{env}.toml\"\n    ])\n\n@hp.param(\"model\")\ndef train(batch_size=32, learning_rate=0.001):\n    print(f\"Training with batch_size={batch_size}, lr={learning_rate}\")\n\nif __name__ == \"__main__\":\n    cfg = load_config()\n    with hp.scope(**cfg):\n        train()\n</code></pre></p> <p>Usage: <pre><code>ENV=dev python main.py      # batch_size=8\nENV=prod python main.py     # batch_size=256\n</code></pre></p>"},{"location":"cookbook/#configuration-inheritance","title":"Configuration Inheritance","text":""},{"location":"cookbook/#problem_1","title":"Problem","text":"<p>You have multiple model variants that share common settings but differ in specific parameters.</p>"},{"location":"cookbook/#solution_1","title":"Solution","text":"<p>config/models/base_transformer.toml: <pre><code>[model]\ntype = \"transformer\"\nnum_layers = 6\nhidden_size = 512\nnum_heads = 8\ndropout = 0.1\nactivation = \"gelu\"\n</code></pre></p> <p>config/models/bert_base.toml: <pre><code>[model]\nnum_layers = 12\nhidden_size = 768\nnum_heads = 12\nvocab_size = 30522\n</code></pre></p> <p>config/models/bert_large.toml: <pre><code>[model]\nnum_layers = 24\nhidden_size = 1024\nnum_heads = 16\nvocab_size = 30522\n</code></pre></p> <p>main.py: <pre><code>import hyperparameter as hp\n\ndef load_model_config(model_name: str):\n    \"\"\"Load model config with inheritance.\"\"\"\n    base_config = \"config/models/base_transformer.toml\"\n    model_config = f\"config/models/{model_name}.toml\"\n    return hp.config([base_config, model_config])\n\n# Usage\ncfg = load_model_config(\"bert_large\")\n# Result: num_layers=24, hidden_size=1024, dropout=0.1 (inherited)\n</code></pre></p>"},{"location":"cookbook/#secrets-management","title":"Secrets Management","text":""},{"location":"cookbook/#problem_2","title":"Problem","text":"<p>You need to manage sensitive values (API keys, passwords) without committing them to git.</p>"},{"location":"cookbook/#solution_2","title":"Solution","text":"<p>config/app.toml: <pre><code>[api]\nbase_url = \"https://api.example.com\"\ntimeout = 30\n\n[database]\nhost = \"${DATABASE_HOST}\"      # From environment variable\npassword = \"${DATABASE_PASS}\"\n</code></pre></p> <p>config/secrets.local.toml (gitignored): <pre><code>[api]\nkey = \"sk-your-actual-api-key\"\n\n[database]\npassword = \"actual-password\"\n</code></pre></p> <p>.gitignore: <pre><code>config/secrets.local.toml\n</code></pre></p> <p>main.py: <pre><code>import os\nfrom pathlib import Path\nimport hyperparameter as hp\n\ndef load_config_with_secrets():\n    configs = [\"config/app.toml\"]\n\n    # Load local secrets if exists\n    secrets_file = Path(\"config/secrets.local.toml\")\n    if secrets_file.exists():\n        configs.append(str(secrets_file))\n\n    cfg = hp.config(configs)\n    return cfg\n\ncfg = load_config_with_secrets()\n</code></pre></p>"},{"location":"cookbook/#feature-flags","title":"Feature Flags","text":""},{"location":"cookbook/#problem_3","title":"Problem","text":"<p>You want to enable/disable features without code changes.</p>"},{"location":"cookbook/#solution_3","title":"Solution","text":"<p>config/features.toml: <pre><code>[features]\nnew_ui = false\nexperimental_model = false\ndebug_mode = true\nrate_limiting = true\n\n[features.ab_test]\nenabled = true\nvariant = \"control\"  # \"control\" or \"treatment\"\n</code></pre></p> <p>main.py: <pre><code>import hyperparameter as hp\n\ncfg = hp.config(\"config/features.toml\")\n\nwith hp.scope(**cfg):\n    # Check feature flags anywhere in code\n    if hp.scope.features.new_ui | False:\n        render_new_ui()\n    else:\n        render_old_ui()\n\n    if hp.scope.features.experimental_model | False:\n        model = ExperimentalModel()\n    else:\n        model = StableModel()\n</code></pre></p> <p>Toggle via CLI: <pre><code>python main.py -D features.new_ui=true\n</code></pre></p>"},{"location":"cookbook/#ab-testing-configuration","title":"A/B Testing Configuration","text":""},{"location":"cookbook/#problem_4","title":"Problem","text":"<p>You need to run experiments with different parameter configurations.</p>"},{"location":"cookbook/#solution_4","title":"Solution","text":"<pre><code>import hyperparameter as hp\nimport random\n\n@hp.param(\"experiment\")\ndef run_experiment(\n    model_type=\"baseline\",\n    learning_rate=0.001,\n    batch_size=32\n):\n    print(f\"Running: {model_type}, lr={learning_rate}, bs={batch_size}\")\n    # ... training code ...\n\ndef get_experiment_config(user_id: str):\n    \"\"\"Deterministic assignment based on user_id.\"\"\"\n    bucket = hash(user_id) % 100\n\n    if bucket &lt; 50:\n        return {\"experiment.model_type\": \"baseline\"}\n    else:\n        return {\"experiment.model_type\": \"new_model\", \"experiment.learning_rate\": 0.0005}\n\n# Usage\nuser_config = get_experiment_config(\"user_123\")\nwith hp.scope(**user_config):\n    run_experiment()\n</code></pre>"},{"location":"cookbook/#multi-stage-training-rlml","title":"Multi-Stage Training (RL/ML)","text":""},{"location":"cookbook/#problem_5","title":"Problem","text":"<p>You have a training pipeline with multiple stages, each needing different configurations.</p>"},{"location":"cookbook/#solution_5","title":"Solution","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"train.pretrain\")\ndef pretrain(lr=0.001, epochs=10, warmup=True):\n    print(f\"Pretraining: lr={lr}, epochs={epochs}, warmup={warmup}\")\n\n@hp.param(\"train.finetune\")\ndef finetune(lr=0.0001, epochs=5, freeze_backbone=True):\n    print(f\"Finetuning: lr={lr}, epochs={epochs}, freeze={freeze_backbone}\")\n\n@hp.param(\"train.rl\")\ndef rl_train(lr=0.00001, episodes=1000, exploration=0.1):\n    print(f\"RL Training: lr={lr}, episodes={episodes}, exploration={exploration}\")\n\ndef run_pipeline():\n    # Stage 1: Pretrain with high LR\n    with hp.scope(**{\"train.pretrain.lr\": 0.001, \"train.pretrain.epochs\": 20}):\n        pretrain()\n\n    # Stage 2: Finetune with low LR\n    with hp.scope(**{\"train.finetune.lr\": 0.00005}):\n        finetune()\n\n    # Stage 3: RL with decaying exploration\n    for stage, exploration in enumerate([0.5, 0.3, 0.1, 0.05]):\n        with hp.scope(**{\"train.rl.exploration\": exploration}):\n            print(f\"--- RL Stage {stage + 1} ---\")\n            rl_train()\n\nif __name__ == \"__main__\":\n    run_pipeline()\n</code></pre> <p>This showcases the dynamic scoping feature that Hydra cannot easily replicate.</p>"},{"location":"cookbook/#tips-and-best-practices","title":"Tips and Best Practices","text":""},{"location":"cookbook/#1-use-type-hints-for-better-ide-support","title":"1. Use Type Hints for Better IDE Support","text":"<pre><code>from dataclasses import dataclass\nimport hyperparameter as hp\n\n@dataclass\nclass ModelConfig:\n    hidden_size: int = 256\n    dropout: float = 0.1\n    activation: str = \"relu\"\n\ncfg: ModelConfig = hp.config(\"config.toml\", schema=ModelConfig)\n# Now cfg.hidden_size has autocomplete!\n</code></pre>"},{"location":"cookbook/#2-organize-configs-by-concern","title":"2. Organize Configs by Concern","text":"<pre><code>config/\n\u251c\u2500\u2500 model/\n\u2502   \u251c\u2500\u2500 bert.toml\n\u2502   \u2514\u2500\u2500 gpt.toml\n\u251c\u2500\u2500 training/\n\u2502   \u251c\u2500\u2500 default.toml\n\u2502   \u2514\u2500\u2500 distributed.toml\n\u251c\u2500\u2500 data/\n\u2502   \u2514\u2500\u2500 preprocessing.toml\n\u2514\u2500\u2500 base.toml\n</code></pre>"},{"location":"cookbook/#3-use-interpolation-for-dry-configs","title":"3. Use Interpolation for DRY Configs","text":"<pre><code>[paths]\nroot = \"/project\"\ndata = \"${paths.root}/data\"\nmodels = \"${paths.root}/models\"\nlogs = \"${paths.root}/logs\"\n</code></pre>"},{"location":"cookbook/#4-document-your-config-files","title":"4. Document Your Config Files","text":"<pre><code># Model configuration for BERT variants\n# See: https://arxiv.org/abs/1810.04805\n\n[model]\n# Number of transformer layers (12 for base, 24 for large)\nnum_layers = 12\n\n# Hidden dimension (768 for base, 1024 for large)\nhidden_size = 768\n</code></pre>"},{"location":"cookbook.zh/","title":"Cookbook","text":"<ul> <li>English</li> </ul>"},{"location":"cookbook.zh/#cookbook","title":"Cookbook: \u5e38\u7528\u914d\u7f6e\u65b9\u6848","text":"<p>\u672c Cookbook \u63d0\u4f9b\u5e38\u89c1\u914d\u7f6e\u7ba1\u7406\u573a\u666f\u7684\u5b9e\u7528\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"cookbook.zh/#_1","title":"\u76ee\u5f55","text":"<ul> <li>\u591a\u73af\u5883\u914d\u7f6e (dev/staging/prod)</li> <li>\u914d\u7f6e\u7ee7\u627f</li> <li>\u5bc6\u94a5\u7ba1\u7406</li> <li>\u7279\u6027\u5f00\u5173</li> <li>A/B \u6d4b\u8bd5\u914d\u7f6e</li> <li>\u591a\u9636\u6bb5\u8bad\u7ec3 (RL/ML)</li> </ul>"},{"location":"cookbook.zh/#_2","title":"\u591a\u73af\u5883\u914d\u7f6e","text":""},{"location":"cookbook.zh/#_3","title":"\u95ee\u9898","text":"<p>\u4f60\u9700\u8981\u4e3a\u5f00\u53d1\u3001\u9884\u53d1\u5e03\u548c\u751f\u4ea7\u73af\u5883\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u3002</p>"},{"location":"cookbook.zh/#_4","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>\u76ee\u5f55\u7ed3\u6784: <pre><code>config/\n\u251c\u2500\u2500 base.toml          # \u5171\u4eab\u9ed8\u8ba4\u503c\n\u251c\u2500\u2500 dev.toml           # \u5f00\u53d1\u73af\u5883\u8986\u76d6\n\u251c\u2500\u2500 staging.toml       # \u9884\u53d1\u5e03\u73af\u5883\u8986\u76d6\n\u2514\u2500\u2500 prod.toml          # \u751f\u4ea7\u73af\u5883\u8986\u76d6\n</code></pre></p> <p>base.toml: <pre><code>[database]\nhost = \"localhost\"\nport = 5432\npool_size = 5\n\n[logging]\nlevel = \"INFO\"\nformat = \"%(asctime)s - %(message)s\"\n\n[model]\nbatch_size = 32\nlearning_rate = 0.001\n</code></pre></p> <p>dev.toml: <pre><code>[database]\nhost = \"localhost\"\n\n[logging]\nlevel = \"DEBUG\"\n\n[model]\nbatch_size = 8  # \u66f4\u5c0f\u7684 batch \u52a0\u901f\u8fed\u4ee3\n</code></pre></p> <p>prod.toml: <pre><code>[database]\nhost = \"prod-db.example.com\"\npool_size = 20\n\n[logging]\nlevel = \"WARNING\"\n\n[model]\nbatch_size = 256\n</code></pre></p> <p>main.py: <pre><code>import os\nimport hyperparameter as hp\n\ndef load_config():\n    env = os.environ.get(\"ENV\", \"dev\")\n    return hp.config([\n        \"config/base.toml\",\n        f\"config/{env}.toml\"\n    ])\n\n@hp.param(\"model\")\ndef train(batch_size=32, learning_rate=0.001):\n    print(f\"Training with batch_size={batch_size}, lr={learning_rate}\")\n\nif __name__ == \"__main__\":\n    cfg = load_config()\n    with hp.scope(**cfg):\n        train()\n</code></pre></p> <p>\u4f7f\u7528\u65b9\u5f0f: <pre><code>ENV=dev python main.py      # batch_size=8\nENV=prod python main.py     # batch_size=256\n</code></pre></p>"},{"location":"cookbook.zh/#_5","title":"\u914d\u7f6e\u7ee7\u627f","text":""},{"location":"cookbook.zh/#_6","title":"\u95ee\u9898","text":"<p>\u4f60\u6709\u591a\u4e2a\u6a21\u578b\u53d8\u4f53\uff0c\u5b83\u4eec\u5171\u4eab\u901a\u7528\u8bbe\u7f6e\u4f46\u5728\u7279\u5b9a\u53c2\u6570\u4e0a\u6709\u6240\u4e0d\u540c\u3002</p>"},{"location":"cookbook.zh/#_7","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>config/models/base_transformer.toml: <pre><code>[model]\ntype = \"transformer\"\nnum_layers = 6\nhidden_size = 512\nnum_heads = 8\ndropout = 0.1\nactivation = \"gelu\"\n</code></pre></p> <p>config/models/bert_base.toml: <pre><code>[model]\nnum_layers = 12\nhidden_size = 768\nnum_heads = 12\nvocab_size = 30522\n</code></pre></p> <p>config/models/bert_large.toml: <pre><code>[model]\nnum_layers = 24\nhidden_size = 1024\nnum_heads = 16\nvocab_size = 30522\n</code></pre></p> <p>main.py: <pre><code>import hyperparameter as hp\n\ndef load_model_config(model_name: str):\n    \"\"\"\u52a0\u8f7d\u5e26\u7ee7\u627f\u7684\u6a21\u578b\u914d\u7f6e\"\"\"\n    base_config = \"config/models/base_transformer.toml\"\n    model_config = f\"config/models/{model_name}.toml\"\n    return hp.config([base_config, model_config])\n\n# \u4f7f\u7528\ncfg = load_model_config(\"bert_large\")\n# \u7ed3\u679c: num_layers=24, hidden_size=1024, dropout=0.1 (\u7ee7\u627f\u81ea base)\n</code></pre></p>"},{"location":"cookbook.zh/#_8","title":"\u5bc6\u94a5\u7ba1\u7406","text":""},{"location":"cookbook.zh/#_9","title":"\u95ee\u9898","text":"<p>\u4f60\u9700\u8981\u7ba1\u7406\u654f\u611f\u503c\uff08API \u5bc6\u94a5\u3001\u5bc6\u7801\uff09\uff0c\u4f46\u4e0d\u80fd\u63d0\u4ea4\u5230 git\u3002</p>"},{"location":"cookbook.zh/#_10","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>config/app.toml: <pre><code>[api]\nbase_url = \"https://api.example.com\"\ntimeout = 30\n\n[database]\nhost = \"${DATABASE_HOST}\"      # \u4ece\u73af\u5883\u53d8\u91cf\u8bfb\u53d6\npassword = \"${DATABASE_PASS}\"\n</code></pre></p> <p>config/secrets.local.toml (\u5df2\u52a0\u5165 gitignore): <pre><code>[api]\nkey = \"sk-your-actual-api-key\"\n\n[database]\npassword = \"actual-password\"\n</code></pre></p> <p>.gitignore: <pre><code>config/secrets.local.toml\n</code></pre></p> <p>main.py: <pre><code>import os\nfrom pathlib import Path\nimport hyperparameter as hp\n\ndef load_config_with_secrets():\n    configs = [\"config/app.toml\"]\n\n    # \u5982\u679c\u5b58\u5728\u672c\u5730\u5bc6\u94a5\u6587\u4ef6\u5219\u52a0\u8f7d\n    secrets_file = Path(\"config/secrets.local.toml\")\n    if secrets_file.exists():\n        configs.append(str(secrets_file))\n\n    cfg = hp.config(configs)\n    return cfg\n\ncfg = load_config_with_secrets()\n</code></pre></p>"},{"location":"cookbook.zh/#_11","title":"\u7279\u6027\u5f00\u5173","text":""},{"location":"cookbook.zh/#_12","title":"\u95ee\u9898","text":"<p>\u4f60\u60f3\u5728\u4e0d\u4fee\u6539\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u542f\u7528/\u7981\u7528\u529f\u80fd\u3002</p>"},{"location":"cookbook.zh/#_13","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>config/features.toml: <pre><code>[features]\nnew_ui = false\nexperimental_model = false\ndebug_mode = true\nrate_limiting = true\n\n[features.ab_test]\nenabled = true\nvariant = \"control\"  # \"control\" \u6216 \"treatment\"\n</code></pre></p> <p>main.py: <pre><code>import hyperparameter as hp\n\ncfg = hp.config(\"config/features.toml\")\n\nwith hp.scope(**cfg):\n    # \u5728\u4ee3\u7801\u4efb\u4f55\u5730\u65b9\u68c0\u67e5\u7279\u6027\u5f00\u5173\n    if hp.scope.features.new_ui | False:\n        render_new_ui()\n    else:\n        render_old_ui()\n\n    if hp.scope.features.experimental_model | False:\n        model = ExperimentalModel()\n    else:\n        model = StableModel()\n</code></pre></p> <p>\u901a\u8fc7\u547d\u4ee4\u884c\u5207\u6362: <pre><code>python main.py -D features.new_ui=true\n</code></pre></p>"},{"location":"cookbook.zh/#ab","title":"A/B \u6d4b\u8bd5\u914d\u7f6e","text":""},{"location":"cookbook.zh/#_14","title":"\u95ee\u9898","text":"<p>\u4f60\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u53c2\u6570\u914d\u7f6e\u8fd0\u884c\u5b9e\u9a8c\u3002</p>"},{"location":"cookbook.zh/#_15","title":"\u89e3\u51b3\u65b9\u6848","text":"<pre><code>import hyperparameter as hp\nimport random\n\n@hp.param(\"experiment\")\ndef run_experiment(\n    model_type=\"baseline\",\n    learning_rate=0.001,\n    batch_size=32\n):\n    print(f\"Running: {model_type}, lr={learning_rate}, bs={batch_size}\")\n    # ... \u8bad\u7ec3\u4ee3\u7801 ...\n\ndef get_experiment_config(user_id: str):\n    \"\"\"\u57fa\u4e8e user_id \u7684\u786e\u5b9a\u6027\u5206\u914d\"\"\"\n    bucket = hash(user_id) % 100\n\n    if bucket &lt; 50:\n        return {\"experiment.model_type\": \"baseline\"}\n    else:\n        return {\"experiment.model_type\": \"new_model\", \"experiment.learning_rate\": 0.0005}\n\n# \u4f7f\u7528\nuser_config = get_experiment_config(\"user_123\")\nwith hp.scope(**user_config):\n    run_experiment()\n</code></pre>"},{"location":"cookbook.zh/#_16","title":"\u591a\u9636\u6bb5\u8bad\u7ec3","text":""},{"location":"cookbook.zh/#_17","title":"\u95ee\u9898","text":"<p>\u4f60\u7684\u8bad\u7ec3\u6d41\u6c34\u7ebf\u6709\u591a\u4e2a\u9636\u6bb5\uff0c\u6bcf\u4e2a\u9636\u6bb5\u9700\u8981\u4e0d\u540c\u7684\u914d\u7f6e\u3002</p>"},{"location":"cookbook.zh/#_18","title":"\u89e3\u51b3\u65b9\u6848","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"train.pretrain\")\ndef pretrain(lr=0.001, epochs=10, warmup=True):\n    print(f\"Pretraining: lr={lr}, epochs={epochs}, warmup={warmup}\")\n\n@hp.param(\"train.finetune\")\ndef finetune(lr=0.0001, epochs=5, freeze_backbone=True):\n    print(f\"Finetuning: lr={lr}, epochs={epochs}, freeze={freeze_backbone}\")\n\n@hp.param(\"train.rl\")\ndef rl_train(lr=0.00001, episodes=1000, exploration=0.1):\n    print(f\"RL Training: lr={lr}, episodes={episodes}, exploration={exploration}\")\n\ndef run_pipeline():\n    # \u9636\u6bb5 1: \u9ad8\u5b66\u4e60\u7387\u9884\u8bad\u7ec3\n    with hp.scope(**{\"train.pretrain.lr\": 0.001, \"train.pretrain.epochs\": 20}):\n        pretrain()\n\n    # \u9636\u6bb5 2: \u4f4e\u5b66\u4e60\u7387\u5fae\u8c03\n    with hp.scope(**{\"train.finetune.lr\": 0.00005}):\n        finetune()\n\n    # \u9636\u6bb5 3: RL \u8bad\u7ec3\uff0c\u63a2\u7d22\u7387\u9012\u51cf\n    for stage, exploration in enumerate([0.5, 0.3, 0.1, 0.05]):\n        with hp.scope(**{\"train.rl.exploration\": exploration}):\n            print(f\"--- RL Stage {stage + 1} ---\")\n            rl_train()\n\nif __name__ == \"__main__\":\n    run_pipeline()\n</code></pre> <p>\u8fd9\u5c55\u793a\u4e86 Hydra \u96be\u4ee5\u5b9e\u73b0\u7684\u52a8\u6001\u4f5c\u7528\u57df\u7279\u6027\u3002</p>"},{"location":"cookbook.zh/#_19","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"cookbook.zh/#1-ide","title":"1. \u4f7f\u7528\u7c7b\u578b\u63d0\u793a\u83b7\u5f97\u66f4\u597d\u7684 IDE \u652f\u6301","text":"<pre><code>from dataclasses import dataclass\nimport hyperparameter as hp\n\n@dataclass\nclass ModelConfig:\n    hidden_size: int = 256\n    dropout: float = 0.1\n    activation: str = \"relu\"\n\ncfg: ModelConfig = hp.config(\"config.toml\", schema=ModelConfig)\n# \u73b0\u5728 cfg.hidden_size \u6709\u81ea\u52a8\u8865\u5168\u4e86\uff01\n</code></pre>"},{"location":"cookbook.zh/#2","title":"2. \u6309\u5173\u6ce8\u70b9\u7ec4\u7ec7\u914d\u7f6e","text":"<pre><code>config/\n\u251c\u2500\u2500 model/\n\u2502   \u251c\u2500\u2500 bert.toml\n\u2502   \u2514\u2500\u2500 gpt.toml\n\u251c\u2500\u2500 training/\n\u2502   \u251c\u2500\u2500 default.toml\n\u2502   \u2514\u2500\u2500 distributed.toml\n\u251c\u2500\u2500 data/\n\u2502   \u2514\u2500\u2500 preprocessing.toml\n\u2514\u2500\u2500 base.toml\n</code></pre>"},{"location":"cookbook.zh/#3-dry","title":"3. \u4f7f\u7528\u63d2\u503c\u907f\u514d\u91cd\u590d (DRY)","text":"<pre><code>[paths]\nroot = \"/project\"\ndata = \"${paths.root}/data\"\nmodels = \"${paths.root}/models\"\nlogs = \"${paths.root}/logs\"\n</code></pre>"},{"location":"cookbook.zh/#4","title":"4. \u4e3a\u914d\u7f6e\u6587\u4ef6\u6dfb\u52a0\u6ce8\u91ca","text":"<pre><code># BERT \u53d8\u4f53\u7684\u6a21\u578b\u914d\u7f6e\n# \u53c2\u8003: https://arxiv.org/abs/1810.04805\n\n[model]\n# Transformer \u5c42\u6570 (base \u4e3a 12\uff0clarge \u4e3a 24)\nnum_layers = 12\n\n# \u9690\u85cf\u7ef4\u5ea6 (base \u4e3a 768\uff0clarge \u4e3a 1024)\nhidden_size = 768\n</code></pre>"},{"location":"index.zh/","title":"\u9996\u9875","text":"<ul> <li>English</li> </ul> Hyperparameter <p> ENGLISH | \u4e2d\u6587\u6587\u6863 </p> <p> Make configurable AI applications. Build for Python/Rust hackers. </p> <p><code>Hyperparameter</code> \u662f\u4e00\u4e2a\u591a\u529f\u80fd\u8d85\u53c2\u6570\u7ba1\u7406\u5e93\uff0c\u65e8\u5728\u7b80\u5316\u673a\u5668\u5b66\u4e60\u7b97\u6cd5\u548c\u7cfb\u7edf\u5f00\u53d1\u4e2d\u8d85\u53c2\u6570\u7684\u7ba1\u7406\u548c\u63a7\u5236\u3002\u4e13\u4e3a AI \u7814\u7a76\u4eba\u5458\u548c\u673a\u5668\u5b66\u4e60\u7cfb\u7edf\uff08MLSYS\uff09\u5f00\u53d1\u8005\u8bbe\u8ba1\uff0cHyperparameter \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4fa7\u91cd\u4e8e\u5728 Python \u4e2d\u6613\u4e8e\u4f7f\u7528\u3001\u5728 Rust \u548c C++ \u4e2d\u9ad8\u6027\u80fd\u8bbf\u95ee\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e00\u7ec4\u5b8f\u4ee5\u5b9e\u73b0\u65e0\u7f1d\u8d85\u53c2\u6570\u7ba1\u7406\u3002</p>"},{"location":"index.zh/#5","title":"5\u5206\u949f\u5c1d\u9c9c","text":"<pre><code>pip install hyperparameter\n\n# \u8fd0\u884c\u73b0\u6210\u7684\u6f14\u793a\npython -m hyperparameter.examples.quickstart\n\n# \u5c1d\u8bd5 @hp.param CLI\uff1a\u4ece\u547d\u4ee4\u884c\u8986\u76d6\u9ed8\u8ba4\u503c\npython -m hyperparameter.examples.quickstart --define greet.name=Alice --enthusiasm=3\n\n# \u68c0\u67e5\u53c2\u6570\u548c\u9ed8\u8ba4\u503c\npython -m hyperparameter.examples.quickstart -lps\npython -m hyperparameter.examples.quickstart -ep greet.name\n\n# \u4ece\u6e90\u7801\u8fd0\u884c\uff1f\u4f7f\u7528\u6a21\u5757\u6a21\u5f0f\u6216\u5b89\u88c5\u4e3a\u53ef\u7f16\u8f91\u6a21\u5f0f\n# python -m hyperparameter.examples.quickstart\n# \u6216\u8005: pip install -e .\n</code></pre>"},{"location":"index.zh/#hyperparameter","title":"\u4e3a\u4ec0\u4e48\u9009\u62e9 Hyperparameter?","text":""},{"location":"index.zh/#vs-hydra","title":"\ud83d\ude80 \u65e0\u4e0e\u4f26\u6bd4\u7684\u6027\u80fd (vs Hydra)","text":"<p>Hyperparameter \u57fa\u4e8e\u9ad8\u6027\u80fd Rust \u540e\u7aef\u6784\u5efa\uff0c\u4f7f\u5176\u6bd4 Hydra \u7b49\u7eaf Python \u66ff\u4ee3\u65b9\u6848\u5feb\u5f97\u591a\uff0c\u7279\u522b\u662f\u5728\u5185\u5faa\u73af\u53c2\u6570\u8bbf\u95ee\u4e2d\u3002</p> Method Time (1M iters) Speedup (vs Hydra) HP: Injected (Native Speed) 0.0184s 856.73x \ud83d\ude80 HP: Dynamic (Optimized) 2.4255s 6.50x \u26a1\ufe0f Hydra (Baseline) 15.7638s 1.00x <p>\u57fa\u51c6\u6d4b\u8bd5\u573a\u666f\uff1a\u5728\u5faa\u73af\u4e2d\u8bbf\u95ee\u5d4c\u5957\u53c2\u6570 <code>model.layers.0.size</code> 1,000,000 \u6b21\u3002 \u53c2\u89c1 <code>benchmark/</code> \u6587\u4ef6\u5939\u83b7\u53d6\u590d\u73b0\u811a\u672c\u3002</p>"},{"location":"index.zh/#schema","title":"\u2728 \u96f6\u4f9d\u8d56 Schema \u6821\u9a8c","text":"<p>Hyperparameter \u652f\u6301\u4f7f\u7528\u6807\u51c6 Python \u7c7b\u578b\u63d0\u793a\u8fdb\u884c\u7ed3\u6784\u6821\u9a8c\uff0c\u65e0\u9700\u5f15\u5165\u91cd\u578b\u4f9d\u8d56\uff08\u5982 Pydantic \u6216 OmegaConf\uff09\u3002</p> <pre><code>from dataclasses import dataclass\nimport hyperparameter as hp\n\n@dataclass\nclass AppConfig:\n    host: str\n    port: int\n    debug: bool = False\n\n# \u81ea\u52a8\u6821\u9a8c\u7c7b\u578b\u5e76\u8f6c\u6362\uff1a\"8080\" -&gt; 8080 (int)\ncfg = hp.config(\"config.toml\", schema=AppConfig)\n</code></pre>"},{"location":"index.zh/#_1","title":"\u4e3b\u8981\u7279\u6027","text":""},{"location":"index.zh/#python","title":"\u9488\u5bf9 Python \u7528\u6237","text":"<ul> <li>Pythonic \u8bed\u6cd5\uff1a \u4f7f\u7528\u5173\u952e\u5b57\u53c2\u6570\u8bed\u6cd5\u5b9a\u4e49\u8d85\u53c2\u6570\uff1b</li> <li>\u76f4\u89c2\u7684\u4f5c\u7528\u57df\uff1a \u901a\u8fc7 <code>with</code> \u8bed\u53e5\u63a7\u5236\u53c2\u6570\u7684\u4f5c\u7528\u57df\uff1b</li> <li>\u5f3a\u5927\u7684\u914d\u7f6e\u52a0\u8f7d\uff1a \u652f\u6301 JSON/TOML/YAML \u591a\u6587\u4ef6\u7ec4\u5408\u52a0\u8f7d (Composition) \u4e0e\u53d8\u91cf\u63d2\u503c (Interpolation)\uff1b</li> <li>\u96f6\u5f00\u9500\u6821\u9a8c\uff1a \u652f\u6301\u53ef\u9009\u7684\u57fa\u4e8e Python Type Hints \u7684 Schema \u6821\u9a8c\uff1b</li> </ul>"},{"location":"index.zh/#rust-c","title":"\u9488\u5bf9 Rust \u548c C++ \u7528\u6237","text":"<ul> <li> <p>\u9ad8\u6027\u80fd\u540e\u7aef\uff1a Hyperparameter \u5728 Rust \u4e2d\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86\u5f3a\u5927\u4e14\u9ad8\u6027\u80fd\u7684\u8d85\u53c2\u6570\u7ba1\u7406\u540e\u7aef\u3002\u5728 Rust \u548c C++ \u4e2d\u4ee5\u6700\u5c0f\u5f00\u9500\u8bbf\u95ee\u8d85\u53c2\u6570\uff0c\u975e\u5e38\u9002\u5408\u6ce8\u91cd\u6027\u80fd\u7684 ML \u548c\u7cfb\u7edf\u5f00\u53d1\u8005\u3002</p> </li> <li> <p>\u53c2\u6570\u7ba1\u7406\u5b8f\uff1a Hyperparameter \u4e3a Rust \u548c C++ \u7528\u6237\u63d0\u4f9b\u4e86\u4e00\u7ec4\u5b8f\u3002\u8fd9\u4e9b\u5b8f\u6a21\u4eff\u4e86 Python \u7684 <code>with</code> \u8bed\u53e5\uff0c\u5e76\u9075\u5faa\u7279\u5b9a\u4e8e\u8bed\u8a00\u7684\u4f5c\u7528\u57df\u89c4\u5219\u3002</p> </li> <li> <p>\u7f16\u8bd1\u65f6\u54c8\u5e0c\uff1a Rust \u548c C++ \u63a5\u53e3\u90fd\u5229\u7528\u4e86\u8d85\u53c2\u6570\u540d\u79f0\u7684\u7f16\u8bd1\u65f6\u54c8\u5e0c\uff0c\u964d\u4f4e\u4e86\u8fd0\u884c\u65f6\u54c8\u5e0c\u8ba1\u7b97\u7684\u5f00\u9500\u3002</p> </li> </ul>"},{"location":"index.zh/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"index.zh/#_3","title":"\u5b89\u88c5","text":"<pre><code>pip install hyperparameter\n</code></pre>"},{"location":"index.zh/#python_1","title":"Python","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"foo\")\ndef foo(x=1, y=\"a\"):\n    return f\"x={x}, y={y}\"\n\nfoo()  # x=1, y='a'\n\nwith hp.scope(**{\"foo.x\": 2}):\n    foo()  # x=2, y='a'\n</code></pre>"},{"location":"index.zh/#rust","title":"Rust","text":"<pre><code>fn foo() -&gt; i32 {\n    with_params! {\n        @get x = foo.x or 1i32; // \u8bfb\u53d6\u5e26\u6709\u9ed8\u8ba4\u503c\u7684\u8d85\u53c2\u6570\n\n        println!(\"x={}\", x);\n    }\n}\n\nfn main() {\n    foo(); // x=1\n\n    with_params! {\n        @set foo.x = 2i32; // \u8bbe\u7f6e\u8d85\u53c2\u6570\n\n        foo(); // x=2\n    }\n\n    foo(); // x=1\n}\n</code></pre>"},{"location":"index.zh/#c","title":"C++","text":"<pre><code>ASSERT(1 == GET_PARAM(a.b, 1), \"get undefined param\");\n{\n  auto guard = WITH_PARAMS(a, 1,        //\n                            a.b, 2.0,    //\n                            a.b.c, true, //\n                            a.b.c.d, \"str\");\n  ASSERT(1 == GET_PARAM(a, 0), \"get int value\");\n  ASSERT(1 == GET_PARAM(a, 0), \"get int value\");\n}\n</code></pre>"},{"location":"index.zh/#_4","title":"\u8be6\u7ec6\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"index.zh/#_5","title":"\u53c2\u6570\u9ed8\u8ba4\u503c","text":""},{"location":"index.zh/#python_2","title":"Python","text":"<pre><code>x = hp.scope.foo.x | \"default value\"\n</code></pre>"},{"location":"index.zh/#rust_1","title":"Rust","text":"<pre><code>@get x = foo.x or \"default value\";\n</code></pre>"},{"location":"index.zh/#_6","title":"\u63a7\u5236\u53c2\u6570\u503c\u7684\u4f5c\u7528\u57df","text":""},{"location":"index.zh/#python_3","title":"Python","text":"<pre><code>with hp.scope() as ps: # \u7b2c1\u4e2a\u4f5c\u7528\u57df\u5f00\u59cb\n    ps.foo.x=1\n    with hp.scope() as ps2: # \u7b2c2\u4e2a\u4f5c\u7528\u57df\u5f00\u59cb\n        ps.foo.y=2\n    # \u7b2c2\u4e2a\u4f5c\u7528\u57df\u7ed3\u675f\n# \u7b2c1\u4e2a\u4f5c\u7528\u57df\u7ed3\u675f\n</code></pre>"},{"location":"index.zh/#rust_2","title":"Rust","text":"<pre><code>with_params!{ // \u7b2c1\u4e2a\u4f5c\u7528\u57df\u5f00\u59cb\n    @set foo.x=1;\n\n    with_params!{ //\u7b2c2\u4e2a\u4f5c\u7528\u57df\u5f00\u59cb\n        @set foo.y=2\n\n        ...\n    } // \u7b2c2\u4e2a\u4f5c\u7528\u57df\u7ed3\u675f\n} // \u7b2c1\u4e2a\u4f5c\u7528\u57df\u7ed3\u675f\n</code></pre>"},{"location":"index.zh/#_7","title":"\u7ebf\u7a0b\u9694\u79bb/\u7ebf\u7a0b\u5b89\u5168","text":""},{"location":"index.zh/#python_4","title":"Python","text":"<pre><code>@hp.param(\"foo\")\ndef foo(x=1): # \u6253\u5370\u8d85\u53c2\u6570 foo.x\n    print(f\"foo.x={x}\")\n\nwith hp.scope() as ps:\n    ps.foo.x=2 # \u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u4fee\u6539 foo.x\n\n    foo() # foo.x=2\n    threading.Thread(target=foo).start() # foo.x=1\uff0c\u65b0\u7ebf\u7a0b\u7684\u8d85\u53c2\u6570\u503c\u4e0d\u53d7\u4e3b\u7ebf\u7a0b\u7684\u5f71\u54cd\n</code></pre>"},{"location":"index.zh/#rust_3","title":"Rust","text":"<pre><code>fn foo() { // \u6253\u5370\u8d85\u53c2\u6570 foo.x\n    with_params!{\n        @get x = foo.x or 1;\n\n        println!(\"foo.x={}\", x);\n    }\n}\n\nfn main() {\n    with_params!{\n        @set foo.x = 2; // \u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u4fee\u6539 foo.x\n\n        foo(); // foo.x=2\n        thread::spawn(foo); // foo.x=1\uff0c\u65b0\u7ebf\u7a0b\u7684\u8d85\u53c2\u6570\u503c\u4e0d\u53d7\u4e3b\u7ebf\u7a0b\u7684\u5f71\u54cd\n    }\n}\n</code></pre>"},{"location":"index.zh/#_8","title":"\u547d\u4ee4\u884c\u5e94\u7528","text":"<p>\u5728\u547d\u4ee4\u884c\u5e94\u7528\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff08\u4f8b\u5982\uff0c<code>-D, --define</code>\uff09\u5b9a\u4e49\u8d85\u53c2\u6570\uff0c\u5e76\u5728\u547d\u4ee4\u884c\u4e0a\u63a7\u5236\u8d85\u53c2\u6570\u3002\u4ee5\u4e0b\u662f Python \u548c Rust \u4e2d\u7684\u793a\u4f8b\uff1a</p>"},{"location":"index.zh/#python_5","title":"Python","text":"<pre><code># example.py\nimport hyperparameter as hp\n\n@hp.param(\"example\")\ndef main(a=0, b=1):\n    print(f\"example.a={a}, example.b={b}\")\n\nif __name__ == \"__main__\":\n    import argparse\n    parser = argparse.ArgumentParser()\n\n    parser.add_argument(\"-D\", \"--define\", nargs=\"*\", default=[], action=\"extend\")\n    args = parser.parse_args()\n\n    with hp.scope(*args.define):\n        main()\n</code></pre>"},{"location":"index.zh/#rust_4","title":"Rust","text":"<pre><code>// example.rs\nuse hyperparameter::*;\nuse hyperparameter_derive::Parser;\n\nfn main() {\n    #[derive(Parser, Debug)]\n    struct DeriveArgs {\n        #[arg(short = 'D', long)]\n        define: Vec&lt;String&gt;,\n    }\n\n    let args = DeriveArgs::parse();\n\n    with_params! {\n        params ParamScope::from(&amp;args.define);\n\n        foo()\n    }\n}\n\nfn foo() {\n    with_params! {\n        @get a = example.a or 0;\n        @get b = example.b or 1;\n\n        println!(\"example.a={}, example.b={}\",a ,b);\n    }\n}\n</code></pre>"},{"location":"index.zh/#_9","title":"\u66f4\u591a\u793a\u4f8b","text":""},{"location":"index.zh/#parameter-tuning-for-researchers","title":"parameter tuning for researchers","text":"<p>\u8be5\u793a\u4f8b\u6f14\u793a\u4e86\u5982\u4f55\u5728\u7814\u7a76\u9879\u76ee\u4e2d\u4f7f\u7528\u8d85\u53c2\u6570\uff0c\u5e76\u4f7f\u5b9e\u9a8c\u53ef\u91cd\u73b0\u3002</p>"},{"location":"index.zh/#experiment-tracing-for-data-scientists","title":"experiment tracing for data scientists","text":"<p>\u8be5\u793a\u4f8b\u5c55\u793a\u4e86\u4f7f\u7528\u8d85\u53c2\u6570\u8fdb\u884c\u5b9e\u9a8c\u7ba1\u7406\uff0c\u5e76\u901a\u8fc7 mlflow.tracing \u8fdb\u884c\u7ed3\u679c\u8ffd\u8e2a\u3002</p>"},{"location":"index.zh/#_10","title":"\u884c\u4e3a\u4fdd\u8bc1 (\u8bed\u4e49\u5951\u7ea6)","text":"<ul> <li>\u952e\u4e0e\u54c8\u5e0c (Keys &amp; hashing): \u952e\u4f7f\u7528 <code>.</code> \u8fdb\u884c\u5d4c\u5957\uff0c\u4fdd\u7559\u5927\u5c0f\u5199\uff0c\u5e76\u4e14\u5728 Python/Rust/C++ \u4e2d\u4f7f\u7528\u76f8\u540c\u7684 UTF-8 \u8f93\u5165\u548c\u79cd\u5b50\u8fdb\u884c\u54c8\u5e0c\uff1b\u975e\u6cd5\u5b57\u7b26\u5c06\u62a5\u9519\u3002</li> <li>\u8bfb\u53d6\u4f18\u5148\u7ea7 (Read precedence): \u5f53\u524d\u7ebf\u7a0b\u7684\u6700\u5185\u5c42\u4f5c\u7528\u57df &gt; \u7236\u4f5c\u7528\u57df\u5411\u5916 &gt; \u51bb\u7ed3\u7684\u5168\u5c40\u5feb\u7167 &gt; \u7528\u6237\u9ed8\u8ba4\u503c\u3002\u5199\u5165\u4ec5\u5f71\u54cd\u5f53\u524d\u4f5c\u7528\u57df\uff0c\u5e76\u5728\u9000\u51fa\u65f6\u56de\u6eda\u3002</li> <li>\u9ed8\u8ba4\u503c\u4e0e\u7f3a\u5931 (Defaults vs. missing): \u53ea\u6709\u7f3a\u5931\u7684\u952e\u624d\u4f1a\u56de\u9000\u5230\u9ed8\u8ba4\u503c\uff1b\u663e\u5f0f\u7684 <code>None</code>/<code>False</code>/<code>0</code> \u88ab\u89c6\u4e3a\u5b58\u5728\u7684\u503c\u3002\u7c7b\u578b\u8f6c\u6362\u89c4\u5219 (bool/int/float/str) \u5728\u5404\u8bed\u8a00\u95f4\u4fdd\u6301\u4e00\u81f4\uff1b\u65e0\u6548\u503c\u4f7f\u7528\u5c3d\u529b\u800c\u4e3a\u7684\u8f6c\u6362\uff0c\u5426\u5219\u56de\u9000\u5230\u63d0\u4f9b\u7684\u9ed8\u8ba4\u503c\uff08\u65e0\u9759\u9ed8\u968f\u673a\u503c\uff09\u3002</li> <li>\u7ebf\u7a0b\u4e0e <code>frozen()</code> (Threads &amp; <code>frozen()</code>): \u6bcf\u4e2a\u7ebf\u7a0b\u4ece\u51bb\u7ed3\u7684\u5168\u5c40\u5feb\u7167\u5f00\u59cb\uff1b\u53d8\u5f02\u4fdd\u6301\u5728\u7ebf\u7a0b\u5185\uff0c\u76f4\u5230\u8c03\u7528 <code>frozen()</code>\uff0c\u5b83\u539f\u5b50\u5730\u66f4\u65b0\u5168\u5c40\u5feb\u7167\u3002\u5168\u5c40\u53d8\u5f02\u5728 Python \u540e\u7aef\u53d7\u5230\u9501\u4fdd\u62a4\uff0c\u4e0e Rust \u8bed\u4e49\u5339\u914d\u3002</li> <li>\u9519\u8bef\u6a21\u578b (Error model): \u8bfb\u53d6\u672a\u5b9a\u4e49\u7684\u952e\u4e14\u65e0\u9ed8\u8ba4\u503c\u4f1a\u5f15\u53d1\u952e\u9519\u8bef\uff1b\u540e\u7aef\u52a0\u8f7d\u5931\u8d25\u4f1a\u56de\u9000\u5230 Python \u540e\u7aef\uff0c\u65e0\u5608\u6742\u7684\u56de\u6eaf\u4fe1\u606f\uff1b\u7c7b\u578b\u9519\u8bef\u65e0\u9759\u9ed8\u5931\u8d25\u3002</li> <li>\u591a\u8fdb\u7a0b\u6ce8\u610f (Multiprocess notice): \u8de8\u8fdb\u7a0b\u4e00\u81f4\u6027\u9700\u8981\u5171\u4eab\u540e\u7aef\uff08\u4f8b\u5982\uff0cRust \u540e\u7aef\u6216\u7528\u6237\u63d0\u4f9b\u7684\u5b58\u50a8\u9002\u914d\u5668\uff09\uff1b\u5185\u7f6e\u7684 Python \u540e\u7aef\u4ec5\u4fdd\u62a4\u7ebf\u7a0b\uff0c\u4e0d\u4fdd\u62a4\u8fdb\u7a0b\u3002</li> </ul>"},{"location":"migration_from_hydra/","title":"Migrating from Hydra","text":"<ul> <li>\u4e2d\u6587</li> </ul>"},{"location":"migration_from_hydra/#migrating-from-hydra","title":"Migrating from Hydra","text":"<p>This guide helps you migrate existing projects from Hydra to Hyperparameter. We'll cover the key differences and provide side-by-side comparisons.</p>"},{"location":"migration_from_hydra/#why-migrate","title":"Why Migrate?","text":"Aspect Hydra Hyperparameter Performance Pure Python (slower in loops) Rust backend (6-850x faster) Dependencies Heavy (antlr4, omegaconf, etc.) Minimal (only <code>toml</code>) Config Style Top-down (pass <code>cfg</code> everywhere) Bottom-up (inject into functions) Scoping Static (compose at startup) Dynamic (change at runtime)"},{"location":"migration_from_hydra/#quick-comparison","title":"Quick Comparison","text":""},{"location":"migration_from_hydra/#defining-parameters","title":"Defining Parameters","text":"<p>Hydra: <pre><code># config.yaml\nmodel:\n  hidden_size: 256\n  dropout: 0.1\n\n# main.py\nimport hydra\nfrom omegaconf import DictConfig\n\n@hydra.main(config_path=\".\", config_name=\"config\")\ndef main(cfg: DictConfig):\n    print(cfg.model.hidden_size)  # 256\n</code></pre></p> <p>Hyperparameter: <pre><code># config.toml\n[model]\nhidden_size = 256\ndropout = 0.1\n\n# main.py\nimport hyperparameter as hp\n\n@hp.param(\"model\")\ndef build_model(hidden_size=128, dropout=0.0):\n    print(hidden_size)  # 256 (from config)\n\nif __name__ == \"__main__\":\n    cfg = hp.config(\"config.toml\")\n    with hp.scope(**cfg):\n        build_model()\n</code></pre></p>"},{"location":"migration_from_hydra/#config-composition-multiple-files","title":"Config Composition (Multiple Files)","text":"<p>Hydra: <pre><code># config.yaml\ndefaults:\n  - model: resnet\n  - dataset: imagenet\n  - _self_\n\n# model/resnet.yaml\nname: resnet50\nlayers: 50\n</code></pre></p> <p>Hyperparameter: <pre><code>import hyperparameter as hp\n\n# Load and merge multiple configs (later files override earlier)\ncfg = hp.config([\"base.toml\", \"model/resnet.toml\", \"dataset/imagenet.toml\"])\n\nwith hp.scope(**cfg):\n    train()\n</code></pre></p>"},{"location":"migration_from_hydra/#variable-interpolation","title":"Variable Interpolation","text":"<p>Hydra (OmegaConf): <pre><code>paths:\n  data_dir: /data\n  output_dir: ${paths.data_dir}/outputs\n</code></pre></p> <p>Hyperparameter: <pre><code>[paths]\ndata_dir = \"/data\"\noutput_dir = \"${paths.data_dir}/outputs\"\n</code></pre></p> <p>Both support the same <code>${key}</code> syntax!</p>"},{"location":"migration_from_hydra/#schema-validation","title":"Schema Validation","text":"<p>Hydra (with dataclass): <pre><code>from dataclasses import dataclass\nfrom hydra.core.config_store import ConfigStore\n\n@dataclass\nclass ModelConfig:\n    hidden_size: int = 256\n    dropout: float = 0.1\n\ncs = ConfigStore.instance()\ncs.store(name=\"model_config\", node=ModelConfig)\n</code></pre></p> <p>Hyperparameter: <pre><code>from dataclasses import dataclass\nimport hyperparameter as hp\n\n@dataclass\nclass ModelConfig:\n    hidden_size: int = 256\n    dropout: float = 0.1\n\n# Direct validation, no ConfigStore needed\ncfg = hp.config(\"config.toml\", schema=ModelConfig)\nprint(cfg.hidden_size)  # IDE autocomplete works!\n</code></pre></p>"},{"location":"migration_from_hydra/#command-line-overrides","title":"Command Line Overrides","text":"<p>Hydra: <pre><code>python train.py model.hidden_size=512 model.dropout=0.2\n</code></pre></p> <p>Hyperparameter: <pre><code>python train.py -D model.hidden_size=512 -D model.dropout=0.2\n# Or with config file:\npython train.py -C config.toml -D model.hidden_size=512\n</code></pre></p>"},{"location":"migration_from_hydra/#dynamic-scoping-hyperparameter-exclusive","title":"Dynamic Scoping (Hyperparameter Exclusive)","text":"<p>This is something Hydra cannot do easily:</p> <pre><code>import hyperparameter as hp\n\n@hp.param(\"layer\")\ndef create_layer(dropout=0.1):\n    return f\"Layer with dropout={dropout}\"\n\n# Different dropout for different layers - no code change needed!\nwith hp.scope(**{\"layer.dropout\": 0.1}):\n    layer1 = create_layer()  # dropout=0.1\n\nwith hp.scope(**{\"layer.dropout\": 0.5}):\n    layer2 = create_layer()  # dropout=0.5\n</code></pre>"},{"location":"migration_from_hydra/#migration-checklist","title":"Migration Checklist","text":"<ul> <li>[ ] Config Files: Convert YAML to TOML/JSON (or keep YAML with PyYAML installed)</li> <li>[ ] Decorators: Replace <code>@hydra.main</code> with <code>@hp.param</code> + <code>hp.launch()</code></li> <li>[ ] Config Access: Replace <code>cfg.x.y</code> with <code>hp.scope.x.y | default</code> or function injection</li> <li>[ ] Composition: Replace <code>defaults</code> list with <code>hp.config([file1, file2])</code></li> <li>[ ] Interpolation: Same syntax <code>${key}</code> works</li> <li>[ ] CLI: Replace positional overrides with <code>-D key=value</code></li> </ul>"},{"location":"migration_from_hydra/#what-youll-gain","title":"What You'll Gain","text":"<ol> <li>Performance: 6x faster in dynamic access, 850x faster with injection</li> <li>Simplicity: No ConfigStore, no <code>@hydra.main</code> boilerplate</li> <li>Flexibility: Dynamic scoping for complex control flows</li> <li>Lightweight: Fewer dependencies, faster startup</li> </ol>"},{"location":"migration_from_hydra/#what-youll-lose-for-now","title":"What You'll Lose (For Now)","text":"<ol> <li>Sweeper Plugins: No built-in Optuna/Ax integration (but easy to implement manually)</li> <li>Launcher Plugins: No SLURM/submitit integration</li> <li>Output Management: No automatic <code>outputs/date/time</code> directories</li> <li>Tab Completion: No shell autocomplete for config options</li> </ol> <p>These features may be added in future versions based on community feedback.</p>"},{"location":"migration_from_hydra/#need-help","title":"Need Help?","text":"<ul> <li>GitHub Issues</li> <li>Examples Directory</li> </ul>"},{"location":"migration_from_hydra.zh/","title":"\u4ece Hydra \u8fc1\u79fb","text":"<ul> <li>English</li> </ul>"},{"location":"migration_from_hydra.zh/#hydra","title":"\u4ece Hydra \u8fc1\u79fb\u6307\u5357","text":"<p>\u672c\u6307\u5357\u5e2e\u52a9\u4f60\u5c06\u73b0\u6709\u9879\u76ee\u4ece Hydra \u8fc1\u79fb\u5230 Hyperparameter\u3002\u6211\u4eec\u5c06\u4ecb\u7ecd\u4e24\u8005\u7684\u5173\u952e\u5dee\u5f02\uff0c\u5e76\u63d0\u4f9b\u5bf9\u7167\u793a\u4f8b\u3002</p>"},{"location":"migration_from_hydra.zh/#_1","title":"\u4e3a\u4ec0\u4e48\u8981\u8fc1\u79fb\uff1f","text":"\u65b9\u9762 Hydra Hyperparameter \u6027\u80fd \u7eaf Python\uff08\u5faa\u73af\u4e2d\u8f83\u6162\uff09 Rust \u540e\u7aef\uff08\u5feb 6-850 \u500d\uff09 \u4f9d\u8d56 \u91cd\u578b\uff08antlr4, omegaconf \u7b49\uff09 \u6781\u7b80\uff08\u4ec5\u9700 <code>toml</code>\uff09 \u914d\u7f6e\u98ce\u683c \u81ea\u4e0a\u800c\u4e0b\uff08\u5230\u5904\u4f20\u9012 <code>cfg</code>\uff09 \u81ea\u4e0b\u800c\u4e0a\uff08\u6ce8\u5165\u5230\u51fd\u6570\u4e2d\uff09 \u4f5c\u7528\u57df \u9759\u6001\uff08\u542f\u52a8\u65f6\u7ec4\u88c5\uff09 \u52a8\u6001\uff08\u8fd0\u884c\u65f6\u53ef\u53d8\uff09"},{"location":"migration_from_hydra.zh/#_2","title":"\u5feb\u901f\u5bf9\u6bd4","text":""},{"location":"migration_from_hydra.zh/#_3","title":"\u5b9a\u4e49\u53c2\u6570","text":"<p>Hydra: <pre><code># config.yaml\nmodel:\n  hidden_size: 256\n  dropout: 0.1\n\n# main.py\nimport hydra\nfrom omegaconf import DictConfig\n\n@hydra.main(config_path=\".\", config_name=\"config\")\ndef main(cfg: DictConfig):\n    print(cfg.model.hidden_size)  # 256\n</code></pre></p> <p>Hyperparameter: <pre><code># config.toml\n[model]\nhidden_size = 256\ndropout = 0.1\n\n# main.py\nimport hyperparameter as hp\n\n@hp.param(\"model\")\ndef build_model(hidden_size=128, dropout=0.0):\n    print(hidden_size)  # 256 (\u6765\u81ea\u914d\u7f6e\u6587\u4ef6)\n\nif __name__ == \"__main__\":\n    cfg = hp.config(\"config.toml\")\n    with hp.scope(**cfg):\n        build_model()\n</code></pre></p>"},{"location":"migration_from_hydra.zh/#_4","title":"\u914d\u7f6e\u7ec4\u5408\uff08\u591a\u6587\u4ef6\uff09","text":"<p>Hydra: <pre><code># config.yaml\ndefaults:\n  - model: resnet\n  - dataset: imagenet\n  - _self_\n\n# model/resnet.yaml\nname: resnet50\nlayers: 50\n</code></pre></p> <p>Hyperparameter: <pre><code>import hyperparameter as hp\n\n# \u52a0\u8f7d\u5e76\u5408\u5e76\u591a\u4e2a\u914d\u7f6e\uff08\u540e\u9762\u7684\u6587\u4ef6\u8986\u76d6\u524d\u9762\u7684\uff09\ncfg = hp.config([\"base.toml\", \"model/resnet.toml\", \"dataset/imagenet.toml\"])\n\nwith hp.scope(**cfg):\n    train()\n</code></pre></p>"},{"location":"migration_from_hydra.zh/#_5","title":"\u53d8\u91cf\u63d2\u503c","text":"<p>Hydra (OmegaConf): <pre><code>paths:\n  data_dir: /data\n  output_dir: ${paths.data_dir}/outputs\n</code></pre></p> <p>Hyperparameter: <pre><code>[paths]\ndata_dir = \"/data\"\noutput_dir = \"${paths.data_dir}/outputs\"\n</code></pre></p> <p>\u4e24\u8005\u90fd\u652f\u6301\u76f8\u540c\u7684 <code>${key}</code> \u8bed\u6cd5\uff01</p>"},{"location":"migration_from_hydra.zh/#schema","title":"Schema \u6821\u9a8c","text":"<p>Hydra (\u4f7f\u7528 dataclass): <pre><code>from dataclasses import dataclass\nfrom hydra.core.config_store import ConfigStore\n\n@dataclass\nclass ModelConfig:\n    hidden_size: int = 256\n    dropout: float = 0.1\n\ncs = ConfigStore.instance()\ncs.store(name=\"model_config\", node=ModelConfig)\n</code></pre></p> <p>Hyperparameter: <pre><code>from dataclasses import dataclass\nimport hyperparameter as hp\n\n@dataclass\nclass ModelConfig:\n    hidden_size: int = 256\n    dropout: float = 0.1\n\n# \u76f4\u63a5\u6821\u9a8c\uff0c\u65e0\u9700 ConfigStore\ncfg = hp.config(\"config.toml\", schema=ModelConfig)\nprint(cfg.hidden_size)  # IDE \u81ea\u52a8\u8865\u5168\u53ef\u7528\uff01\n</code></pre></p>"},{"location":"migration_from_hydra.zh/#_6","title":"\u547d\u4ee4\u884c\u8986\u76d6","text":"<p>Hydra: <pre><code>python train.py model.hidden_size=512 model.dropout=0.2\n</code></pre></p> <p>Hyperparameter: <pre><code>python train.py -D model.hidden_size=512 -D model.dropout=0.2\n# \u6216\u914d\u5408\u914d\u7f6e\u6587\u4ef6\uff1a\npython train.py -C config.toml -D model.hidden_size=512\n</code></pre></p>"},{"location":"migration_from_hydra.zh/#hyperparameter","title":"\u52a8\u6001\u4f5c\u7528\u57df\uff08Hyperparameter \u72ec\u6709\uff09","text":"<p>\u8fd9\u662f Hydra \u5f88\u96be\u505a\u5230\u7684\uff1a</p> <pre><code>import hyperparameter as hp\n\n@hp.param(\"layer\")\ndef create_layer(dropout=0.1):\n    return f\"Layer with dropout={dropout}\"\n\n# \u4e0d\u540c\u5c42\u4f7f\u7528\u4e0d\u540c\u7684 dropout \u2014\u2014 \u65e0\u9700\u4fee\u6539\u4ee3\u7801\uff01\nwith hp.scope(**{\"layer.dropout\": 0.1}):\n    layer1 = create_layer()  # dropout=0.1\n\nwith hp.scope(**{\"layer.dropout\": 0.5}):\n    layer2 = create_layer()  # dropout=0.5\n</code></pre>"},{"location":"migration_from_hydra.zh/#_7","title":"\u8fc1\u79fb\u6e05\u5355","text":"<ul> <li>[ ] \u914d\u7f6e\u6587\u4ef6: \u5c06 YAML \u8f6c\u6362\u4e3a TOML/JSON\uff08\u6216\u5b89\u88c5 PyYAML \u540e\u7ee7\u7eed\u4f7f\u7528 YAML\uff09</li> <li>[ ] \u88c5\u9970\u5668: \u5c06 <code>@hydra.main</code> \u66ff\u6362\u4e3a <code>@hp.param</code> + <code>hp.launch()</code></li> <li>[ ] \u914d\u7f6e\u8bbf\u95ee: \u5c06 <code>cfg.x.y</code> \u66ff\u6362\u4e3a <code>hp.scope.x.y | default</code> \u6216\u51fd\u6570\u6ce8\u5165</li> <li>[ ] \u914d\u7f6e\u7ec4\u5408: \u5c06 <code>defaults</code> \u5217\u8868\u66ff\u6362\u4e3a <code>hp.config([file1, file2])</code></li> <li>[ ] \u53d8\u91cf\u63d2\u503c: \u76f8\u540c\u7684 <code>${key}</code> \u8bed\u6cd5\u53ef\u76f4\u63a5\u4f7f\u7528</li> <li>[ ] \u547d\u4ee4\u884c: \u5c06\u4f4d\u7f6e\u53c2\u6570\u8986\u76d6\u66ff\u6362\u4e3a <code>-D key=value</code></li> </ul>"},{"location":"migration_from_hydra.zh/#_8","title":"\u4f60\u5c06\u83b7\u5f97","text":"<ol> <li>\u6027\u80fd\u63d0\u5347: \u52a8\u6001\u8bbf\u95ee\u5feb 6 \u500d\uff0c\u6ce8\u5165\u6a21\u5f0f\u5feb 850 \u500d</li> <li>\u7b80\u6d01\u6027: \u65e0\u9700 ConfigStore\uff0c\u65e0\u9700 <code>@hydra.main</code> \u6837\u677f\u4ee3\u7801</li> <li>\u7075\u6d3b\u6027: \u52a8\u6001\u4f5c\u7528\u57df\uff0c\u9002\u5e94\u590d\u6742\u63a7\u5236\u6d41</li> <li>\u8f7b\u91cf\u7ea7: \u66f4\u5c11\u4f9d\u8d56\uff0c\u66f4\u5feb\u542f\u52a8</li> </ol>"},{"location":"migration_from_hydra.zh/#_9","title":"\u4f60\u5c06\u6682\u65f6\u5931\u53bb","text":"<ol> <li>Sweeper \u63d2\u4ef6: \u65e0\u5185\u7f6e Optuna/Ax \u96c6\u6210\uff08\u4f46\u53ef\u8f7b\u677e\u624b\u52a8\u5b9e\u73b0\uff09</li> <li>Launcher \u63d2\u4ef6: \u65e0 SLURM/submitit \u96c6\u6210</li> <li>\u8f93\u51fa\u7ba1\u7406: \u65e0\u81ea\u52a8 <code>outputs/date/time</code> \u76ee\u5f55</li> <li>Tab \u8865\u5168: \u65e0\u914d\u7f6e\u9009\u9879\u7684 Shell \u81ea\u52a8\u8865\u5168</li> </ol> <p>\u8fd9\u4e9b\u529f\u80fd\u53ef\u80fd\u4f1a\u6839\u636e\u793e\u533a\u53cd\u9988\u5728\u672a\u6765\u7248\u672c\u4e2d\u6dfb\u52a0\u3002</p>"},{"location":"migration_from_hydra.zh/#_10","title":"\u9700\u8981\u5e2e\u52a9\uff1f","text":"<ul> <li>GitHub Issues</li> <li>\u793a\u4f8b\u76ee\u5f55</li> </ul>"},{"location":"quick_start/","title":"quick","text":"<ul> <li>\u4e2d\u6587</li> </ul>"},{"location":"quick_start/#quick-start","title":"Quick Start","text":"<p>Hyperparameter is a configuration management library providing thread-safe scoping, automatic parameter binding, and CLI integration.</p> <pre><code>pip install hyperparameter\n</code></pre>"},{"location":"quick_start/#1-basic-usage","title":"1. Basic Usage","text":""},{"location":"quick_start/#11-reading-parameters-with-defaults","title":"1.1 Reading Parameters with Defaults","text":"<pre><code>import hyperparameter as hp\n\n# Use | operator to provide default values\nlr = hp.scope.train.lr | 0.001\nbatch_size = hp.scope.train.batch_size | 32\n\n# Use function call syntax (equivalent to |)\nuse_cache = hp.scope.model.cache(True)\n\n# Call without arguments: raises KeyError if missing\nrequired_value = hp.scope.model.required_key()  # KeyError if missing\n</code></pre> <p><code>hp.scope.key(default)</code> is equivalent to <code>hp.scope.key | default</code>. Calling <code>hp.scope.key()</code> without arguments treats the parameter as required and raises <code>KeyError</code> if missing.</p>"},{"location":"quick_start/#12-scoping-and-auto-rollback","title":"1.2 Scoping and Auto-Rollback","text":"<pre><code>import hyperparameter as hp\n\nprint(hp.scope.model.dropout | 0.1)  # 0.1\n\nwith hp.scope(**{\"model.dropout\": 0.3}):\n    print(hp.scope.model.dropout | 0.1)  # 0.3\n\nprint(hp.scope.model.dropout | 0.1)  # 0.1, auto-rollback on scope exit\n</code></pre> <p>All parameter modifications within a <code>with</code> block are automatically reverted when the scope exits.</p>"},{"location":"quick_start/#2-hpparam-decorator","title":"2. @hp.param Decorator","text":""},{"location":"quick_start/#21-automatic-parameter-binding","title":"2.1 Automatic Parameter Binding","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"train\")\ndef train(lr=1e-3, batch_size=32, epochs=10):\n    print(f\"lr={lr}, batch_size={batch_size}, epochs={epochs}\")\n\ntrain()  # Uses function signature defaults\n\nwith hp.scope(**{\"train.lr\": 5e-4, \"train.batch_size\": 64}):\n    train()  # lr=0.0005, batch_size=64, epochs=10\n\ntrain(lr=1e-2)  # Direct arguments take highest priority\n</code></pre> <p>Parameter resolution priority: direct arguments &gt; scope overrides &gt; function signature defaults.</p>"},{"location":"quick_start/#22-cli-override","title":"2.2 CLI Override","text":"<pre><code># train.py\nimport hyperparameter as hp\n\n@hp.param(\"train\")\ndef train(lr=1e-3, batch_size=32, warmup_steps=500):\n    print(f\"lr={lr}, batch_size={batch_size}, warmup={warmup_steps}\")\n\nif __name__ == \"__main__\":\n    import argparse\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"-D\", \"--define\", nargs=\"*\", default=[], action=\"extend\")\n    args = parser.parse_args()\n\n    with hp.scope(*args.define):\n        train()\n</code></pre> <pre><code>python train.py -D train.lr=5e-4 -D train.batch_size=64\n</code></pre> <p>Override parameters at runtime with <code>-D key=value</code> without modifying code.</p>"},{"location":"quick_start/#3-nested-scopes","title":"3. Nested Scopes","text":""},{"location":"quick_start/#31-multi-model-comparison","title":"3.1 Multi-Model Comparison","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"modelA\")\ndef run_model_a(dropout=0.1, hidden=128):\n    print(f\"ModelA: dropout={dropout}, hidden={hidden}\")\n\n@hp.param(\"modelB\")\ndef run_model_b(dropout=0.2, hidden=256):\n    print(f\"ModelB: dropout={dropout}, hidden={hidden}\")\n\nbase = {\"data.path\": \"/data/mnist\"}\nvariants = [\n    {\"modelA.dropout\": 0.3},\n    {\"modelB.hidden\": 512, \"modelB.dropout\": 0.15},\n]\n\nwith hp.scope(**base):\n    for cfg in variants:\n        with hp.scope(**cfg):\n            run_model_a()\n            run_model_b()\n</code></pre> <p>Outer scopes set shared configuration; inner scopes override specific parameters. Scopes are isolated from each other.</p>"},{"location":"quick_start/#32-dynamic-key-access","title":"3.2 Dynamic Key Access","text":"<pre><code>import hyperparameter as hp\n\ndef train_task(task_name):\n    lr = scope[f\"task.{task_name}.lr\"] | 1e-3\n    wd = scope[f\"task.{task_name}.weight_decay\"] | 0.01\n    print(f\"{task_name}: lr={lr}, weight_decay={wd}\")\n\nwith hp.scope(**{\n    \"task.cls.lr\": 1e-3,\n    \"task.cls.weight_decay\": 0.01,\n    \"task.seg.lr\": 5e-4,\n    \"task.seg.weight_decay\": 0.001,\n}):\n    train_task(\"cls\")\n    train_task(\"seg\")\n</code></pre> <p>Use <code>scope[key]</code> syntax for dynamically constructed keys.</p>"},{"location":"quick_start/#4-thread-safety","title":"4. Thread Safety","text":""},{"location":"quick_start/#41-request-level-isolation","title":"4.1 Request-Level Isolation","text":"<pre><code>import hyperparameter as hp\n\ndef rerank(items):\n    use_new = hp.scope.rerank.use_new(False)\n    threshold = hp.scope.rerank.threshold | 0.8\n    if use_new:\n        return [x for x in items if x.score &gt;= threshold]\n    return items\n\ndef handle_request(request):\n    with hp.scope(**request.overrides):\n        return rerank(request.items)\n</code></pre> <p>Each request executes in an isolated hp.scope. Configuration changes do not affect other concurrent requests.</p>"},{"location":"quick_start/#42-multi-threaded-data-processing","title":"4.2 Multi-threaded Data Processing","text":"<pre><code>import concurrent.futures\nimport hyperparameter as hp\n\ndef preprocess(shard, cfg):\n    with hp.scope(**cfg):\n        clean = hp.scope.pre.clean_noise(False)\n        norm = hp.scope.pre.norm | \"zscore\"\n        # Processing logic\n        return processed_shard\n\ncfg = {\"pre.clean_noise\": True, \"pre.norm\": \"minmax\"}\nshards = load_shards()\n\nwith concurrent.futures.ThreadPoolExecutor(max_workers=4) as executor:\n    results = list(executor.map(lambda s: preprocess(s, cfg), shards))\n</code></pre> <p>Thread safety guarantees: - Configuration dicts can be safely passed to multiple threads - Each thread's <code>scope</code> modifications are isolated - Automatic cleanup on scope exit</p>"},{"location":"quick_start/#5-common-use-cases","title":"5. Common Use Cases","text":""},{"location":"quick_start/#51-llm-inference-configuration","title":"5.1 LLM Inference Configuration","text":"<pre><code>import hyperparameter as hp\n\ndef generate(prompt):\n    max_tokens = hp.scope.llm.max_tokens | 256\n    temperature = hp.scope.llm.temperature | 0.7\n    return llm_call(prompt, max_tokens=max_tokens, temperature=temperature)\n\n# Default configuration\ngenerate(\"hello\")\n\n# Temporary override\nwith hp.scope(**{\"llm.max_tokens\": 64, \"llm.temperature\": 0.2}):\n    generate(\"short answer\")\n</code></pre>"},{"location":"quick_start/#52-ab-testing","title":"5.2 A/B Testing","text":"<pre><code>import hyperparameter as hp\n\ndef get_experiment_config(user_id):\n    if hash(user_id) % 100 &lt; 10:  # 10% traffic\n        return {\"search.algo\": \"v2\", \"search.boost\": 1.5}\n    return {}\n\ndef search(query):\n    algo = hp.scope.search.algo | \"v1\"\n    boost = hp.scope.search.boost | 1.0\n    # Search logic\n\ndef handle_request(user_id, query):\n    with hp.scope(**get_experiment_config(user_id)):\n        return search(query)\n</code></pre>"},{"location":"quick_start/#53-etl-job-configuration","title":"5.3 ETL Job Configuration","text":"<pre><code>import hyperparameter as hp\n\ndef run_job(name, overrides=None):\n    with hp.scope(**(overrides or {})):\n        batch = hp.scope.etl.batch_size | 500\n        retry = hp.scope.etl.retry | 3\n        timeout = hp.scope.etl.timeout | 30\n        # ETL logic\n\nrun_job(\"daily\")\nrun_job(\"full_rebuild\", {\"etl.batch_size\": 5000, \"etl.timeout\": 300})\n</code></pre>"},{"location":"quick_start/#54-early-stopping","title":"5.4 Early Stopping","text":"<pre><code>import hyperparameter as hp\n\ndef check_early_stop(metric, best, wait):\n    patience = hp.scope.scheduler.patience | 5\n    delta = hp.scope.scheduler.min_delta | 0.001\n\n    if metric &gt; best + delta:\n        return False, metric, 0\n    wait += 1\n    return wait &gt;= patience, best, wait\n</code></pre>"},{"location":"quick_start/#6-rust-interface","title":"6. Rust Interface","text":""},{"location":"quick_start/#61-basic-usage","title":"6.1 Basic Usage","text":"<pre><code>use hyperparameter::*;\n\nfn train() {\n    with_params! {\n        get lr = train.lr or 0.001f64;\n        get batch_size = train.batch_size or 32i64;\n        println!(\"lr={}, batch_size={}\", lr, batch_size);\n    }\n}\n\nfn main() {\n    train();  // Uses default values\n\n    with_params! {\n        set train.lr = 0.0005f64;\n        set train.batch_size = 64i64;\n        train();\n    };\n\n    train();  // Rollback to defaults\n}\n</code></pre>"},{"location":"quick_start/#62-thread-isolation-with-frozen","title":"6.2 Thread Isolation with frozen()","text":"<pre><code>use hyperparameter::*;\nuse std::thread;\n\nfn worker(id: i64) {\n    with_params! {\n        set worker.id = id;\n        for i in 0..5 {\n            with_params! {\n                set worker.iter = i;\n                get wid = worker.id or -1i64;\n                get witer = worker.iter or -1i64;\n                println!(\"Worker {} iter {}\", wid, witer);\n            };\n        }\n    };\n}\n\nfn main() {\n    with_params! {\n        set global.seed = 42i64;\n        frozen();  // Snapshot current config as initial state for new threads\n    };\n\n    let handles: Vec&lt;_&gt; = (0..4)\n        .map(|id| thread::spawn(move || worker(id)))\n        .collect();\n\n    for h in handles {\n        h.join().unwrap();\n    }\n}\n</code></pre> <p><code>frozen()</code> snapshots the current configuration as the global baseline. New threads start from this snapshot, with subsequent modifications isolated between threads.</p>"},{"location":"quick_start/#7-api-reference","title":"7. API Reference","text":"Usage Description <code>hp.scope.a.b \\| default</code> Read parameter with default value <code>hp.scope.a.b(default)</code> Same as above, function call syntax <code>hp.scope.a.b()</code> Read required parameter, raises KeyError if missing <code>scope[\"a.b\"]</code> Dynamic key access <code>with hp.scope(**dict):</code> Create scope with parameter overrides <code>with hp.scope(*list):</code> Create scope from string list (e.g., CLI args) <code>@hp.param(\"ns\")</code> Decorator to bind function parameters to <code>ns.*</code>"},{"location":"quick_start/#8-best-practices","title":"8. Best Practices","text":"<ol> <li>Key naming: Use <code>.</code> to separate hierarchy levels, e.g., <code>train.optimizer.lr</code></li> <li>Type consistency: Keep the same type for a given key across usages</li> <li>Default values: Always provide defaults to avoid KeyError</li> <li>Scope minimization: Keep scopes as narrow as possible</li> <li>Process boundaries: Cross-process scenarios require Rust backend or custom storage adapter</li> </ol>"},{"location":"quick_start.zh/","title":"quick","text":"<ul> <li>English</li> </ul>"},{"location":"quick_start.zh/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>Hyperparameter \u662f\u4e00\u4e2a\u914d\u7f6e\u53c2\u6570\u7ba1\u7406\u5e93\uff0c\u63d0\u4f9b\u7ebf\u7a0b\u5b89\u5168\u7684\u4f5c\u7528\u57df\u63a7\u5236\u3001\u81ea\u52a8\u53c2\u6570\u7ed1\u5b9a\u548c CLI \u96c6\u6210\u3002</p> <pre><code>pip install hyperparameter\n</code></pre>"},{"location":"quick_start.zh/#1","title":"1. \u57fa\u7840\u7528\u6cd5","text":""},{"location":"quick_start.zh/#11","title":"1.1 \u53c2\u6570\u8bfb\u53d6\u4e0e\u9ed8\u8ba4\u503c","text":"<pre><code>import hyperparameter as hp\n\n# \u4f7f\u7528 | \u8fd0\u7b97\u7b26\u63d0\u4f9b\u9ed8\u8ba4\u503c\nlr = hp.scope.train.lr | 0.001\nbatch_size = hp.scope.train.batch_size | 32\n\n# \u4f7f\u7528\u51fd\u6570\u8c03\u7528\u8bed\u6cd5\u63d0\u4f9b\u9ed8\u8ba4\u503c\uff08\u4e0e | \u7b49\u4ef7\uff09\nuse_cache = hp.scope.model.cache(True)\n\n# \u4e0d\u5e26\u53c2\u6570\u8c03\u7528\uff1a\u53c2\u6570\u4e0d\u5b58\u5728\u65f6\u629b\u51fa KeyError\nrequired_value = hp.scope.model.required_key()  # KeyError if missing\n</code></pre> <p><code>hp.scope.key(default)</code> \u4e0e <code>hp.scope.key | default</code> \u7b49\u4ef7\u3002\u4e0d\u5e26\u53c2\u6570\u8c03\u7528 <code>hp.scope.key()</code> \u8868\u793a\u8be5\u53c2\u6570\u4e3a\u5fc5\u9700\u9879\uff0c\u7f3a\u5931\u65f6\u629b\u51fa <code>KeyError</code>\u3002</p>"},{"location":"quick_start.zh/#12","title":"1.2 \u4f5c\u7528\u57df\u4e0e\u81ea\u52a8\u56de\u6eda","text":"<pre><code>import hyperparameter as hp\n\nprint(hp.scope.model.dropout | 0.1)  # 0.1\n\nwith hp.scope(**{\"model.dropout\": 0.3}):\n    print(hp.scope.model.dropout | 0.1)  # 0.3\n\nprint(hp.scope.model.dropout | 0.1)  # 0.1\uff0c\u4f5c\u7528\u57df\u9000\u51fa\u540e\u81ea\u52a8\u56de\u6eda\n</code></pre> <p><code>with</code> \u8bed\u53e5\u9000\u51fa\u65f6\uff0c\u8be5\u4f5c\u7528\u57df\u5185\u7684\u6240\u6709\u53c2\u6570\u4fee\u6539\u81ea\u52a8\u64a4\u9500\u3002</p>"},{"location":"quick_start.zh/#2-hpparam","title":"2. @hp.param \u88c5\u9970\u5668","text":""},{"location":"quick_start.zh/#21","title":"2.1 \u51fd\u6570\u53c2\u6570\u81ea\u52a8\u7ed1\u5b9a","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"train\")\ndef train(lr=1e-3, batch_size=32, epochs=10):\n    print(f\"lr={lr}, batch_size={batch_size}, epochs={epochs}\")\n\ntrain()  # \u4f7f\u7528\u51fd\u6570\u7b7e\u540d\u4e2d\u7684\u9ed8\u8ba4\u503c\n\nwith hp.scope(**{\"train.lr\": 5e-4, \"train.batch_size\": 64}):\n    train()  # lr=0.0005, batch_size=64, epochs=10\n\ntrain(lr=1e-2)  # \u76f4\u63a5\u4f20\u53c2\uff0c\u4f18\u5148\u7ea7\u6700\u9ad8\n</code></pre> <p>\u53c2\u6570\u89e3\u6790\u4f18\u5148\u7ea7\uff1a\u76f4\u63a5\u4f20\u53c2 &gt; scope \u8986\u76d6 &gt; \u51fd\u6570\u7b7e\u540d\u9ed8\u8ba4\u503c\u3002</p>"},{"location":"quick_start.zh/#22","title":"2.2 \u547d\u4ee4\u884c\u8986\u76d6","text":"<pre><code># train.py\nimport hyperparameter as hp\n\n@hp.param(\"train\")\ndef train(lr=1e-3, batch_size=32, warmup_steps=500):\n    print(f\"lr={lr}, batch_size={batch_size}, warmup={warmup_steps}\")\n\nif __name__ == \"__main__\":\n    import argparse\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"-D\", \"--define\", nargs=\"*\", default=[], action=\"extend\")\n    args = parser.parse_args()\n\n    with hp.scope(*args.define):\n        train()\n</code></pre> <pre><code>python train.py -D train.lr=5e-4 -D train.batch_size=64\n</code></pre> <p>\u901a\u8fc7 <code>-D key=value</code> \u5728\u8fd0\u884c\u65f6\u8986\u76d6\u53c2\u6570\uff0c\u65e0\u9700\u4fee\u6539\u4ee3\u7801\u3002</p>"},{"location":"quick_start.zh/#3","title":"3. \u5d4c\u5957\u4f5c\u7528\u57df","text":""},{"location":"quick_start.zh/#31","title":"3.1 \u591a\u6a21\u578b\u5bf9\u6bd4\u5b9e\u9a8c","text":"<pre><code>import hyperparameter as hp\n\n@hp.param(\"modelA\")\ndef run_model_a(dropout=0.1, hidden=128):\n    print(f\"ModelA: dropout={dropout}, hidden={hidden}\")\n\n@hp.param(\"modelB\")\ndef run_model_b(dropout=0.2, hidden=256):\n    print(f\"ModelB: dropout={dropout}, hidden={hidden}\")\n\nbase = {\"data.path\": \"/data/mnist\"}\nvariants = [\n    {\"modelA.dropout\": 0.3},\n    {\"modelB.hidden\": 512, \"modelB.dropout\": 0.15},\n]\n\nwith hp.scope(**base):\n    for cfg in variants:\n        with hp.scope(**cfg):\n            run_model_a()\n            run_model_b()\n</code></pre> <p>\u5916\u5c42\u4f5c\u7528\u57df\u8bbe\u7f6e\u516c\u5171\u914d\u7f6e\uff0c\u5185\u5c42\u4f5c\u7528\u57df\u8986\u76d6\u7279\u5b9a\u53c2\u6570\uff0c\u4f5c\u7528\u57df\u4e4b\u95f4\u76f8\u4e92\u9694\u79bb\u3002</p>"},{"location":"quick_start.zh/#32-key","title":"3.2 \u52a8\u6001 key \u8bbf\u95ee","text":"<pre><code>import hyperparameter as hp\n\ndef train_task(task_name):\n    lr = scope[f\"task.{task_name}.lr\"] | 1e-3\n    wd = scope[f\"task.{task_name}.weight_decay\"] | 0.01\n    print(f\"{task_name}: lr={lr}, weight_decay={wd}\")\n\nwith hp.scope(**{\n    \"task.cls.lr\": 1e-3,\n    \"task.cls.weight_decay\": 0.01,\n    \"task.seg.lr\": 5e-4,\n    \"task.seg.weight_decay\": 0.001,\n}):\n    train_task(\"cls\")\n    train_task(\"seg\")\n</code></pre> <p>\u4f7f\u7528 <code>scope[key]</code> \u8bed\u6cd5\u652f\u6301\u52a8\u6001\u6784\u9020\u7684 key\u3002</p>"},{"location":"quick_start.zh/#4","title":"4. \u7ebf\u7a0b\u5b89\u5168","text":""},{"location":"quick_start.zh/#41","title":"4.1 \u8bf7\u6c42\u7ea7\u9694\u79bb","text":"<pre><code>import hyperparameter as hp\n\ndef rerank(items):\n    use_new = hp.scope.rerank.use_new(False)\n    threshold = hp.scope.rerank.threshold | 0.8\n    if use_new:\n        return [x for x in items if x.score &gt;= threshold]\n    return items\n\ndef handle_request(request):\n    with hp.scope(**request.overrides):\n        return rerank(request.items)\n</code></pre> <p>\u6bcf\u4e2a\u8bf7\u6c42\u5728\u72ec\u7acb\u4f5c\u7528\u57df\u4e2d\u6267\u884c\uff0c\u914d\u7f6e\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u5e76\u53d1\u8bf7\u6c42\u3002</p>"},{"location":"quick_start.zh/#42","title":"4.2 \u591a\u7ebf\u7a0b\u6570\u636e\u5904\u7406","text":"<pre><code>import concurrent.futures\nimport hyperparameter as hp\n\ndef preprocess(shard, cfg):\n    with hp.scope(**cfg):\n        clean = hp.scope.pre.clean_noise(False)\n        norm = hp.scope.pre.norm | \"zscore\"\n        # \u5904\u7406\u903b\u8f91\n        return processed_shard\n\ncfg = {\"pre.clean_noise\": True, \"pre.norm\": \"minmax\"}\nshards = load_shards()\n\nwith concurrent.futures.ThreadPoolExecutor(max_workers=4) as executor:\n    results = list(executor.map(lambda s: preprocess(s, cfg), shards))\n</code></pre> <p>\u7ebf\u7a0b\u5b89\u5168\u4fdd\u8bc1\uff1a - \u914d\u7f6e\u5b57\u5178\u53ef\u5b89\u5168\u4f20\u9012\u7ed9\u591a\u4e2a\u7ebf\u7a0b - \u6bcf\u4e2a\u7ebf\u7a0b\u7684 <code>scope</code> \u4fee\u6539\u76f8\u4e92\u9694\u79bb - \u4f5c\u7528\u57df\u9000\u51fa\u65f6\u81ea\u52a8\u6e05\u7406</p>"},{"location":"quick_start.zh/#5","title":"5. \u5178\u578b\u5e94\u7528\u573a\u666f","text":""},{"location":"quick_start.zh/#51-llm","title":"5.1 LLM \u63a8\u7406\u914d\u7f6e","text":"<pre><code>import hyperparameter as hp\n\ndef generate(prompt):\n    max_tokens = hp.scope.llm.max_tokens | 256\n    temperature = hp.scope.llm.temperature | 0.7\n    return llm_call(prompt, max_tokens=max_tokens, temperature=temperature)\n\n# \u9ed8\u8ba4\u914d\u7f6e\ngenerate(\"hello\")\n\n# \u4e34\u65f6\u4fee\u6539\nwith hp.scope(**{\"llm.max_tokens\": 64, \"llm.temperature\": 0.2}):\n    generate(\"short answer\")\n</code></pre>"},{"location":"quick_start.zh/#52-ab","title":"5.2 A/B \u6d4b\u8bd5","text":"<pre><code>import hyperparameter as hp\n\ndef get_experiment_config(user_id):\n    if hash(user_id) % 100 &lt; 10:  # 10% \u6d41\u91cf\n        return {\"search.algo\": \"v2\", \"search.boost\": 1.5}\n    return {}\n\ndef search(query):\n    algo = hp.scope.search.algo | \"v1\"\n    boost = hp.scope.search.boost | 1.0\n    # \u641c\u7d22\u903b\u8f91\n\ndef handle_request(user_id, query):\n    with hp.scope(**get_experiment_config(user_id)):\n        return search(query)\n</code></pre>"},{"location":"quick_start.zh/#53-etl","title":"5.3 ETL \u4efb\u52a1\u914d\u7f6e","text":"<pre><code>import hyperparameter as hp\n\ndef run_job(name, overrides=None):\n    with hp.scope(**(overrides or {})):\n        batch = hp.scope.etl.batch_size | 500\n        retry = hp.scope.etl.retry | 3\n        timeout = hp.scope.etl.timeout | 30\n        # ETL \u903b\u8f91\n\nrun_job(\"daily\")\nrun_job(\"full_rebuild\", {\"etl.batch_size\": 5000, \"etl.timeout\": 300})\n</code></pre>"},{"location":"quick_start.zh/#54","title":"5.4 \u65e9\u505c\u8c03\u5ea6","text":"<pre><code>import hyperparameter as hp\n\ndef check_early_stop(metric, best, wait):\n    patience = hp.scope.scheduler.patience | 5\n    delta = hp.scope.scheduler.min_delta | 0.001\n\n    if metric &gt; best + delta:\n        return False, metric, 0\n    wait += 1\n    return wait &gt;= patience, best, wait\n</code></pre>"},{"location":"quick_start.zh/#6-rust","title":"6. Rust \u63a5\u53e3","text":""},{"location":"quick_start.zh/#61","title":"6.1 \u57fa\u7840\u7528\u6cd5","text":"<pre><code>use hyperparameter::*;\n\nfn train() {\n    with_params! {\n        get lr = train.lr or 0.001f64;\n        get batch_size = train.batch_size or 32i64;\n        println!(\"lr={}, batch_size={}\", lr, batch_size);\n    }\n}\n\nfn main() {\n    train();  // \u4f7f\u7528\u9ed8\u8ba4\u503c\n\n    with_params! {\n        set train.lr = 0.0005f64;\n        set train.batch_size = 64i64;\n        train();\n    };\n\n    train();  // \u56de\u6eda\u5230\u9ed8\u8ba4\u503c\n}\n</code></pre>"},{"location":"quick_start.zh/#62-frozen","title":"6.2 \u7ebf\u7a0b\u9694\u79bb\u4e0e frozen()","text":"<pre><code>use hyperparameter::*;\nuse std::thread;\n\nfn worker(id: i64) {\n    with_params! {\n        set worker.id = id;\n        for i in 0..5 {\n            with_params! {\n                set worker.iter = i;\n                get wid = worker.id or -1i64;\n                get witer = worker.iter or -1i64;\n                println!(\"Worker {} iter {}\", wid, witer);\n            };\n        }\n    };\n}\n\nfn main() {\n    with_params! {\n        set global.seed = 42i64;\n        frozen();  // \u5feb\u7167\u5f53\u524d\u914d\u7f6e\u4f5c\u4e3a\u65b0\u7ebf\u7a0b\u7684\u521d\u59cb\u72b6\u6001\n    };\n\n    let handles: Vec&lt;_&gt; = (0..4)\n        .map(|id| thread::spawn(move || worker(id)))\n        .collect();\n\n    for h in handles {\n        h.join().unwrap();\n    }\n}\n</code></pre> <p><code>frozen()</code> \u5c06\u5f53\u524d\u914d\u7f6e\u5feb\u7167\u4e3a\u5168\u5c40\u57fa\u7ebf\uff0c\u65b0\u7ebf\u7a0b\u4ece\u8be5\u5feb\u7167\u5f00\u59cb\uff0c\u540e\u7eed\u4fee\u6539\u7ebf\u7a0b\u95f4\u9694\u79bb\u3002</p>"},{"location":"quick_start.zh/#7-api","title":"7. API \u901f\u67e5","text":"\u7528\u6cd5 \u8bf4\u660e <code>hp.scope.a.b \\| default</code> \u8bfb\u53d6\u53c2\u6570\uff0c\u63d0\u4f9b\u9ed8\u8ba4\u503c <code>hp.scope.a.b(default)</code> \u540c\u4e0a\uff0c\u51fd\u6570\u8c03\u7528\u8bed\u6cd5 <code>hp.scope.a.b()</code> \u8bfb\u53d6\u5fc5\u9700\u53c2\u6570\uff0c\u7f3a\u5931\u65f6\u629b\u51fa KeyError <code>scope[\"a.b\"]</code> \u52a8\u6001 key \u8bbf\u95ee <code>with hp.scope(**dict):</code> \u521b\u5efa\u4f5c\u7528\u57df\uff0c\u8986\u76d6\u53c2\u6570 <code>with hp.scope(*list):</code> \u4ece\u5b57\u7b26\u4e32\u5217\u8868\uff08\u5982 CLI\uff09\u521b\u5efa\u4f5c\u7528\u57df <code>@hp.param(\"ns\")</code> \u88c5\u9970\u5668\uff0c\u81ea\u52a8\u7ed1\u5b9a\u51fd\u6570\u53c2\u6570\u5230 <code>ns.*</code>"},{"location":"quick_start.zh/#8","title":"8. \u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>key \u547d\u540d\uff1a\u4f7f\u7528 <code>.</code> \u5206\u9694\u5c42\u7ea7\uff0c\u5982 <code>train.optimizer.lr</code></li> <li>\u7c7b\u578b\u4e00\u81f4\uff1a\u540c\u4e00 key \u7684\u503c\u5e94\u4fdd\u6301\u7c7b\u578b\u4e00\u81f4</li> <li>\u9ed8\u8ba4\u503c\uff1a\u59cb\u7ec8\u63d0\u4f9b\u9ed8\u8ba4\u503c\uff0c\u907f\u514d KeyError</li> <li>\u4f5c\u7528\u57df\u8303\u56f4\uff1a\u5c3d\u91cf\u7f29\u5c0f\u4f5c\u7528\u57df\u8303\u56f4\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u53c2\u6570\u66b4\u9732</li> <li>\u7ebf\u7a0b\u8fb9\u754c\uff1a\u8de8\u8fdb\u7a0b\u573a\u666f\u9700\u4f7f\u7528 Rust \u540e\u7aef\u6216\u81ea\u5b9a\u4e49\u5b58\u50a8\u9002\u914d\u5668</li> </ol>"},{"location":"reference/","title":"Reference (English)","text":""},{"location":"reference/#hyperparameter.api.scope","title":"<code>scope(*args, **kwargs)</code>","text":"<p>               Bases: <code>_HyperParameter</code></p> <p>A thread-safe hyperparameter context scope</p> <p>Examples:</p> <p>create new <code>scope</code></p> <pre><code>&gt;&gt;&gt; ps = scope(a=\"a\", b=\"b\")           # create from call arguments\n&gt;&gt;&gt; ps = scope(**{\"a\": \"a\", \"b\": \"b\"}) # create from a dict\n</code></pre> <p>read parameters from <code>scope</code></p> <pre><code>&gt;&gt;&gt; ps.a() # read parameter\n'a'\n&gt;&gt;&gt; ps.c(\"c\")  # read parameter with default value if missing\n'c'\n&gt;&gt;&gt; ps.c | \"c\" # another way for reading missing parameters\n'c'\n</code></pre> <p><code>scope</code> as a context scope</p> <pre><code>&gt;&gt;&gt; with scope(**{\"a\": \"a\"}) as ps:\n...     print(ps.a())\na\n</code></pre> <p>read parameter from scope in a function</p> <pre><code>&gt;&gt;&gt; def foo():\n...    with scope() as ps:\n...        return ps.a()\n&gt;&gt;&gt; with scope(**{\"a\": \"a\", \"b\": \"b\"}) as ps:\n...     foo() # foo should get scope using a with statement\n'a'\n</code></pre> <p>modify parameters in nested scopes</p> <pre><code>&gt;&gt;&gt; with scope.empty(**{'a': 1, 'b': 2}) as ps:\n...     _repr_dict(ps.storage().storage())\n...     with scope(**{'b': 3}) as ps:\n...         _repr_dict(ps.storage().storage())\n...     with scope() as ps:\n...         _repr_dict(ps.storage().storage())\n[('a', 1), ('b', 2)]\n[('a', 1), ('b', 3)]\n[('a', 1), ('b', 2)]\n</code></pre> <p>use object-style parameter key in scope</p> <pre><code>&gt;&gt;&gt; with scope(**{\"a.b.c\": [1,2]}) as ps:\n...     ps.a.b.c()\n[1, 2]\n</code></pre> <p>access parameter with <code>scope</code></p> <pre><code>&gt;&gt;&gt; with scope(x=1):\n...     scope.x(2) # read parameter\n...     scope.y(2) # read a missing parameter with default value\n...     scope.y | 2\n...     scope.z = 3\n...     scope.z | 0\n1\n2\n2\n3\n</code></pre> <p>convert scope to dict:</p> <pre><code>&gt;&gt;&gt; ps = scope.empty(a=1, b=2)\n&gt;&gt;&gt; _repr_dict(dict(ps))\n[('a', 1), ('b', 2)]\n</code></pre> Source code in <code>hyperparameter/api.py</code> <pre><code>def __init__(self, *args: str, **kwargs: Any) -&gt; None:\n    super().__init__()\n    self.update(kwargs)\n    for line in args:\n        if \"=\" in line:\n            k, v = line.split(\"=\", 1)\n            self.put(k, v)\n</code></pre>"},{"location":"reference/#hyperparameter.api.scope.__enter__","title":"<code>__enter__()</code>","text":"<p>enter a <code>scope</code> context</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; with scope():\n...     scope.p = \"origin\"\n...     with scope(**{\"p\": \"origin\"}) as ps:\n...         ps.storage().storage()      # outer scope\n...         with scope() as ps:   # unmodified scope\n...             ps.storage().storage()  # inner scope\n...         with scope(**{\"p\": \"modified\"}) as ps: # modified scope\n...             ps.storage().storage()  # inner scope with modified params\n...         _ = scope(**{\"p\": \"modified\"}) # not used in with ctx\n...         with scope() as ps:   # unmodified scope\n...             ps.storage().storage()  # inner scope\n{'p': 'origin'}\n{'p': 'origin'}\n{'p': 'modified'}\n{'p': 'origin'}\n</code></pre> Source code in <code>hyperparameter/api.py</code> <pre><code>def __enter__(self) -&gt; \"scope\":\n    \"\"\"enter a `scope` context\n\n    Examples\n    --------\n    &gt;&gt;&gt; with scope():\n    ...     scope.p = \"origin\"\n    ...     with scope(**{\"p\": \"origin\"}) as ps:\n    ...         ps.storage().storage()      # outer scope\n    ...         with scope() as ps:   # unmodified scope\n    ...             ps.storage().storage()  # inner scope\n    ...         with scope(**{\"p\": \"modified\"}) as ps: # modified scope\n    ...             ps.storage().storage()  # inner scope with modified params\n    ...         _ = scope(**{\"p\": \"modified\"}) # not used in with ctx\n    ...         with scope() as ps:   # unmodified scope\n    ...             ps.storage().storage()  # inner scope\n    {'p': 'origin'}\n    {'p': 'origin'}\n    {'p': 'modified'}\n    {'p': 'origin'}\n    \"\"\"\n\n    self._storage.enter()\n    return self\n</code></pre>"},{"location":"reference/#hyperparameter.api.scope.current","title":"<code>current()</code>  <code>staticmethod</code>","text":"<p>get current <code>scope</code></p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; with scope(a=1) as ps:\n...     scope.current().a(\"empty\") # read `a` from current `scope`\n'1'\n</code></pre> <pre><code>&gt;&gt;&gt; with scope() as ps1:\n...     with scope(a=1) as ps2:\n...         scope.current().a = 2  # set parameter `a` = 2\n...         scope.a(\"empty\")       # read `a` in `ps2`\n...     scope.a(\"empty\")           # read `a` in `ps1`, where `a` is not set\n'2'\n'empty'\n</code></pre> Source code in <code>hyperparameter/api.py</code> <pre><code>@staticmethod\ndef current() -&gt; \"scope\":\n    \"\"\"get current `scope`\n\n    Examples\n    --------\n    &gt;&gt;&gt; with scope(a=1) as ps:\n    ...     scope.current().a(\"empty\") # read `a` from current `scope`\n    '1'\n\n    &gt;&gt;&gt; with scope() as ps1:\n    ...     with scope(a=1) as ps2:\n    ...         scope.current().a = 2  # set parameter `a` = 2\n    ...         scope.a(\"empty\")       # read `a` in `ps2`\n    ...     scope.a(\"empty\")           # read `a` in `ps1`, where `a` is not set\n    '2'\n    'empty'\n    \"\"\"\n    retval = scope()\n    retval._storage = TLSKVStorage.current()\n    return retval\n</code></pre>"},{"location":"reference/#hyperparameter.api.scope.empty","title":"<code>empty(*args, **kwargs)</code>  <code>staticmethod</code>","text":"<p>create an empty <code>scope</code>.</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; with scope(a=\"not empty\") as ps: # start a new scope `a` = 'not empty'\n...     scope.a(\"empty\")             # read parameter `a`\n...     with scope.empty() as ps2:   # parameter `a` is cleared in ps2\n...         scope.a(\"empty\")         # read parameter `a` = 'empty'\n'not empty'\n'empty'\n</code></pre> Source code in <code>hyperparameter/api.py</code> <pre><code>@staticmethod\ndef empty(*args: str, **kwargs: Any) -&gt; \"scope\":\n    \"\"\"create an empty `scope`.\n\n    Examples\n    --------\n    &gt;&gt;&gt; with scope(a=\"not empty\") as ps: # start a new scope `a` = 'not empty'\n    ...     scope.a(\"empty\")             # read parameter `a`\n    ...     with scope.empty() as ps2:   # parameter `a` is cleared in ps2\n    ...         scope.a(\"empty\")         # read parameter `a` = 'empty'\n    'not empty'\n    'empty'\n    \"\"\"\n    retval = scope().clear().update(kwargs)\n    for line in args:\n        if \"=\" in line:\n            k, v = line.split(\"=\", 1)\n            retval.put(k, v)\n    return retval\n</code></pre>"},{"location":"reference/#hyperparameter.api.scope.init","title":"<code>init(params=None)</code>  <code>staticmethod</code>","text":"<p>init scope for a new thread.</p> Source code in <code>hyperparameter/api.py</code> <pre><code>@staticmethod\ndef init(params: Optional[Dict[str, Any]] = None) -&gt; None:\n    \"\"\"init scope for a new thread.\"\"\"\n    if params is None:\n        params = {}\n    scope(**params).__enter__()\n</code></pre>"},{"location":"reference/#hyperparameter.api.param","title":"<code>param(name_or_func)</code>","text":"<pre><code>param(func: Callable) -&gt; Callable\n</code></pre><pre><code>param(name: str) -&gt; Callable[[Callable], Callable]\n</code></pre> <p>Convert keyword arguments into hyperparameters</p> <p>Examples:</p> <pre><code>&gt;&gt;&gt; @param\n... def foo(a, b=2, c='c', d=None):\n...     print(a, b, c, d)\n</code></pre> <pre><code>&gt;&gt;&gt; foo(1)\n1 2 c None\n</code></pre> <pre><code>&gt;&gt;&gt; with scope('foo.b=3'):\n...     foo(2)\n2 3 c None\n</code></pre> <p>classes are also supported:</p> <pre><code>&gt;&gt;&gt; @param\n... class foo:\n...     def __init__(self, a, b=2, c='c', d=None):\n...         print(a, b, c, d)\n</code></pre> <pre><code>&gt;&gt;&gt; obj = foo(1)\n1 2 c None\n</code></pre> <pre><code>&gt;&gt;&gt; with scope('foo.b=3'):\n...     obj = foo(2)\n2 3 c None\n</code></pre> <pre><code>&gt;&gt;&gt; @param('myns.foo.params')\n... def foo(a, b=2, c='c', d=None):\n...     print(a, b, c, d)\n&gt;&gt;&gt; foo(1)\n1 2 c None\n</code></pre> <pre><code>&gt;&gt;&gt; with scope('myns.foo.params.b=3'):\n...     foo(2)\n2 3 c None\n</code></pre> <pre><code>&gt;&gt;&gt; with scope('myns.foo.params.b=3'):\n...     scope.myns.foo.params.b = 4\n...     foo(2)\n2 4 c None\n</code></pre> Source code in <code>hyperparameter/api.py</code> <pre><code>def param(\n    name_or_func: Union[str, Callable, None],\n) -&gt; Union[Callable, Callable[[Callable], Callable]]:\n    \"\"\"Convert keyword arguments into hyperparameters\n\n    Examples\n    --------\n\n    &gt;&gt;&gt; @param\n    ... def foo(a, b=2, c='c', d=None):\n    ...     print(a, b, c, d)\n\n    &gt;&gt;&gt; foo(1)\n    1 2 c None\n\n    &gt;&gt;&gt; with scope('foo.b=3'):\n    ...     foo(2)\n    2 3 c None\n\n    classes are also supported:\n    &gt;&gt;&gt; @param\n    ... class foo:\n    ...     def __init__(self, a, b=2, c='c', d=None):\n    ...         print(a, b, c, d)\n\n    &gt;&gt;&gt; obj = foo(1)\n    1 2 c None\n\n    &gt;&gt;&gt; with scope('foo.b=3'):\n    ...     obj = foo(2)\n    2 3 c None\n\n    &gt;&gt;&gt; @param('myns.foo.params')\n    ... def foo(a, b=2, c='c', d=None):\n    ...     print(a, b, c, d)\n    &gt;&gt;&gt; foo(1)\n    1 2 c None\n\n    &gt;&gt;&gt; with scope('myns.foo.params.b=3'):\n    ...     foo(2)\n    2 3 c None\n\n    &gt;&gt;&gt; with scope('myns.foo.params.b=3'):\n    ...     scope.myns.foo.params.b = 4\n    ...     foo(2)\n    2 4 c None\n    \"\"\"\n\n    if callable(name_or_func):\n        return param(None)(name_or_func)\n\n    if has_rust_backend:\n\n        def hashed_wrapper(func: Callable) -&gt; Callable:\n            predef_kws: Dict[str, int] = {}\n            predef_defaults: Dict[str, Any] = {}\n\n            if name_or_func is None:\n                namespace = func.__name__\n            else:\n                namespace = name_or_func\n\n            signature = inspect.signature(func)\n            for k, v in signature.parameters.items():\n                if v.default != v.empty:\n                    name = \"{}.{}\".format(namespace, k)\n                    predef_kws[k] = xxh64(name)\n                    predef_defaults[k] = v.default\n\n            @functools.wraps(func)\n            def inner(*arg: Any, **kws: Any) -&gt; Any:\n                with scope() as hp:\n                    for k, v in predef_kws.items():\n                        if k not in kws:\n                            try:\n                                val = hp._storage.get_entry(v)\n                                kws[k] = _coerce_with_default(val, predef_defaults[k])\n                            except ValueError:\n                                pass\n                    return func(*arg, **kws)\n\n            inner._auto_param_namespace = namespace  # type: ignore[attr-defined]\n            inner._auto_param_wrapped = func  # type: ignore[attr-defined]\n            return inner\n\n        return hashed_wrapper\n\n    def wrapper(func: Callable) -&gt; Callable:\n        predef_kws: Dict[str, str] = {}\n        predef_val: Dict[str, Any] = {}\n\n        if name_or_func is None:\n            namespace = func.__name__\n        else:\n            namespace = name_or_func\n\n        signature = inspect.signature(func)\n        for k, v in signature.parameters.items():\n            if v.default != v.empty:\n                name = \"{}.{}\".format(namespace, k)\n                predef_kws[k] = name\n                predef_val[name] = v.default\n\n        @functools.wraps(func)\n        def inner(*arg: Any, **kws: Any) -&gt; Any:\n            with scope() as hp:\n                local_params: Dict[str, Any] = {}\n                for k, v in predef_kws.items():\n                    if k not in kws:\n                        val = getattr(hp(), v).get_or_else(predef_val[v])\n                        kws[k] = val\n                        local_params[v] = hp.get(v)\n                    else:\n                        local_params[v] = predef_val[v]\n                return func(*arg, **kws)\n\n        inner._auto_param_namespace = namespace  # type: ignore[attr-defined]\n        inner._auto_param_wrapped = func  # type: ignore[attr-defined]\n        return inner\n\n    return wrapper\n</code></pre>"},{"location":"structured_parameter/","title":"Structured Parameter","text":"<p>The main idea of <code>HyperParameter</code> is to organize the parameters and parameter accesses into a tree structure, by which we can refer to each parameter with a unique name and identify each access to the parameters. Then we can modify each parameter and control the access to the parameters.</p>"},{"location":"structured_parameter/#nested-parameters-and-parameter-path","title":"Nested Parameters and Parameter Path","text":"<p>The parameters are stored in a nested dict, a very common solution for python programs, and can be easily serialized into JSON or YAML format. For example:</p> <pre><code>cfg = {\n    \"param1\": 1, # unique name: param1\n    \"obj2\": {\n        \"param3\": \"value4\", # unique name: obj2.param3\n        \"param5\": 6,        # unique name: obj2.param5\n    },\n}\n</code></pre> <p>We can directly refer to the value <code>value4</code> by <code>cfg[\"obj2\"][\"param3\"]</code>. But we also need to check whether the parameter is missing from the cfg, and handle the default value.</p> <p><code>HyperParameter</code> offers a tiny DSL to access the parameters. The DSL syntax is very similar to <code>jsonpath</code>, but compatible with python syntax so that the interpreter and code editor can check for syntax errors. (I found this feature saves me a lot of time.). The first thing to use the DSL is converting the cfg into <code>HyperParameter</code>, and then we can use the DSL:</p> <pre><code># convert a nested dict into HyperParameter\nhp = HyperParameter(**cfg) \n\n# or create the HyperParameter object from scratch\nhp = HyperParameter(param1=1, obj2={\"param3\": \"value4\"})\n\n# the DSL for access the parameter\nparam = hp().obj2.param3(default=\"undefined\")\n</code></pre> <p><code>hp().obj2.param3(default=\"undefined\")</code> is the inline DSL for reading parameter from <code>HyperParameter</code> object. It looks like a <code>jsonpath</code> expression but has support for default values.</p>"},{"location":"structured_parameter/#best-practice-for-structure-parameters-with-parameter-path","title":"Best Practice for Structure Parameters with Parameter Path","text":""},{"location":"structured_parameter/#a-quick-example-of-recommendation-model","title":"A Quick Example of Recommendation Model","text":"<p>Suppose we are building a wide&amp;deep model with <code>keras</code>.</p> <pre><code>class WideAndDeepModel(keras.Model):\n    def __init__(self, units=30, activation=\"relu\", **kwargs):\n        super().__init__(**kwargs)\n        self.hidden1 = keras.layers.Dense(units, activation=activation)\n        self.hidden2 = keras.layers.Dense(units, activation=activation)\n        self.main_output = keras.layers.Dense(1)\n        self.aux_output = keras.layers.Dense(1)\n\n    def call(self, inputs):\n        input_A , input_B = inputs\n        hidden1 = self.hidden1(input_B)\n        hidden2 = self.hidden2(hidden1)\n        concat = keras.layers.concatenate([input_A, hidden2])\n        main_output = self.main_output()(concat)\n        aux_output = self.aux_output()(hidden2)\n        return main_outputi, aux_output\n</code></pre> <p>The model is straightforward and does not support many parameters. If we want to add batch normalization, dropout, and leaky-relu tricks to the model, we have to modify the code as follows:</p> <pre><code>class WideAndDeepModel(keras.Model):\n    def __init__(self, \n        units=[30, 30, 30],\n        activation=\"relu\",\n        use_bn=False,\n        bn_momentum=0.99,\n        bn_epsilon=0.001,\n        bn_center=True,\n        bn_scale=True,\n        bn_beta_initializer=\"zeros\",\n        bn_gamma_initializer=\"ones\",\n        bn_moving_mean_initializer=\"zeros\",\n        bn_moving_variance_initializer=\"ones\",\n        use_dropout=False,\n        ...):\n\n        ...\n        self.bn1 = keras.layers.BatchNormalization(\n            momentum=bn_momentum,\n            epsilon=bn_epsilon,\n            center=bn_center,\n            scale=bn_scale,\n            beta_initializer=bn_beta_initializer,\n            gamma_initializer=bn_gamma_initializer,\n            ...,\n        )\n</code></pre> <p>The code becomes too complicated, having dozens of parameters to handle, most of which are not used.</p>"},{"location":"structured_parameter/#a-fast-trial-of-structured-parameter","title":"A Fast Trial of Structured Parameter","text":"<p>We can simplify the code with <code>param</code>, which automatically converts the parameters into a parameter tree. And then, we can specify the parameters by name:</p> <pre><code># add parameter support for custom functions with a decorator\n@hp.param(\"myns.rec.rank.dropout\")\nclass dropout:\n    def __init__(self, ratio=0.5):\n        ...\n\n# add parameter support for library functions \nwrapped_bn = param(\"myns.rec.rank.bn\")(keras.layers.BatchNormalization)\n</code></pre> <p><code>myns.rec.rank</code> is the namespace for my project, and <code>myns.rec.rank.dropout</code> refers to the function defined in our code. We can refer to the keyword arguments (e.g. <code>ratio=0.5</code>) with the path <code>hp().myns.rec.rank.dropout</code>. </p> <p>After making the building block configurable, we can simplify the model: <pre><code>class WideAndDeepModel(keras.Model):\n    def __init__(self, \n        units=[30, 30, 30],\n        activation=\"relu\",\n        ...):\n\n        ...\n        self.bn1 = wrapped_bn()\n        self.dropout1 = dropout()\n</code></pre> And we can change the parameters of the <code>BN</code> layers with <code>scope</code>:</p> <pre><code>with hp.scope(**{\n    \"myns.rec.rank.dropout.ratio\": 0.6,\n    \"myns.rec.rank.bn.center\": False,\n    ...\n}):\n    model = WideAndDeepModel()\n</code></pre> <p>Or read the parameters from a JSON file:</p> <pre><code>with open(\"model.cfg.json\") as f:\n    cfg = json.load(f)\nwith hp.scope(**cfg):\n    model = WideAndDeepModel() \n</code></pre>"},{"location":"structured_parameter/#fine-grained-control-of-structured-parameters","title":"Fine-grained Control of Structured Parameters","text":"<p>In the last section, we have introduced how to structure the parameters with <code>param</code> and modify them with <code>scope</code> by their path. However, we may also need to access the same parameter in different places in our code, e.g., different layers in a DNN model.</p> <p>In such situation, we can break our code into named scopes. And then, we can identify each access to the parameters and set a value for each access.</p> <p>To add named scopes to our code, we can use <code>scope</code>:</p> <pre><code>class WideAndDeepModel(keras.Model):\n    def __init__(self, \n        units=[30, 30, 30],\n        activation=\"relu\",\n        ...):\n\n        ...\n        with scope[\"layer1\"]():\n            self.bn1 = wrapped_bn()\n            self.dropout1 = dropout()\n        with scope[\"layer2\"]():\n            self.bn2 = wrapped_bn()\n            self.dropout2 = dropout()\n        ...\n\nwith scope[\"wdmodel\"]():\n    model = WideAndDeepModel()\n</code></pre> <p><code>scope[\"layer1\"]</code> creates a named scope called <code>layer1</code>. Since the scope is created inside another named scope <code>scope[\"wdmodel\"]</code>, its full path should be <code>wdmodel.layer1</code>. We can specify different values of a parameter according to its path. For example:</p> <pre><code>with scope[\"wdmodel\"](**{\n    \"myns.rec.rank.dropout.ratio@wdmodel.layer1\": 0.6,\n    \"myns.rec.rank.dropout.ratio@wdmodel.layer2\": 0.7,\n}):\n    model = WideAndDeepModel()\n</code></pre> <p>With the above code, we get a drop ratio of 0.6 for <code>layer1</code> and 0.7 for <code>layer2</code>.</p>"},{"location":"examples/optimization/","title":"Hyperparameter Optimization","text":"<ul> <li>\u4e2d\u6587</li> </ul>"},{"location":"examples/optimization/#hyper-parameter-optimization","title":"Hyper-Parameter Optimization","text":"<p>This example is based on <code>optuna</code> quick start example. Optuna is an open-source hyperparameter optimization framework which is easy to use:</p> <pre><code>import optuna\n\ndef objective(trial):\n    x = trial.suggest_float('x', -10, 10)\n    return (x - 2) ** 2\n\nstudy = optuna.create_study()\nstudy.optimize(objective, n_trials=100)\n\nstudy.best_params  # E.g. {'x': 2.002108042}\n</code></pre> <p>The above example creates a <code>study</code> object to search for the best parameter <code>x</code> that minimizes the objective function <code>(x-2)^2</code>.</p>"},{"location":"examples/optimization/#parameter-searching-with-hyperparameter","title":"Parameter Searching with <code>HyperParameter</code>","text":"<p>Parameter searching can be much easier with <code>HyperParameter</code>:</p> <pre><code>import optuna\nimport hyperparameter as hp\n\n@hp.param\ndef objective(x = 0.0):\n    return (x - 2) ** 2\n\ndef wrapper(trial):\n    trial = lazy_dispatch(trial)\n    with hp.scope(**{\n        \"objective.x\": trial.suggest_float('objective.x', -10, 10)\n    }):\n        return objective()\n\nstudy = optuna.create_study()\nstudy.optimize(wrapper, n_trials=100)\n\nstudy.best_params  # E.g. {'x': 2.002108042}\n</code></pre> <p>We directly apply the <code>param</code> decorator to the objective function so that it accepts parameters from <code>scope</code>. Then we define a wrapper function that adapts <code>scope</code> API to <code>optuna</code>'s <code>trial</code> API and starts the parameter experiment as suggested in <code>optuna</code>'s example.</p>"},{"location":"examples/optimization/#put-the-best-parameters-into-production","title":"Put the Best Parameters into Production","text":"<p>To put the best parameters into production, we can directly pass them to <code>scope</code>. This is very convenient if you want to put a ML model into production.</p> <pre><code>with hp.scope(**study.best_params):\n    print(f\"{study.best_params} =&gt; {objective()}\")\n</code></pre>"},{"location":"examples/optimization/#optimization-on-nested-functions","title":"Optimization on Nested Functions","text":"<p><code>scope</code> and <code>param</code> also support complex problems with nested functions:</p> <pre><code>@hp.param\ndef objective_x(x = 0.0):\n    return (x - 2) ** 2\n\n@hp.param\ndef objective_y(y = 0.0):\n    return (y - 1) ** 3\n\ndef objective():\n    return objective_x() * objective_y()\n\ndef wrapper(trial):\n    trial = lazy_dispatch(trial)\n    with hp.scope(**{\n        \"objective_x.x\": trial.suggest_float('objective_x.x', -10, 10),\n        \"objective_y.y\": trial.suggest_float('objective_y.y', -10, 10)\n    }):\n        return objective()\n\nstudy = optuna.create_study()\nstudy.optimize(wrapper, n_trials=100)\n\nstudy.best_params  # E.g. {'x': 2.002108042}\n</code></pre>"},{"location":"examples/optimization.zh/","title":"\u53c2\u6570\u4f18\u5316","text":"<ul> <li>English</li> </ul>"},{"location":"examples/optimization.zh/#_1","title":"\u53c2\u6570\u5bfb\u4f18","text":"<p>\u539f\u793a\u4f8b\u51fa\u81ea<code>optuna</code>\u9879\u76ee\u7684quick start example. Optuna \u662f\u4e00\u6b3e\u6613\u4e8e\u4f7f\u7528\u7684\u5f00\u6e90\u8d85\u53c2\u4f18\u5316\u6846\u67b6:</p> <pre><code>import optuna\n\ndef objective(trial):\n    x = trial.suggest_float('x', -10, 10)\n    return (x - 2) ** 2\n\nstudy = optuna.create_study()\nstudy.optimize(objective, n_trials=100)\n\nstudy.best_params  # E.g. {'x': 2.002108042}\n</code></pre> <p>\u4ee5\u4e0a\u4ee3\u7801\u521b\u5efa\u4e86\u4e00\u4e2a <code>study</code> \u5bf9\u8c61\uff0c\u7528\u6765\u641c\u7d22\u6700\u5c0f\u5316\u76ee\u6807\u51fd\u6570 <code>(x-2)^2</code> \u7684\u53c2\u6570<code>x</code> \u7684\u6700\u4f18\u53d6\u503c\uff0c.</p>"},{"location":"examples/optimization.zh/#hyperparameter","title":"\u4f7f\u7528 <code>HyperParameter</code>\u8fdb\u884c\u8d85\u53c2\u641c\u7d22","text":"<p>\u6211\u4eec\u53ef\u4ee5\u501f\u52a9 <code>HyperParameter</code>\u5c06\u4e0a\u8ff0\u641c\u7d22\u8fc7\u7a0b\u5927\u5e45\u7b80\u5316\uff1a</p> <pre><code>import optuna\nimport hyperparameter as hp\n\n@hp.param\ndef objective(x = 0.0):\n    return (x - 2) ** 2\n\ndef wrapper(trial):\n    trial = lazy_dispatch(trial)\n    with hp.scope(**{\n        \"objective.x\": trial.suggest_float('objective.x', -10, 10)\n    }):\n        return objective()\n\nstudy = optuna.create_study()\nstudy.optimize(wrapper, n_trials=100)\n\nstudy.best_params  # E.g. {'x': 2.002108042}\n</code></pre> <p>\u901a\u8fc7 <code>param</code> \u88c5\u9970\u5668\uff0c\u6211\u4eec\u5bf9\u76ee\u6807\u51fd\u6570\u8fdb\u884c\u4e86<code>\u8d85\u53c2\u5316</code>\uff0c\u4f7f\u5176\u80fd\u591f\u4ece<code>scope</code>\u8bfb\u53d6\u53c2\u6570\u3002\u4e4b\u540e\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u8f85\u52a9\u51fd\u6570\u6765\u5bf9\u63a5<code>scope</code>\u548c <code>optuna</code> \u7684<code>trial</code> \u63a5\u53e3\uff0c\u5e76\u5f00\u59cb\u8d85\u53c2\u5bfb\u4f18\u3002</p> <p>\u4f7f\u7528 <code>param</code> \u4e0e <code>scope</code> \u7684\u597d\u5904\u662f\u5c06\u4ee3\u7801\u4e0d\u518d\u8026\u5408<code>optuna</code>\uff0c\u53ef\u4ee5\u5728\u751f\u4ea7\u4ee3\u7801\u4e2d\u590d\u7528\u4ee3\u7801\u3002</p>"},{"location":"examples/optimization.zh/#_2","title":"\u751f\u4ea7\u5316\u90e8\u7f72","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u5c06 <code>study</code> \u641c\u7d22\u5230\u7684\u6700\u4f18\u53c2\u6570\u4f20\u9012\u7ed9 <code>scope</code> \u6765\u662f\u5b9e\u73b0\u5b9e\u9a8c\u7ed3\u679c\u7684\u590d\u73b0\u4ee5\u53ca\u751f\u4ea7\u5316\u90e8\u7f72\u3002</p> <pre><code>with hp.scope(**study.best_params):\n    print(f\"{study.best_params} =&gt; {objective()}\")\n</code></pre>"},{"location":"examples/optimization.zh/#_3","title":"\u591a\u5c42\u5d4c\u5957\u51fd\u6570\u7684\u53c2\u6570\u4f18\u5316","text":"<p><code>scope</code> \u548c <code>param</code> \u53ef\u4ee5\u7528\u4e8e\u4f18\u5316\u590d\u6742\u95ee\u9898\u4e2d\u7684\u5d4c\u5957\u51fd\u6570\u7684\u53c2\u6570\u4f18\u5316\uff0c\u6bd4\u5982\uff1a</p> <pre><code>@hp.param\ndef objective_x(x = 0.0):\n    return (x - 2) ** 2\n\n@hp.param\ndef objective_y(y = 0.0):\n    return (y - 1) ** 3\n\ndef objective():\n    return objective_x() * objective_y()\n\ndef wrapper(trial):\n    trial = lazy_dispatch(trial)\n    with hp.scope(**{\n        \"objective_x.x\": trial.suggest_float('objective_x.x', -10, 10),\n        \"objective_y.y\": trial.suggest_float('objective_y.y', -10, 10)\n    }):\n        return objective()\n\nstudy = optuna.create_study()\nstudy.optimize(wrapper, n_trials=100)\n\nstudy.best_params  # E.g. {'x': 2.002108042}\n</code></pre> <p>\u4f7f\u7528 <code>param</code> \u53ef\u4ee5\u907f\u514d\u5728\u5d4c\u5957\u51fd\u6570\u4e4b\u95f4\u4f20\u9012 <code>trial</code> \u5bf9\u8c61\uff0c\u8ba9\u4ee3\u7801\u770b\u8d77\u6765\u66f4\u4e3a\u81ea\u7136\u76f4\u63a5\u3002</p>"}]}